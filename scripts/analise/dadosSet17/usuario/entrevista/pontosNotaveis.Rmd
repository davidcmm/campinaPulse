---
title: "Pontos Notáveis"
output:
  html_document:
    self_contained: no
  pdf_document: default
---

<style>
    body .main-container {
         max-width: 100%;
        margin-left: 20px;
        margin-right: auto;
    }
</style>

Pontos notáveis (positivos e negativos) apontados por nosso método e descrição.   

```{r setup, include=FALSE}
cat("<br/>")

library("ggplot2")
library("dplyr")
library("knitr")
library("texreg")
library("ineq")
library(R.utils)
library("knitr")
library("spdep")
library("reshape")
library("fitdistrplus")

multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}

best_folder <- "../../percepcaoLocal/agradavel/melhores/intersects/"
worst_folder <- "../../percepcaoLocal/agradavel/piores/intersects/"

show_street_data <- function (current_df, all_data, force_split, highlighted_positive, best_folder, worst_folder, highlighted_neutral){
    color_space <- c("#000000", "#001900", "#003300", "#004c00", "#006600", "#007f00", "#009900", "#00b200", "#00cc00", "#00e500", "#00ff00", "#ffffff")
    step <- (max(all_data$qscore) - min(all_data$qscore)) / length(color_space)
    thresholds <- seq(min(all_data$qscore), max(all_data$qscore), step)
    
    cat("<div class='row'>")
    angleData = c()
    for(i in 1:nrow(current_df)) {
      row <- current_df[i,]
      
      street <- as.character(row$street)
      photo_name <- as.character(row$url) #as.character(row$photo_name)
      number <- row$num
      angl <- row$angle
      score <- row$qscore
      angleData <- append(angleData, score)
      
      filtered <- filter(highlighted_positive, num==number & angle == angl)
      filtered_neutral <- filter(highlighted_neutral, num==number & angle == angl)
      folder <- "none"
      font_color <- "white"
      if (nrow(filtered) > 0){
         color_index <- 11
        if (file.exists(paste(best_folder, photo_name, sep=""))){
          url <- photo_name#paste(best_folder, photo_name, sep="")
          folder <- "best"
        }else if (file.exists(paste(worst_folder, photo_name, sep=""))){
          url <- photo_name#paste(worst_folder, photo_name, sep="")
          folder <- "worst"
        }else{
           url <- as.character(row$url)
        }
      }else if (nrow(filtered_neutral) > 0){
        color_index <- 12
        font_color <- "black"
        if (file.exists(paste(best_folder, photo_name, sep=""))){
          url <- photo_name#paste(best_folder, photo_name, sep="")
          folder <- "best"
        }else if (file.exists(paste(worst_folder, photo_name, sep=""))){
          url <- photo_name#paste(worst_folder, photo_name, sep="")
          folder <- "worst"
        }else{
           url <- as.character(row$url)
        }
      }
      else{
         color_index <- 1
        if (file.exists(paste(worst_folder, photo_name, sep=""))){
          url <- photo_name#paste(worst_folder, photo_name, sep="")
          folder <- "worst"
        }else if (file.exists(paste(best_folder, photo_name, sep=""))){
          url <- photo_name#paste(best_folder, photo_name, sep="")
          folder <- "best"
        }else{
           url <- as.character(row$url)
        }
      }
      
      cat(paste("<div class='col-xs-3' style=\"background-color:", color_space[color_index],"\">", sep=""))
      cat("<img src='", url,"' width='300px'>", sep = "")
      cat("<p style=\"color:",font_color,";font-size:90%\">", number, "-", angl, "-> ", score,  "</p>", sep="")#folder, "-",
      cat("</div>")
      
      #End of row with 4 images
      if(force_split && i%%4 == 0){
        cat("<div class=\"col-xs-12\" style=\"height:1000px;\"></div>")
      }
    }
}
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
#Checking sample size
scores_data <- read.table("../all100/all_ordenado.dat")
scores_data$sd <- apply(scores_data[,4:ncol(scores_data)], 1, sd)
scores_data$n <- ( 1.96 * scores_data$sd / 0.2) ** 2  #All QScores
scores_data$ci <- scores_data$sd * 1.96 / sqrt(100)
novoV2 <- lapply(as.character(scores_data$V2), function (x) strsplit(x, split="/", fixed=TRUE)[[1]][7])
novoV2 <- unlist(lapply(novoV2, '[[', 1))
novoV2 <- strsplit(novoV2, split="\\.jpg")
photo <- unlist(lapply(novoV2, '[[', 1))
scores_data$photo_name <- photo
scores_data <- arrange(scores_data, photo_name)

qscoresDFGeral <- read.csv("../qscores-df-geral.csv", header = TRUE)
qscoresDFCampina<- read.csv("../qscores-df-campina.csv", header = TRUE)
qscoresDFNotCampina <- read.csv("../qscores-df-notcampina.csv", header = TRUE)

#Plotting Q-Scores through the street
all_data <- merge(qscoresDFGeral, scores_data, by.x = "url", by.y="V2")#qscoresDFGeral
all_data$street <- as.character(all_data$street)
all_data$street <- factor(all_data$street, levels=unique(all_data$street))

```


#\#\#\# Rua 1

Ponto máximo e mínimo

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
cristina <- dplyr::filter(all_data, street == "R._Cristina_Procópio_Silva") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)

cat("<br/>")
max_point <- filter(cristina, qscore == max(cristina$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#00ff00","\">", sep=""))
cat("<img src='", as.character(max_point$url),"' width='600px'>", sep = "")#paste(best_folder, max_point$photo_name, sep="")
cat("<p style=\"color:black;font-size:90%\">", max_point$num, "- ", max_point$angle, "-", max_point$qscore,  "</p>", sep="")
cat("</div>")

min_point <- filter(cristina, qscore == min(cristina$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#000000","\">", sep=""))
cat("<img src='", as.character(min_point$url),"' width='600px'>", sep = "")#as.character(min_point$url)
cat("<p style=\"color:white;font-size:90%\">", min_point$num, "- ", min_point$angle, "-", min_point$qscore,  "</p>", sep="")
cat("</div>")

cat("<br/>")
```

Pontos notáveis destacados por ponto na rua

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
cat("<br/>")

highlighted_positive <- data.frame(num=c(2,2, 66, 66, 66, 105, 105, 160, 160, 160, 160, 210, 210, 210, 210, 261, 261, 261, 305, 305, 350, 436, 436, 436), angle=c(135, 225, 45, 315, 225, 135, 225, 45, 135, 225, 315, 45, 135, 225, 315, 22, 315, 225, 45, 293, 45, 22, 135, 315))
highlighted_neutral <- data.frame(num=c(350), angle=c(315))

show_street_data(cristina, all_data, TRUE, highlighted_positive, best_folder, worst_folder, highlighted_neutral)
cat("<div class=\"col-xs-12\" style=\"height:300px;\"></div>")
```

Descrição da rua

* Média/mediana: 4.92/5.12 > 4.68/4.82 -> rua de mediana para boa
* Variação no surprise? Variações ao longo da rua, alternando locais legais e não tão legais
* Lado melhor? Side1 (8) x Side2 (5)
* Região melhor? não fica claro no surprise, mas **nos scores pode-se falar do 66 ao 261**
   
   
#\#\#\# Rua 2

Ponto máximo e mínimo

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
floriano <- dplyr::filter(all_data, street == "Av._Mal._Floriano_Peixoto") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)

cat("<br/>")
max_point <- filter(floriano, qscore == max(floriano$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#00ff00","\">", sep=""))
cat("<img src='", as.character(max_point$url),"' width='600px'>", sep = "")#paste(best_folder, max_point$photo_name, sep="")
cat("<p style=\"color:black;font-size:90%\">", max_point$num, "- ", max_point$angle, "-", max_point$qscore,  "</p>", sep="")
cat("</div>")

min_point <- filter(floriano, qscore == min(floriano$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#000000","\">", sep=""))
cat("<img src='", as.character(min_point$url),"' width='600px'>", sep = "")#as.character(min_point$url)
cat("<p style=\"color:white;font-size:90%\">", min_point$num, "- ", min_point$angle, "-", min_point$qscore,  "</p>", sep="")
cat("</div>")

cat("<br/>")
```

Pontos notáveis destacados por ponto na rua

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
cat("<br/>")

highlighted_positive <- data.frame(num=c(445, 445, 549, 549, 691, 691, 691, 691, 813, 913, 913), angle=c(22, 112, 112, 203, 22, 112, 203, 293, 112, 112, 203))
highlighted_neutral <- data.frame(num=c(), angle=c())

show_street_data(floriano, all_data, TRUE, highlighted_positive, best_folder, worst_folder, highlighted_neutral)
cat("<div class=\"col-xs-12\" style=\"height:300px;\"></div>")
```

Descrição da rua

   * Média/mediana: 5.06/5.04 x 4.69/4.80 -> rua de mediana para boa
   * Variação no surprise? Em cada ponto temos algumas variações ao longo da rua e um ponto mais homogêneo positivamente
   * Lado melhor? Side1 (6) x Side2 (8), side2 ligeiramente melhor
   * Região melhor? Não dá para identificar pelo surprise, pelos **scores poderia-se dizer do 552 ao 694?**
   
   
#\#\#\# Rua 3

Ponto máximo e mínimo

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
edesio <- dplyr::filter(all_data, street == "R._Edésio_Silva") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)

cat("<br/>")
max_point <- filter(edesio, qscore == max(edesio$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#00ff00","\">", sep=""))
cat("<img src='", as.character(max_point$url),"' width='600px'>", sep = "")#as.character(max_point$url)
cat("<p style=\"color:black;font-size:90%\">", max_point$num, "- ", max_point$angle, "-", max_point$qscore,  "</p>", sep="")
cat("</div>")

min_point <- filter(edesio, qscore == min(edesio$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#000000","\">", sep=""))
cat("<img src='", as.character(min_point$url),"' width='600px'>", sep = "")#as.character(min_point$url)
cat("<p style=\"color:white;font-size:90%\">", min_point$num, "- ", min_point$angle, "-", min_point$qscore,  "</p>", sep="")
cat("</div>")

cat("<br/>")
```

Pontos notáveis destacados por ponto na rua

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
cat("<br/>")

highlighted_positive <- data.frame(num=c(70, 306, 306, 602, 602, 1546, 1546, 1546, 1546), angle=c(22, 22, 203, 22, 315, 22, 135, 203, 315))
highlighted_neutral <- data.frame(num=c(306, 602, 1136), angle=c(135, 135, 315))

show_street_data(edesio, all_data, TRUE, highlighted_positive, best_folder, worst_folder, highlighted_neutral)
cat("<div class=\"col-xs-12\" style=\"height:300px;\"></div>")
```

Descrição da rua

   * Média/mediana: 4.70/4.73 x 4.69/4.80 -> mediana
   * Variação no surprise? 3 lugar (heterogenea)
   * Lado melhor? 
   * Região melhor? 1546
   
#\#\#\# Rua 4

Ponto máximo e mínimo

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
maciel <- dplyr::filter(all_data, street == "R._Maciel_Pinheiro") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)

cat("<br/>")
max_point <- filter(maciel, qscore == max(maciel$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#00ff00","\">", sep=""))
cat("<img src='", as.character(max_point$url),"' width='600px'>", sep = "")#
cat("<p style=\"color:black;font-size:90%\">", max_point$num, "- ", max_point$angle, "-", max_point$qscore,  "</p>", sep="")
cat("</div>")

min_point <- filter(maciel, qscore == min(maciel$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#000000","\">", sep=""))
cat("<img src='", as.character(min_point$url),"' width='600px'>", sep = "")#
cat("<p style=\"color:white;font-size:90%\">", min_point$num, "- ", min_point$angle, "-", min_point$qscore,  "</p>", sep="")
cat("</div>")

cat("<br/>")
```

Pontos notáveis destacados por ponto na rua

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
cat("<br/>")

highlighted_positive <- data.frame(num=c(130, 190, 190, 190, 248, 248, 284, 360), angle=c(90, 90, 360, 270, 90, 180, 180, 360))
highlighted_neutral <- data.frame(num=c(130, 130, 284, 284, 360), angle=c(180, 270, 90, 360, 90))

show_street_data(maciel, all_data, TRUE, highlighted_positive, best_folder, worst_folder, highlighted_neutral)
cat("<div class=\"col-xs-12\" style=\"height:300px;\"></div>")
```

Descrição da rua

   * Média/mediana: 4.77/4.77 x 4.69/4.80 -> mediana para boa?
   * Variação no surprise? 2 menor (homogenea)
   * Lado melhor? 
   * Região melhor? 130, 190
   
#\#\#\# Rua 5

Ponto máximo e mínimo

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
inacio <- dplyr::filter(all_data, street == "R._Inácio_Marquês_da_Silva") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)

cat("<br/>")
max_point <- filter(inacio, qscore == max(inacio$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#00ff00","\">", sep=""))
cat("<img src='", as.character(max_point$url),"' width='600px'>", sep = "")#
cat("<p style=\"color:black;font-size:90%\">", max_point$num, "- ", max_point$angle, "-", max_point$qscore,  "</p>", sep="")
cat("</div>")

min_point <- filter(inacio, qscore == min(inacio$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#000000","\">", sep=""))
cat("<img src='", as.character(min_point$url),"' width='600px'>", sep = "")#
cat("<p style=\"color:white;font-size:90%\">", min_point$num, "- ", min_point$angle, "-", min_point$qscore,  "</p>", sep="")
cat("</div>")

cat("<br/>")
```

Pontos notáveis destacados por ponto na rua

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
cat("<br/>")

highlighted_positive <- data.frame(num=c(2, 54, 54, 120, 120, 120, 199, 199, 199, 239, 239, 239, 239, 300, 300, 300, 360, 360, 434), angle=c(203, 112, 22, 112, 22, 293, 112, 180, 293, 22, 90, 203, 270, 10, 293, 180, 22, 270, 112))
highlighted_neutral <- data.frame(num=c(160, 160, 160, 160, 199, 360, 360, 500, 500), angle=c(22, 112, 203, 293, 10, 90, 203, 90, 270))

show_street_data(inacio, all_data, TRUE, highlighted_positive, best_folder, worst_folder, highlighted_neutral)
cat("<div class=\"col-xs-12\" style=\"height:300px;\"></div>")
```

Descrição da rua

   * Média/mediana: 4.72/4.83 x 4.69/4.80 -> mediana
   * Variação no surprise? 2 maior (heterogenea)
   * Lado melhor? 
   * Região melhor? 199, 239, 300

#\#\#\# Rua 6

Ponto máximo e mínimo

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
manoel <- dplyr::filter(all_data, street == "R._Manoel_Pereira_de_Araújo") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)

cat("<br/>")
max_point <- filter(manoel, qscore == max(manoel$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#00ff00","\">", sep=""))
cat("<img src='", as.character(max_point$url),"' width='600px'>", sep = "")#
cat("<p style=\"color:black;font-size:90%\">", max_point$num, "- ", max_point$angle, "-", max_point$qscore,  "</p>", sep="")
cat("</div>")

min_point <- filter(manoel, qscore == min(manoel$qscore))
cat(paste("<div class='col-xs-6' style=\"background-color:", "#000000","\">", sep=""))
cat("<img src='", as.character(min_point$url),"' width='600px'>", sep = "")#
cat("<p style=\"color:white;font-size:90%\">", min_point$num, "- ", min_point$angle, "-", min_point$qscore,  "</p>", sep="")
cat("</div>")

cat("<br/>")
```

Pontos notáveis destacados por ponto na rua

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
cat("<br/>")

highlighted_positive <- data.frame(num=c(188, 222, 300, 370, 392, 392), angle=c(22, 203, 315, 135, 293, 112))
highlighted_neutral <- data.frame(num=c(188, 188, 222, 300, 370, 392), angle=c(135, 315, 315, 203, 203, 22))

show_street_data(manoel, all_data, TRUE, highlighted_positive, best_folder, worst_folder, highlighted_neutral)
cat("<div class=\"col-xs-12\" style=\"height:300px;\"></div>")
```

Descrição da rua

   * Média/mediana: 3.69/3.64 x 4.69/4.80 -> ruim
   * Variação no surprise? mais homogenea
   * Lado melhor? 
   * Região melhor? 188, 222 e 392