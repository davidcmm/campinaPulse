---
title: "analisaPorRua"
output:
  html_document:
    self_contained: no
---

```{r setup, include=FALSE}
library("vioplot")
library("ggplot2")
library("dplyr")
```

# Impressão Geral das Ruas

Se formos olhar os ICs por rua:

```{r}
data <- read.csv("qscores-df.csv", header = TRUE)

edesio_scores = filter(data, street == "R._Edésio_Silva")$qscore
edesio_sd = sd(edesio_scores)
inacio_scores = filter(data, street == "R._Inácio_Marquês_da_Silva")$qscore
inacio_sd = sd(inacio_scores)
manoel_scores = filter(data, street == "R._Manoel_Pereira_de_Araújo")$qscore
manoel_sd = sd(manoel_scores)
maciel_scores = filter(data, street == "R._Maciel_Pinheiro")$qscore
maciel_sd = sd(maciel_scores)

new_frame = data.frame(mean_scores = c(mean(maciel_scores), mean(manoel_scores), mean(edesio_scores), mean(inacio_scores)), street = c("Maciel", "Manoel", "Edesio", "Inacio"), ci = c(maciel_sd * 1.96 / length(maciel_scores),  manoel_sd * 1.96 / length(manoel_scores), edesio_sd * 1.96 / length(edesio_scores), inacio_sd * 1.96 / length(inacio_scores)))

ggplot(new_frame, aes(x=street, y=mean_scores, fill=street)) + 
    geom_bar(position=position_dodge(), stat="identity") +
    geom_errorbar(aes(ymin=mean_scores-ci, ymax=mean_scores+ci),
                  width=.2,                    # Width of the error bars
                  position=position_dodge(.9))

```

- A Manoel P. de Araújo realmente está bem abaixo das demais ruas
- As outras três ruas possuem valores médios próximos, que podem ser confundíveis

E aqui surge então uma questão: será que apesar dessa semelhança nas médias, essas três ruas são similares assim? Para isso computamos os violin plots de cada rua.

```{r }
value <- data$qscore

with(data , vioplot( value[street=="R._Inácio_Marquês_da_Silva"] , value[street=="R._Edésio_Silva"], value[street=="R._Manoel_Pereira_de_Araújo"], value[street=="R._Maciel_Pinheiro"],  col=rgb(0.1,0.4,0.7,0.7) , names=c("R._Inácio_Marquês_da_Silva","R._Edésio_Silva","R._Manoel_Pereira_de_Araújo", "R._Maciel_Pinheiro") ))
```

A partir da análise dos violin plots, alguns pontos podem ser destacados:

- A Manoel P. de Araújo foi realmente a rua com as notas em gerais mais baixas o pode ser um indicativo de problema na rua. Analisando com mais cuidado as imagens da rua mais abaixo, pode-se perceber que esses valores baixos eram esperados, já que se trata de uma área antiga e pouco cuidada do centro da cidade (bem degradada!);
- A Inacio Marques e a Edesio silva tiveram valores mais espalhados com uma maior concentração em algumas regiões, o que era esperado dado variações nos tipos de locais nessas ruas (mais ou menos verde, mais ou menos conservados);
- A Maciel Pinheiro tem uma maior concentração de valores com notas parecidas, o que era esperado dado a maior semelhança de locais ao longo de toda a rua. Isso a torna mais homogênea que a Inacio e a Edesio, porém mais heterogênea que a Manoel P. de Araujo;
- A Inacio, Edesio e Maciel possuem QScores que variam em 2 ou mais pontos. Essa grande variação merece ser analisada com mais cuidado já que pode ser um indicativo de problemas nas ruas!

Para complemento numérico dos violin plots, o sumário de cada rua na seguinte ordem: Inacio, Edesio, Maciel e Manoel.
```{r }
summary(filter(data, street == "R._Inácio_Marquês_da_Silva")$qscore)
summary(filter(data, street == "R._Edésio_Silva")$qscore)
summary(filter(data, street == "R._Maciel_Pinheiro")$qscore)
summary(filter(data, street == "R._Manoel_Pereira_de_Araújo")$qscore)
```


# Analisando em detalhe cada rua

Para entender um pouco melhor cada rua, tentamos analisar os QScores obtidos ao longo da rua.

## Inacio Marques

```{r }
summary_inacio = filter(data, street == "R._Inácio_Marquês_da_Silva") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_edesio = filter(data, street == "R._Edésio_Silva") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_maciel = filter(data, street == "R._Maciel_Pinheiro") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_manoel = filter(data, street == "R._Manoel_Pereira_de_Araújo") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
```

```{r }
summary_inacio
```
Para a Inacio Marques percebemos uma **variação de aproximadamente 1.7** nas médias do QScore do número 500 (região de muros logo após o museu) e do número 239 (regiao residencial no quarteirão seguinte ao museu). Esta diferença parece um indicativo de variação entre tipos, ou qualidades, de locais na rua.

Analisando os scores de cada ângulo em cada ponto da rua, pode-se observar **diferenças de 1 ou mais pontos no QScore entre ângulos do mesmo número**. Por exemplo:

- no número 54, as variações para os ângulos 203 e 293
- no número 120 a baixa nota do ângulo 203
- no número 239 existe uma maior homogeneidade, de forma positiva
- no número 360 os números 90 e 203 
- no número 500 também temos uma maior homogeneidade, de forma negativa

```{r results='asis', echo=FALSE, out.extra=''}
library("knitr")
inacio <- filter(data, street == "R._Inácio_Marquês_da_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)

show_street_data <- function (current_df){
    cat("<div class='row'>")
    for(i in 1:nrow(current_df)) {
      row <- current_df[i,]
      url <- as.character(row$url)
      street <- as.character(row$street)
      num <- row$num
      angle <- row$angle
      score <- row$qscore
      cat("<div class='col-xs-3'>")
      cat("<img src='", url,"' width='300px'>", sep = "")
      cat("<div class='caption'>", street, " " , num , ", ", angle, " -> ", score,  "</div>", sep="")
      cat("</div>")
      if (i > 1 && i %% 4 == 0){
        cat("</div>")
        cat("<div class='row'>")
      }
    }
}

show_street_data(inacio)

```


Com esse nível de detalhe conseguimos perceber que a Inácio Marques é uma rua que possui uma área muito pouco cuidada (número 500) e outras áreas com níveis de cuidado variados, onde poderíamos apontar setores nos números 54, 120 e 360, principalmente, que poderiam receber melhores cuidados.

Analisando de forma geral as fotos percebemos que, conforme esperado, os locais com menor conservação e menos verde apresentam QScores mais baixos, indicando que ações de melhoria/cuidado poderiam ser direcionados para essas áreas. 

A partir do diagonóstico com base nos dados de percepção podemos olhar as fotos, ou o próprio local, e perceber que:

- No número 500 temos terrenos e construções/muros pouco cuidados;
- No número 360, angulos 90 e 203 temos terrenos que precisam de maiores cuidados, contrapostos a uma bela visão proporcionada pela presença do museu e sua vegetação melhor cuidada;
- No número 120, ângulos 203 temos lixo e melhoria necessária nas construções, e no ângulo 112 temos mais uma indicação de melhoria em construção/construção inacabada contraposta com outras construções bem cuidadas e com verde;
- No número 54, ângulos 203 e 293 temos vegetação pouco cuidada, lixo e construções que precisam de melhorias.

## Edesio Silva

```{r}
summary_edesio
```

Para a Edesio percebemos **uma variação de aproximadamente 1.4** nas médias do QScore do número 1136 (terreno, pouco cuidada) e do número 1546 (casas mais novas, bem cuidadas). Esta diferença parece um indicativo de variação entre tipos, ou qualidades, de locais na rua.

Analisando os scores de cada ângulo em cada ponto da rua, pode-se observar **diferenças de 1 ou mais pontos no QScore entre ângulos do mesmo número**. Por exemplo:

- no número 70, as variações do angulo 22 com os demais
- no número 306 a baixa nota do ângulo 315
- no número 602 as melhores notas dos ângulos 22 e 315
- no número 1136 temos uma maior homogeneidade, de forma negativa
- no número 1546 temos uma maior homogeneidade, de forma positiva

```{r results='asis', echo=FALSE, out.extra=''}
edesio <- filter(data, street == "R._Edésio_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)
show_street_data(edesio)
```

Com esse nível de detalhe conseguimos perceber que a Edesio Silva é uma rua que possui uma área muito pouco cuidada (número 1136) e outras áreas com níveis de cuidado variados, onde poderíamos apontar setores nos números 70, 602 que poderiam ser melhor cuidados. 

Analisando de forma geral as fotos percebemos que, conforme esperado, os locais com menor conservação e menos verde apresentam QScores mais baixos, indicando que ações de melhoria/cuidado poderiam ser direcionados para essas áreas. Um fato interessante é que, por exemplo, no número 1136, 315 a presença de uma casa em melhor estado de conservação melhora razoavelmente a nota desta cena apesar de termos um terreno vazio ao lado da casa. 

A partir do diagonóstico com base nos dados de percepção podemos olhar as fotos, ou o próprio local, e perceber que:

- No número 70, angulo 135 existe uma construção inacabada que afeta a vista da rua, que nos angulos 135 e 203 existe lixo na rua, que nos angulos 135, 203 e 315 existem algumas casas que precisam de melhor cuidado e falta verde na rua ;
- No número 306, angulo 315 existem casas pouco cuidadas;
- No número 602, angulo 203 temos um terreno com lixos, angulo 135 temos alem de um muro pouco cuidado uma falta de verde (apesar de termos arvores em crescimento!);
- No número 1136, angulos 22, 135 e 203 temos problemas de terrenos, lixo e casas pouco cuidadas;

## Maciel Pinheiro

```{r }
summary_maciel
```

Para a Maciel percebemos **uma variação de aproximadamente 0.5** nas médias do QScore do número 248 e do número 190. Esta diferença parece um indicativo de variações sutis de preferências dos usuários por fachadas de lojas, quantidade de carros, dentre outros.

Analisando os scores de cada ângulo em cada ponto da rua, pode-se observar **diferenças de 1 ou mais pontos** no QScore entre ângulos do mesmo número. Por exemplo:

- No número 360, temos uma nota mais alta para o ângulo 360;
- No número 284, temos uma nota mais baixa para o ângulo 270;
- No número 248, temos uma nota mais baixa para o ângulo 360;
- No número 190, temos uma nota mais baixa para o ângulo 180;
- No número 130, temos uma nota mais baixa para o ângulo 270

```{r results='asis', echo=FALSE, out.extra=''}
maciel <- filter(data, street == "R._Maciel_Pinheiro") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)
show_street_data(maciel)
```
Para a Maciel Pinheiro

## Manoel Pereira

```{r }
summary_manoel
```

```{r results='asis', echo=FALSE, out.extra=''}
manoel <- filter(data, street == "R._Manoel_Pereira_de_Araújo") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)
show_street_data(manoel)
```