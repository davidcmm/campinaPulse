<style>    
  .streetViewChoice {
      cursor: pointer;
      border: 3px solid #fff;
  }
  .streetViewChoice:hover, .streetViewChoice.hovered {
    cursor: pointer;
    border: 3px solid #FF4500;
  }
  .streetViewChoice:focus {
    outline: none;
  }
  .streetViewChoice2 {
    cursor: pointer;
    border: 3px solid #fff;
  }
  .streetViewChoice2:hover,.streetViewChoice2.hovered {
    cursor: pointer;
    border: 3px solid #1E90FF;
  }
  .streetViewChoice2:focus {
    outline: none;
  }
  .choice_button {
    width: 50px;
    height: 50px;
    line-height: 50px;
    font-size: 30px;
    font-weight: bold;
    color: #4E4E4E;
    background-color: #CFCFCF;
    text-align: center;
    border-radius: 4px;
    border: 2px solid #fff;
    margin-top: 20px;
    -webkit-transition: color,border 0.2s ease-in;
    -moz-transition: color,border 0.2s ease-in;
    -o-transition: color,border 0.2s ease-in;
    transition: color,border 0.2s ease-in;
    -moz-user-select: none;
    -webkit-user-select: none;
  }
  .choice_button:hover {
    border: 2px solid #000000;
    text-decoration: none;
    color: black;
  }
  .choice_button:focus {
    outline: none;
  }
  .mybadge {
    color: #fff !important;
    background-color: #959595;
    border: 1px solid #959595;
    margin: 0 3px 3px 0;
    padding: 0 6px 0 3px;
    display: inline-block;
    text-decoration: none;
    white-space: nowrap;
    line-height: 24px;
    border-radius: 6px;
  }  
  .badge1, .badge2, .badge3 {
    display: inline-block;
    width: 6px;
    height: 11px;
    overflow: hidden;
    line-height: inherit;
    background-position: -40px -1034px;
    vertical-align: text-bottom;
    margin: 0 1px 1px 3px;
  }  
</style>

<div class="row">
  <!-- Success and Error Messages for the user --> 
  <div class="span6 offset2" style="height:50px">
    <div id="success" class="alert alert-success" style="display:none;">
      <a class="close">×</a>
      <strong>Ótimo!</strong> Sua resposta foi salva
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
      <a class="close">×</a>
      Carregando próxima tarefa...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
      <strong>Tarefa completada!</strong> Obrigado!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
      <strong>Parabéns!</strong> Você completou todas as tarefas!
      <br/>
      <div class="alert-actions">
        <a class="btn small" href="/pybossa">Volte</a>
        <a class="btn small" href="pybossa/app/category/thinking/">ou, Veja outras aplicações</a>
      </div>
    </div>
    <div id="error" class="alert alert-error" style="display:none;">
      <a class="close">×</a>
      <strong>Erro!</strong> Algo errado, entre em contato com os administradores
    </div>
  </div> <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<div class="row">
  <div class="span12"> <!-- Tutorial indicating how application works! -->
    <div class="modal fade" id="modal2" tabindex="-1" role="dialog" aria-labelledby="Instruções" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Instruções Como é Campina?</h4>
          </div>
          <div class="modal-body" style="overflow: auto;height: 500px;">
            <div id="m0" class="modal-body" style="display:none">
              <p> Duas fotos da cidade de Campina Grande, Paraíba, serão apresentadas lado a lado: </p>
              <div class="row skeleton"> 
                <div class="col-xs-6 col-lg-6 text-center"> 
                  <img src="https://contribua.org/bairros/oeste/liberdade/Rua_Acre__635_270.jpg" class="img-polaroid" style="width:250px; height:200px"/>
                </div>
                <div class="col-xs-6 col-lg-6 text-center">
                  <img src="https://contribua.org/bairros/oeste/liberdade/Rua_Sergipe__1337_90.jpg" class="img-polaroid" style="width:250px; height:200px"/>
                </div>
              </div>
              <br>
              <p> Para cada par de fotos você poderá responder a uma das seguintes questões: </p>
              <ul>
                <li> Qual local lhe parece mais
                  <font color="DodgerBlue"> seguro? </font>
                </li>
                <li> Que local lhe parece mais 
                  <font color="OrangeRed"> agradável? </font> 
                </li>
              </ul>
              <p> Cada pergunta é apresentada em uma cor diferente de modo a facilitar sua percepção quando a pergunta for alterada! </p>
              <p> Para responder a pergunta basta clicar em uma das fotos ou na seta que indica o lado da foto escolhida! Analise bem cada uma das imagens de modo a escolher aquela que melhor responde à pergunta apresentada. </p>
              <p><font color="Red">Importante! </font> 
                Se você não conseguir escolher a foto que melhor responde à pergunta basta clicar no botão de igual (<img src="https://contribua.org/icones/botao3.jpg" style="width: 10%; height: 10%"/>).
              </p>
              <p> A cada 10 questões respondidas, nós iremos lhe fazer  algumas perguntas sobre seu perfil! Ajude-nos a conhecer um pouco mais sobre você!
              </p>      
            </div>
          </div>
          <div class="modal-footer">
            <button id="startContrib2" type="button" class="btn btn-primary" data-dismiss="modal">Tente!</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="span12"> <!-- Showing user performance and sharing options! -->
    <div class="modal fade" id="modal3" tabindex="-1" role="dialog" aria-labelledby="Desempenho" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Seu desempenho!</h4>
          </div>

          <div class="modal-body" style="overflow: auto;height: 50%;">
            <div id="d0" class="modal-body" style="display:none">
	      <p><span id="praise"></span> Você já completou <span id="done" class="label label-info" style="background: #3ACABB"></span> tarefas! Será que algum amigo seu pode nos ajudar também? Compartilhe!
              </p>
	     <p align="Center"><a href="https://www.facebook.com/sharer/sharer.php?u=https://contribua.org/pybossa/project/comoecampina" target="_blank" class="share-icons" 	title="Compartilhe no Facebook"><img src="https://contribua.org/aguanossa/images/facebook.png" /> Compartilhe no Facebook!</a> </p>  <!-- https://developers.facebook.com/docs/javascript/reference/FB.ui https://developers.facebook.com/docs/sharing/webmasters#markup -->
            <p align="Center">
            <a href="http://twitter.com/share?text=Ajude%20a%20gerara%20informaçãoa%20paraa%20melhorar%20Campina%20avaliando%20fotos%20da%20cidade%21&url=https://contribua.org/pybossa/project/comoecampina" target="_blank" class="share-icons" title="Compartilhe no Twitter"><img src="https://contribua.org/aguanossa/images/twitter.png"/> Compartilhe no Twitter!</a> </p>
            </div>
          </div>

          <div class="modal-footer">
            <button id="startContrib3" type="button" class="btn btn-primary" data-dismiss="modal">Continue!</button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<div class="row"> <!-- Start Skeleton Row-->
  <div id="modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="Instruções" aria-hidden="true"> <!-- style="display:block" -->
    <div class="modal-dialog modal-lg">
      <div class="modal-content"> 
        <div class="modal-body" style="overflow: auto;height: 500px;">
          <div id="0" class="modal-body" style="display:none">
            <!-- Start Skeleton Row-->
          </div>
          <div id="1" class="modal-body" style="display:none">
            <div class="row">
              <h2 align="center"> <img src="https://contribua.org/icones/profile.jpg" style="width: 21px; height: 32px"/> Conte-nos um pouco mais sobre você!</h2>       
            </div>
            <p> Preenchimento do seu perfil </p> 
            <div class="progress">
              <div class="progress-bar bar" id="progress2" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 50%;"></div>
            </div>
            
            <div>
              <div>
                <form id="eventInsForm" accept-charset="UTF-8">
                  <div class="form-group">
                    <label for="userage">Idade:</label>
                      <input class="form-control" name="user1" id="userage" type="number" min="1" max="120" step="1"value="0">
                  </div>
                  <div class="form-group">
                    <label for="usersex">Sexo:</label>
                    <select class="form-control" name="user2" id="usersex">
                      <option>Masculino</option>  
                      <option>Feminino</option>  				
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="userrel">Estado Civil:</label>
                    <select class="form-control" name="user7" id="userrel">
                      <option>Casado</option>  
                      <option selected>Solteiro</option>  
                      <option>Divorciado</option>				
                      <option>Viúvo</option>				
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="userclass">Classe Social (renda mensal):</label>
                    <select class="form-control" name="user3" id="userclass"> <!-- http://blog.thiagorodrigo.com.br/index.php/faixas-salariais-classe-social-abep-ibge?blog=5 --> 
                      <option>Alta (R$ 14.500 ou mais)</option>  
                      <option>Média Alta (R$ 7.250 a R$ 14.499,99)</option>  
                      <option selected>Média (R$ 2.900 a R$ 7.249,99)</option>  
                      <option>Média Baixa (R$ 1.450 a R$ 2.899,99)</option>  
                      <option>Baixa (até R$ 1.449,99)</option>  
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="usereduc">Qual seu grau de formação?</label>
                    <select class="form-control" name="user4" id="usereduc">  
                      <option>Doutorado</option>  
                      <option>Mestrado</option>  
                      <option selected>Graduação</option>  
                      <option>Ensino Médio</option>  
                      <option>Ensino Fundamental</option>  
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="autocomplete">Moro em (cidade): </label>
                    <input class="form-control" id="autocomplete" placeholder="Digite aqui" type="text"/>
                  </div>  
                  <div class="form-group">
                    <label for="usercitytime">Há quanto tempo mora na cidade? (em anos) </label> 
                    <input class="form-control" name="user6" id="usercitytime" type="number" min="1" max="120" step="1" value="0"/>
                  </div>
                  <div class="form-group">
                      <label>Quais desses bairros você frequenta? </label> 
                      <div class="checkbox">
                        <label for="lib">
                          <input name="group1" type="checkbox" id="cen" value="cen" />
                          <font size="3">Centro</font>
                        </label>
                      </div>
                      <div class="checkbox">
                        <label for="lib">
                          <input name="group3" type="checkbox" id="lib" value="lib" />
                          <font size="3">Liberdade</font>
                        </label>
                      </div>
                      <div class="checkbox">
                        <label for="cat">
                          <input name="group4" type="checkbox" id="cat" value="cat" />
                          <font size="3">Catolé</font>
                        </label>
                      </div>
                  </div> 
                  
                </form>
              </div>
            
            </div>
          </div> 
          <div class="modal-footer">
            <a id="startContrib" href="#" class="btn btn-primary"><i class="icon-thumbs-up"></i> Continuar!</a>
          </div>
        </div>
      </div> 
    </div>  
  </div>
</div>

<!--<div class="row skeleton">
<div class="span12">
<button id="changeQuest" class="btn btn-primary btn-medium" value='change' style="width: 20%; margin-left: 80%" ><i class="icon icon-white icon-question-sign"></i> Alterar pergunta</button>
</div>
</div> -->

<div class="row skeleton">
  <div class="span12">
    <!-- <h1 style="width: 500px; position: relative; left: 30%; margin-left: -70px;">Qual local lhe parece mais</h1> <h1 style="width: 100px; position: relative; left: 30%; margin-left: -70px;"> <font color=”red”> seguro? </font> </h1> -->
    <p align="center"> <font size="6" id="questCommon">Qual local lhe parece mais</font> <font size="6" id="question" style="position: relative; margin-left: 5px;" color="DodgerBlue">  </font> </p>
  </div>
</div>
<br>
<!--
Task DOM for loading the Flickr Images
It uses the class="skeleton" to identify the elements that belong to the
task.
-->
<div id="photos" class="skeleton"> <!-- Start Skeleton Row-->
  <div class="row">
    <div class="col-xs-6 col-lg-6 text-center"><!-- Start of Photo DIV (column) -->
      <a id="photo-link" href="#">  
        <img id="photo" src="https://img339.imageshack.us/img339/9017/  loadingo.png">
      </a>
    </div><!-- End of Photo DIV (columnt) -->
    <div class="col-xs-6 col-lg-6 text-center"><!-- Start of Photo DIV (column) -->
      <a id="photo-link2" href="#">
        <img id="photo2" src="https://img339.imageshack.us/img339/9017/loadingo.png">
      </a>
    </div><!-- End of Photo DIV (columnt) -->
  </div>
</div><!-- End of Skeleton Row -->

<!--<div class="row skeleton"> 
<br>  
<div class="span12 ">
<div id="answer"> 
<button id="notknown" class="choice_button" value='NotKnown' style="width: 15%; margin-left: 45%; margin-right: 40%" ><i class="icon icon-white"></i> = </button>
 
</div>
</div>
</div> -->
<div class="skeleton"> <!-- Start Skeleton Row-->
  <div class="row">
    <!-- Start of Question and Submission DIV (column) -->
    <div id="answer" style="padding-top: 3%;"> <!-- Start DIV for the    submission buttons -->
      <!-- If the user clicks this button, the saved answer will be value="yes"-->
      <!-- <button class="btn btn-answer" value='Left'><i class="icon icon-white"></i>Local da esquerda</button> -->
      <!-- If the user clicks this button, the saved answer will be value="no"-->
       <!-- <button class="btn btn-answer" value='Right'><i class="icon icon-white"></i>Local da direita</button> -->
      <!-- If the user clicks this button, the saved answer will be value="NotKnown"-->
      <div class="col-xs-4">
        <button type="button" id="left" class="btn btn-primary btn-lg" value='left' style="width: 100%;"><span class="glyphicon glyphicon-circle-arrow-left" aria-hidden="true"></span></button>
      </div>
      <div class="col-xs-4">
        <button type="button" id="notknown" class="btn btn-primary btn-lg" value='NotKnown' style="width: 100%;"><strong>=</strong></button>
      </div>
      <div class="col-xs-4">
        <button type="button" id="right" class="btn btn-primary btn-lg" value='right' style="width: 100%;"><span class="glyphicon glyphicon-circle-arrow-right" aria-hidden="true"></span></button>
      </div>
    </div><!-- End of DIV for the submission buttons -->
  </div><!-- End of Skeleton Row -->
</div>

<div class="row skeleton"> <!-- Start Skeleton Row-->
  <div class="span6 "><!-- Start of Question and Submission DIV (column) -->
  <br>

  <!-- Feedback items for the user -->
  <!-- <p>Você está na tarefa: <span id="task-id" class="label label-warning">#</span></p> -->
  <!--<p>Você já completou <span id="done2" class="label label-info" style="background: #3ACABB"></span> tarefas <!-- de -->
  <!-- Progress bar for the user -->
  <!-- <span id="total" class="label label-inverse"></span></p> -->
  <!--<div class="progress progress-striped" style="background: LightGray">
      <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%; background: yellowgreen"></div>
  </div>-->
  <!-- 
      This application uses Disqus to allow users to provide some feedback.
      The next section includes a button that when a user clicks on it will
      load the comments, if any, for the given task
  -->
  <!-- <div id="disqus_show_btn" style="margin-top:5px;"> -->
      <!-- <button class="btn btn-primary btn-large btn-disqus" onclick="loadDisqus()"><i class="icon-comments"></i> Show comments</button> -->
      <!-- <button class="btn btn-large btn-disqus" onclick="loadDisqus()" style="display:none"><i class="icon-comments"></i> Hide comments</button> -->
  <!-- </div> --><!-- End of Disqus Button section -->
  <!-- Disqus thread for the given task -->
  <!-- <div id="disqus_thread" style="margin-top:5px;display:none"></div> -->
  </div><!-- End of Question and Submission DIV (column) -->
</div><!-- End of Skeleton Row -->

<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

  /* * * DON'T EDIT BELOW THIS LINE * * */
  function loadDisqus() {
    $("#disqus_thread").toggle();
    $(".btn-disqus").toggle();
    var disqus_shortname = 'pybossa'; // required: replace example with your forum shortname
    //var disqus_identifier = taskId;
    var disqus_developer = 1;

    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  }

</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>

<script charset="UTF-8">
  //Adding head elements
  $('head').append('<meta charset="UTF-8">'); 
  
  //Google autocomplete
  var cityInput = document.getElementById('autocomplete');
  var autocomplete = new google.maps.places.Autocomplete(cityInput);
  var pacContainerInitialized = false; 
  $('#autocomplete').keypress(function() { 
    if (!pacContainerInitialized) { 
      $('.pac-container').css('z-index', '10000'); 
    pacContainerInitialized = true;  
  } 
}); 


//Showing application tutorial
function showTutorial(action) {
  //Checking if tutorial should be presented or not
  var cookiesData = document.cookie.split(";");

  var showTutorial = "";
  for (i=cookiesData.length-1; i >= 0; i--){
    var currentData = cookiesData[i].split("=");
    if(currentData[0].trim() == "tutorial"){
      showTutorial = currentData[1];
      break;
    } 
  }  

  if (showTutorial.length > 0 && showTutorial.toLowerCase() == "false"){
    return;
  }else{
    $("#modal2").modal('show');
    $("#m0").show();
    $('#startContrib2').show();
    $('#startContrib2').off('click').on('click', function(evt) {
      $("#startContrib2").hide();
      $("#m0").hide();
      $("#modal2").modal('hide');

      //Setting cookies to not show tutorial again
      var date = new Date();
      date.setTime(date.getTime() + (2 * 60 * 1000));
      var expires = date.toUTCString();          
      document.cookie = "tutorial=false;path=/;domain=contribua.org;expires="+expires+";";
  	});		
  } 
}

showTutorial();

//Making buttons to hover images!  
var button = $("#notknown")
button.mouseover(function () {
  $("#photo").addClass("hovered");
  $("#photo2").addClass("hovered");
} );
button.mouseout(function () {
  $("#photo").removeClass("hovered");
  $("#photo2").removeClass("hovered");
} );

var lbutton = $("#left")
lbutton.mouseover(function () {
  $("#photo").addClass("hovered");
});

lbutton.mouseout(function () {
  $("#photo").removeClass("hovered");
});

var rbutton = $("#right")
rbutton.mouseover(function () {
  $("#photo2").addClass("hovered");
});

rbutton.mouseout(function () {
  $("#photo2").removeClass("hovered");
});

//General configuration
endpoint = "/pybossa";
pybossa.setEndpoint(endpoint);  

var showQuestionOptions = true;
var step = 0;

var askForMoreInfo = false;
var userDataToSave = "";  


//Retrieving user profile from previous task execution. URL request to http://socientize.lsd.ufcg.edu.br/pybossa/api/taskrun?app_id=APPID&user_id=USERID&offset=0&limit=100
function getUserData(userID, appID){
  var userData = "";
  var finishTime;
  var shouldBreak = false;
  var offset = 0;	
  //http://contribuatestes.lsd.ufcg.edu.br/pybossa/api/taskrun?app_id="+appID+"&user_id="+userID+"&offset="+offset+"&limit=100""
  while (!shouldBreak) {
    $.ajax({
      url: "https://contribua.org/pybossa/api/taskrun?app_id="+appID+"&user_id="+userID+"&offset="+offset+"&limit=100",
      async: false,
      dataType: 'json',
      success: function(data) {
        var i;
        if(data.length == 0){
          shouldBreak = true;
        }else{
     		  //alert(data[0]);
          for (i = 0; i < data.length; i++) {
            var initIndex = data[i].info.indexOf("{");
        		var currentFinishTime = new Date(data[i].finish_time);
            if(initIndex > -1){
	            var endIndex = data[i].info.indexOf("}");
	            var currentData = data[i].info.substring(initIndex, endIndex+1);
              if (finishTime == null || currentFinishTime > finishTime) {
		             userData = currentData;
                 finishTime = currentFinishTime;
	            }
            }
          }
        }
      }    
    });
    offset += 100;	
  }

  //alert("User Data" + userData);
  return userData;
}

function retrieveNeighborhoods(){
  var neighborhoods = "";
  //Retrieving north zone 
  var group = document.getElementsByName("group1");
  for (i=0; i < group.length ; i++){
    if(group[i].checked){
    neighborhoods += group[i].value+";";
    }
  }
  //Retrieving east zone 
  /*group = document.getElementsByName("group2");
  for (i=0; i < group.length ; i++){
    if(group[i].checked){
      neighborhoods += group[i].value+";";
    }
  }*/

  //Retrieving west zone 
  group = document.getElementsByName("group3");
  for (i=0; i < group.length ; i++){
    if(group[i].checked){
      neighborhoods += group[i].value+";";
    }
  }
  //Retrieving south zone 
  group = document.getElementsByName("group4");
  for (i=0; i < group.length ; i++){
    if(group[i].checked){
      neighborhoods += group[i].value+";";
    }
  }
  if (neighborhoods.length == 0){
  	return neighborhoods;
  }
  return neighborhoods.substr(0, neighborhoods.length-1);
}   

//Showing profile form containg previous information provided  
function showForm(userID, appID){
  var show = false;
  var totalProgress = 0;
  var userData = getUserData(userID, appID);

  if (userData.length == 0) {	
    show = true;   
    loadProfileProgress(0);
    
    $('#startContrib').off('click').on('click', function(evt) {
      //Save captured user data!
      var age = document.getElementById('userage').value;
      var userClass = document.getElementById('userclass').value;
      var userEduc = document.getElementById('usereduc').value;
      var userCity = document.getElementById('autocomplete').value;
      var userCityTime = document.getElementById('usercitytime').value;          
      var userSex = document.getElementById('usersex').value;
      var userRel = document.getElementById('userrel').value;

      //User visiting neighborhoods
      var neighborhoods = retrieveNeighborhoods();

    	userDataToSave = "{age="+age+"|sex="+userSex+"|class="+userClass+"|educ="+userEduc+"|city="+userCity+"|time="+userCityTime+"|rel="+userRel+"|neig="+neighborhoods+"} ";
      $("#startContrib").hide();
      $("#0").hide();
      $("#1").hide();
      $("#modal").modal('hide');
    });
  } else {
    userData = userData.substring(1, userData.length-1);
    var currentData = userData.split("|");

    var currentValue = currentData[0].split("=")[1]; 
    var userAge = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("Age " + userAge);

    currentValue = currentData[1].split("=")[1];  
    var userSex = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("Sex " + userSex);

    currentValue = currentData[2].split("=")[1];  
    var userClass = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("Class " + userClass);

    currentValue = currentData[3].split("=")[1];  
    var userDegree = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("Deg " + userDegree);

    currentValue = currentData[4].split("=")[1];  
    var userCity = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("City " + userCity);

    currentValue = currentData[5].split("=")[1];  
    var userCityTime = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("Tim " + userCityTime);

    currentValue = currentData[6].split("=")[1];  
    var userRel = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("Rel " + userRel);

    if(currentData.length >= 8){
      currentValue = currentData[7].split("=")[1];  
    }else{
      currentValue = null;
    } 
    var userNeigh = ((typeof currentValue == undefined || currentValue == null) ? "" : currentValue);
    //alert("Neigh " + userNeigh);   
    //!(userAge.length > 0 && userClass.length > 0 && userDegree.length > 0 && userCity.length > 0 && userCityTime.length > 0 && userSex.length > 0 && userRel.length > 0 && userNeigh.length > 0)
    if (!(userAge.length > 0 && userClass.length > 0 && userDegree.length > 0 && userCity.length > 0 && userCityTime.length > 0 && userSex.length > 0 && userRel.length > 0 && userNeigh.length > 0)){
        show = true;
      //Setting values already given in the form!
      $("#userage").val(userAge);
      $("#autocomplete").val(userCity);
      $("#usercitytime").val(userCityTime);

      totalProgress += ((userAge.length > 0) ? 1 : 0);
      totalProgress += ((userCity.length > 0) ? 1 : 0);
      totalProgress += ((userCityTime.length > 0) ? 1 : 0);

      if(userClass.length > 0){
        var classField  = document.getElementById('userclass');
        if(classField){
          for(var i=0; i < classField.options.length; i++) { 
            if(classField.options[i].value == userClass) { 
              classField.options[i].selected = true;
              totalProgress += 1;
              break;
            }
          }
        }
      }
      if(userSex.length > 0){
        var classField  = document.getElementById('usersex');
        if(classField){
          for(var i=0; i < classField.options.length; i++) { 
          	if(classField.options[i].value == userSex) { 
          	  classField.options[i].selected = true;
          	  totalProgress += 1;
          	  break;
          	}
          }
        }
      }
      if(userDegree.length > 0){
        var degreeField  = document.getElementById('usereduc');
        if(degreeField){
          for(var i=0; i < degreeField.options.length; i++) { 
          	if(degreeField.options[i].value == userDegree) { 
            	degreeField.options[i].selected = true;
            	totalProgress += 1;
            	break;
          	}
          }
        }
      }
      if(userRel.length > 0){
        var userRelField  = document.getElementById('userrel');
        if(userRelField){
          for(var i=0; i < userRelField.options.length; i++) { 
            if(userRelField.options[i].value == userRel) { 
              userRelField.options[i].selected = true;
              totalProgress += 1;
              break;
            }
          }
        }
      }
      //Loading user neighborhodds already informed
      var neighborhoodsFilled = 0;
      if (userNeigh.length > 0){
        var neighborhoods = userNeigh.split(";");	
    		//alert(neighborhoods);
        for (i=0; i < neighborhoods.length ; i++){          
          //alert(neighborhoods[i]);
          if(neighborhoods[i] != "jpi"){
            neighborhoodsFilled += 1;
          	document.getElementById(neighborhoods[i]).checked = true;
          }
        }
      }
      if(neighborhoodsFilled > 0){
        totalProgress += 1;
      }
      //Loading user profile progress!      	
      loadProfileProgress(totalProgress);
      //Asking for other values!
      $('#startContrib').off('click').on('click', function(evt) {
        //Save captured user data!
        var age = document.getElementById('userage').value;
        var userClass = document.getElementById('userclass').value;
        var userEduc = document.getElementById('usereduc').value;
        var userCity = document.getElementById('autocomplete').value;
        var userCityTime = document.getElementById('usercitytime').value;
        var userSex = document.getElementById('usersex').value;
        var userRel = document.getElementById('userrel').value;

        //User visiting neighborhoods
        var neighborhoods = retrieveNeighborhoods();

        userDataToSave = "{age="+age+"|sex="+userSex+"|class="+userClass+"|educ="+userEduc+"|city="+userCity+"|time="+userCityTime+"|rel="+userRel+"|neig="+neighborhoods+"} ";

        $("#startContrib").hide();
        $("#0").hide();
        $("#1").hide();
        $("#modal").modal('hide');
      });
    }
  }
  //alert("Show "+show); 
  if(show){
    $("#startContrib").show();
    $("#1").show();
  }
  return show;
} 	 

//Retrieving user id
function verifyUserData(appID) {
  var show = false;
  //http://contribuatestes.lsd.ufcg.edu.br/pybossa/account/currentUserInfo
  $.ajax({
    url: "https://contribua.org/pybossa/account/currentUserInfo",
    async: false,
    dataType: 'json',
    success: function(data) {        
      show = showForm(data.info, appID);        
    }    
  });
  return show;
}

//Loading user progress in terms of profile completion in current application
function loadProfileProgress(filled) {
  var pct = Math.round((filled/8)*100);
  //alert(pct);
  $("#progress2").css("width", pct.toString() +"%");
  $("#progress2").attr("title", pct.toString() + "% do perfil está completo!");
  //$("#progress2").tooltip({ 'placement' : 'right' });  		
}

function showPraiseAndShare(data){
    $('#praise').attr("color", "Red");
    if (data.done == 165) {
      $("#praise").text("Você já é um mestre nisso!");        
    }else if (data.done == 105){
      $("#praise").text("Você já é quase um mestre nisso!");        
    } else if (data.done == 75) {
      $("#praise").text("Excepcional!");
    } else if (data.done == 55) {     
      $("#praise").text("Muito Bom!");
    } else if (data.done == 35) {
      $("#praise").text("Estás se aperfeiçoando!");
    } else if (data.done == 15) {
      $("#praise").text("Parabéns!");
    } 

    if (data.done > 15 || data.done == 35 || data.done == 55 || data.done == 75 || data.done == 105 || data.done == 165){
	    $("#modal3").modal('show');
	    $("#d0").show();
	    $('#startContrib3').show();
	    $('#startContrib3').off('click').on('click', function(evt) {
	      $("#startContrib3").hide();
	      $("#d0").hide();
	      $("#modal3").modal('hide');
   	    });
   }
}

//Loading user progress in terms of tasks performed  
function loadUserProgress() {
  pybossa.userProgress('comoecampinav2').done(function(data){
    var pct = Math.round((data.done*100)/300);//data.total
    //$("#progress").css("width", pct.toString() +"%");
    // $("#progress").attr("title", pct.toString() + "% das tarefas!");      

    //$("#total").text(data.total);
    $("#done").text(data.done);
    //$("#done").text(data.done);
    //data.done != 0 && data.done % 10 == 0        
    if (data.done != 0 && data.done % 10 == 0 ) {        
      askForMoreInfo = true;          
    }

    //Choosing praise and presenting share button!
    showPraiseAndShare(data);
  });
}

//Loading task information
pybossa.taskLoaded(function(task, deferred) {
  if ( !$.isEmptyObject(task) ) {
    var photosEnv = document.getElementById("photos");
    photosEnv.setAttribute("style", "width:auto !important");//screen.width*0.72+"px

    // load image from flickr
    var left = $('<img />');
    left.load(function() {
      // continue as soon as the image is loaded
      deferred.resolve(task);
    });
    left.attr('src', task.info.url_c);
    left.attr('id', "photo");
    //left.addClass('streetViewChoice');
    left.attr('style',"width: 100%;")
    task.info.left = left;

    var right = $('<img />');
    right.load(function() {
      // continue as soon as the image is loaded
      deferred.resolve(task);
    });
    right.attr('src', task.info.url_a);
    right.attr('id', "photo2");      
    //right.addClass('streetViewChoice');
    right.attr('style',"width: 100%;")
    task.info.right = right;      
  } else {
    deferred.resolve(task);
  }
});

//Presenting a task to the user
pybossa.presentTask(function(task, deferred) {
  if ( !$.isEmptyObject(task) ) {
    loadUserProgress();

    //At each 10 questions answered check user profile information      
    if (askForMoreInfo){
      step = 1;
      askForMoreInfo = false;
      if(verifyUserData(task.app_id)){
        //alert("Estou habilitando 2");
        $("#modal").modal('show');
      }
    }
    $('#photo-link').html('').append(task.info.left);      
    $('#photo-link2').html('').append(task.info.right);      
    $('#task-id').html(task.id);

    //Changing question color and size
    document.getElementById("questCommon").setAttribute("size", Math.round(0.004166667 * screen.width));
    document.getElementById("question").setAttribute("size", Math.round(0.004166667 * screen.width));

    if(screen.width <= 480){
      document.getElementById("questCommon").setAttribute("style", "margin-left: 0px;");
      document.getElementById("question").setAttribute("style", "margin-left: 0px;");      
    }

    var question = decodeURIComponent(task.info.question).split(" ")[5];
    $('#question').html(question);
    if (question[0] == "s"){
      $('#question').attr("color", "DodgerBlue");
      $('#photo2').addClass('streetViewChoice2');
      $('#photo').addClass('streetViewChoice2');
    }else{
      $('#question').attr("color", "OrangeRed");
      $('#photo2').addClass('streetViewChoice');
      $('#photo').addClass('streetViewChoice');
    }
    
    var perguntaAResponder = task.info.question;

    //Left image chosen
    $('#photo').off('click').on('click', function(evt) {
      var question = perguntaAResponder;
      var answerToSave = userDataToSave+String(question) + " " + "Left" + " " + String(task.info.url_c) + " " + String(task.info.url_a);
      pybossa.saveTask(task.id, answerToSave).done(function() {
        deferred.resolve();
      });

      $("#loading").fadeIn(500);
      if ($("#disqus_thread").is(":visible")) {
        $('#disqus_thread').toggle();
        $('.btn-disqus').toggle();
      }
      userDataToSave = "";        
    });

    //Left image chosen
    $('#left').off('click').on('click', function(evt) {
      var question = perguntaAResponder;
      var answerToSave = userDataToSave+String(question) + " " + "Left" + " " + String(task.info.url_c) + " " + String(task.info.url_a);
      pybossa.saveTask(task.id, answerToSave).done(function() {
        deferred.resolve();
      });
      $("#loading").fadeIn(500);
      if ($("#disqus_thread").is(":visible")) {
        $('#disqus_thread').toggle();
        $('.btn-disqus').toggle();
      }
      userDataToSave = "";  
      var photo = $("#photo");
      photo.removeClass("hovered")
    });

    //Right image chosen
    $('#photo2').off('click').on('click', function(evt) {
      var question = perguntaAResponder;
      var answerToSave = userDataToSave+String(question) + " " + "Right" + " " + String(task.info.url_c) + " " + String(task.info.url_a);
      pybossa.saveTask(task.id, answerToSave).done(function() {
        deferred.resolve();
      });
      $("#loading").fadeIn(500);
      if ($("#disqus_thread").is(":visible")) {
        $('#disqus_thread').toggle();
        $('.btn-disqus').toggle();
      }
      userDataToSave = "";
    });

    //Right image chosen
    $('#right').off('click').on('click', function(evt) {
      var question = perguntaAResponder;
      var answerToSave = userDataToSave+String(question) + " " + "Right" + " " + String(task.info.url_c) + " " + String(task.info.url_a);
      pybossa.saveTask(task.id, answerToSave).done(function() {
        deferred.resolve();
      });

      $("#loading").fadeIn(500);
      if ($("#disqus_thread").is(":visible")) {
        $('#disqus_thread').toggle();
        $('.btn-disqus').toggle();
      }
      userDataToSave = "";
      var photo = $("#photo2");
      photo.removeClass("hovered");
    });
     
    //User could not choose an image!      
    $('#notknown').off('click').on('click', function(evt) {
      var question = perguntaAResponder;
      var answerToSave = userDataToSave+String(question) + " " + "NotKnown" + " " + String(task.info.url_c) + " " + String(task.info.url_a);
      
      pybossa.saveTask(task.id, answerToSave).done(function() {
        deferred.resolve();
      });
      $("#loading").fadeIn(500);
      if ($("#disqus_thread").is(":visible")) {
        $('#disqus_thread').toggle();
        $('.btn-disqus').toggle();
      }
      userDataToSave = "";  
      var photo = $("#photo");
      photo.removeClass("hovered")
      photo = $("#photo2");
      photo.removeClass("hovered")

    });
    $("#loading").hide();
  } else {
    $(".skeleton").hide();
    $("#loading").hide();
    $("#finish").fadeIn(500);
  }
});

pybossa.run('comoecampinav2');
//pybossa.getJogo('comoecampinav2');
//pybossa.run('Campinav2');
</script>
