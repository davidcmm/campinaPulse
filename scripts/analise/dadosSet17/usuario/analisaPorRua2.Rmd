---
title: "analisaPorRua2"
output:
  html_document:
    self_contained: no
  pdf_document: default
---

Aqui apresenta-se uma análise mais detalhada, rua a rua, a partir das percepções capturadas.

```{r setup, include=FALSE}
library("vioplot")
library("ggplot2")
library("dplyr")
library("knitr")
library("texreg")
library("ineq")
library(R.utils)
library("knitr")
library("spdep")
library("reshape")

multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

Alguns pontos importantes:

* O número da rua indica o que? Metros? http://campinagrandepb.com.br/wp-content/uploads/2014/10/codigo-de-obras-Lei-5410.131.pdf
* Índices de dispersão/quebra (entre números da rua, entre lados da rua, no mesmo lado, etc.)? Séries temporais?
    * Anomalias? https://www.datascience.com/blog/python-anomaly-detection
    * Derivadas, máximos e mínimos locais? Pacote features do R?

TO DO: 
* Diferença de 80 no AIC/BIC é relevante? -> Stackexchange/CrossValidated
* Jan Ghel + Brasília
    * https://www.archdaily.com.br/br/876422/a-sindrome-de-brasilia-jan-gehl-tem-razao-sergio-ulisses-jatoba
* Refinar o método
    * Escrever os passos
    * Aperfeiçoar visualização (diferença entre linhas?)
* Gerar mais pontos nas ruas mais heterogêneas?
    * Cristina e Inácio?
* Qual o nível de incerteza nos pontos?
    * Surprise Maps? https://medium.com/@uwdata/surprise-maps-showing-the-unexpected-e92b67398865
* Avaliar o mínimo de respostas necessárias?
* O que um especialista diria de útil na análise
* Comparação de modelo treinado x pessoas respondendo? Vantagens e desvantagens?

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
#Checking sample size
scores_data <- read.table("all100/all_ordenado.dat")
scores_data$sd <- apply(scores_data[,4:ncol(scores_data)], 1, sd)
scores_data$n <- ( 1.96 * scores_data$sd / 0.2) ** 2  #All QScores
scores_data$ci <- scores_data$sd * 1.96 / sqrt(100)
novoV2 <- lapply(as.character(scores_data$V2), function (x) strsplit(x, split="/", fixed=TRUE)[[1]][7])
novoV2 <- unlist(lapply(novoV2, '[[', 1))
novoV2 <- strsplit(novoV2, split="\\.jpg")
photo <- unlist(lapply(novoV2, '[[', 1))
scores_data$photo_name <- photo
scores_data <- arrange(scores_data, photo_name)

qscoresDFGeral <- read.csv("qscores-df-geral.csv", header = TRUE)
qscoresDFCampina<- read.csv("qscores-df-campina.csv", header = TRUE)
qscoresDFNotCampina <- read.csv("qscores-df-notcampina.csv", header = TRUE)

#Plotting Q-Scores through the street
all_data <- merge(qscoresDFGeral, scores_data, by.x = "url", by.y="V2")#qscoresDFGeral
all_data$street <- as.character(all_data$street)
all_data$street <- factor(all_data$street, levels=unique(all_data$street))

plot_ci_per_photo <- function(data, plotTitle, ids1, ids2){
  pd <- position_dodge(0.1)
  #data$xlabel <- factor(data$xlabel, levels = data$xlabel)
  data$side <- ""
  data$side[data$angle %in% ids1] <- "Side 1"
  data$side[data$angle %in% ids2] <- "Side 2"

  if(plotTitle == "Cristina Procopio"){
    data$side[data$num == 436 & (data$angle == 22 | data$angle == 135)] <- "Side 1"
    data$side[data$num == 436 & (data$angle == 203 | data$angle == 315)] <- "Side 2"
  }
  
  if(plotTitle == "Edésio Silva" || plotTitle == "Manoel Pereira"){
    data1 <- arrange(filter(data, side == "Side 1"), num, -angle)
    data2 <- arrange(filter(data, side == "Side 2"), num, angle)
  }else if (plotTitle == "Inacio"  || plotTitle == "Maciel Pinheiro" || plotTitle == "Cristina Procopio" || plotTitle == "Floriano Peixoto"){
    data1 <- arrange(filter(data, side == "Side 1"), num, angle)
    data2 <- arrange(filter(data, side == "Side 2"), num, angle)
    
    if (plotTitle == "Cristina Procopio"){
        to_change <- data1[nrow(data1)-1,]
        data1[nrow(data1)-1,] <- data1[nrow(data1),]
        data1[nrow(data1),] <- to_change
    }
  }
  
  #Creating sorted data info for area plot
  # data$ymin <- 0
  # data$ymax <- 0
  # sorted_data <- arrange(data, num)
  # for (i in seq(1, nrow(sorted_data), by = 4)) { 
  #   ymin <- min(sorted_data[i,]$qscore, sorted_data[i+1,]$qscore, sorted_data[i+2,]$qscore, sorted_data[i+3,]$qscore)
  #   ymax <- max(sorted_data[i,]$qscore, sorted_data[i+1,]$qscore, sorted_data[i+2,]$qscore, sorted_data[i+3,]$qscore)
  #   
  #   sorted_data[i,]$ymin <- ymin
  #   sorted_data[i,]$ymax <- ymax
  #   sorted_data[i+1,]$ymin <- ymin
  #   sorted_data[i+1,]$ymax <- ymax
  #   sorted_data[i+2,]$ymin <- ymin
  #   sorted_data[i+2,]$ymax <- ymax
  #   sorted_data[i+3,]$ymin <- ymin
  #   sorted_data[i+3,]$ymax <- ymax
  # }
  
  
  #Labeling first and second points of each street number in each side
  data1$xlabel <- paste(data1$num, "-", "p1") 
  data2$xlabel <- paste(data2$num, "-", "p1")
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data1)) { 
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data1[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data1[i,]$xlabel <- paste(data1[i,]$num, "-", "p2")
        cur_num <- 0
        occurred <- FALSE
    }
  } 
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data2)) {
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data2[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data2[i,]$xlabel <- paste(data2[i,]$num, "-", "p2")
        cur_num <- 0
        occurred <- FALSE
    }
  }
  numbers_to_show <- unique(append(data1$num, data2$num))
  #Pair values in side1 and odd values in side2
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data1)) { 
    if(data1[i,]$num %% 2 != 0){
        data1[i,]$num <- data1[i,]$num + 1
    }
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data1[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data1[i,]$num <- data1[i,]$num + 2
        cur_num <- 0
        occurred <- FALSE
    }   
  }
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data2)) { 
    if(data2[i,]$num %% 2 == 0){
        data2[i,]$num <- data2[i,]$num + 1
    }
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data2[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data2[i,]$num <- data2[i,]$num + 2
        cur_num <- 0
        occurred <- FALSE
    }
  }
  
  data1 <- data1 %>% mutate(xlabel = factor(xlabel, levels = xlabel))
  data1$mean <- mean(data1$V3)
  data1$median <- median(data1$V3)
  data1$upper <- data1$mean + (sd(data1$V3) * 1.96 / sqrt(nrow(data1)))
  data1$lower <- data1$mean - (sd(data1$V3) * 1.96 / sqrt(nrow(data1)))
  data2 <- data2 %>% mutate(xlabel = factor(xlabel, levels = xlabel))
  data2$mean <- mean(data2$V3)
  data2$median <- median(data2$V3)
  data2$upper <- data2$mean + (sd(data2$V3) * 1.96 / sqrt(nrow(data2)))
  data2$lower <- data2$mean - (sd(data2$V3) * 1.96 / sqrt(nrow(data2)))
  
  side_summary <- data.frame(side=c(rep("side1",4), rep("side2",4)), upper=c(rep(unique(data1$upper),4), rep(unique(data2$upper),4)), lower= c(rep(unique(data1$lower),4), rep(unique(data2$lower),4)), x=rep(seq(max(numbers_to_show), max(numbers_to_show)+30, 10), 1) )  
  
  data <- rbind(data1, data2)
  data$side <- factor(data$side)

  mapping <- select(data, xlabel, side, V3, street, num, angle)
  
  labels_to_show <- select(filter(data, side=="Side 1"), xlabel)[[1]][c(1,3,5,7,9)]
  g1 <- ggplot(data, aes(x=num, y=V3, fill=side, group=side)) + ylim(c(0,7)) + geom_line() + geom_point(aes(shape = side, colour=side), size=2.5) + geom_errorbar(aes(ymin=V3-ci, ymax=V3+ci), colour="black", width=.1, position=pd) + geom_area(position = "identity", alpha = 0.4) + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(vjust=10)) + labs(x = "Street points", title = plotTitle, y = "Q-Score") +  scale_x_continuous(limits=c(min(numbers_to_show)-10, max(numbers_to_show)+30), breaks=numbers_to_show, labels=labels_to_show) + geom_vline(data = data.frame(marks=numbers_to_show), aes(xintercept=marks), linetype="dashed") + geom_hline(aes(yintercept=mean, color=side), linetype="dashed") + geom_hline(aes(yintercept=median, color=side), linetype="dotdash") 
  g1 + geom_ribbon(data=side_summary, aes(ymin=lower, ymax=upper, x=x, colour=side), linetype=1, alpha=0.3)#+ geom_line(aes(y=mean, x=num, col=side), linetype="dashed") + geom_line(aes(y=median, x=num, col=side), linetype="dotdash")    scale_fill_grey() + scale_color_grey() #reorder(xlabel, num)
  
#Difference area plot: https://mcfromnz.wordpress.com/tag/ggplot/  
# mperson <-function(x) {
#     x <-x[order(x$num), ]
#     y <-x[-c(1, 2, nrow(x) -1, nrow(x)), ]
#     x <-rbind(x, y)
#     x <-x[order(x$num), ]
#     x$group <-rep(letters[1:(nrow(x)/4)], each = 4)
#     return(x)
# }
# data2 <-ddply(data, .(), mperson)
# mgroup <-function(x) {
#     x <-x[order(x$qscore), ]
#     left <-x[x$num ==min(x$num), ]
#     right <-x[x$num ==max(x$num), ]
#     if (all(left$side ==right$side)) {
#         left <-left[order(left$qscore, decreasing = T), ]
#         right <-right[order(right$qscore, decreasing = F), ]
#         return(rbind(left, right))
#     } else {
#         return(x[order(x$num), ])
#     }
# }
# data2 <-ddply(data2, .(group), mgroup)
#   
#   ggplot(data, aes(x=num, y=V3, fill=side, group=side)) + ylim(c(0,7)) + geom_line(aes(colour=side)) + geom_point(aes(shape = side, colour=side), size=2.5) + geom_errorbar(aes(ymin=V3-ci, ymax=V3+ci), colour="black", width=.1) + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(vjust=10)) + labs(x = "Street points", title = plotTitle, y = "Q-Score") +  scale_x_continuous(limits=c(min(numbers_to_show)-10, max(numbers_to_show)+10), breaks=numbers_to_show, labels=labels_to_show) + geom_vline(data = data.frame(marks=numbers_to_show), aes(xintercept=marks), linetype="dashed") + geom_hline(aes(yintercept=mean, color=side), linetype="dashed") + geom_hline(aes(yintercept=median, color=side), linetype="dotdash") +
# geom_polygon(data = dat2, aes(y = qscore, group = group), alpha = 0.3)
#     
#       geom_ribbon(data = sorted_data, aes(x = num, ymin = ymin, ymax = ymax), fill = "grey", alpha = 0.4)
  
  multiplot(g1, cols=1)
  return (mapping)
}

```

De acordo com a heterogeneidade de cada rua (abaixo) vamos apresentar a discussão, a partir da próxima seção, da mais heterogênea para a mais homogênea.

```{r , echo=FALSE, warning=FALSE}
#GINI COEFFICIENTS
all_data$street <- factor(all_data$street, levels=unique(all_data$street))
inequalities <- data.frame( labels=c("Gini", "Entropy", "SD"), edesio=c(ineq(filter(all_data, street == "R._Edésio_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Edésio_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Edésio_Silva")$qscore)), inacio=c(ineq(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore)), maciel=c(ineq(filter(all_data, street == "R._Maciel_Pinheiro")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Maciel_Pinheiro")$qscore, type="entropy"), sd(filter(all_data, street == "R._Maciel_Pinheiro")$qscore)), manoel=c(ineq(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore, type="entropy"), sd(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore)), floriano=c(ineq(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore, type="Gini"), ineq(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore, type="entropy"), sd(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore)), cristina= c(ineq(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore)) )

gini <- melt(filter(inequalities, labels=="Gini"), id=c("labels"))
entropy <- melt(filter(inequalities, labels=="Entropy"), id=c("labels"))
SD <- melt(filter(inequalities, labels=="SD"), id=c("labels"))

arrange(gini, desc(value))
arrange(entropy, desc(value))
arrange(SD, desc(value))
```

O que procurar?

1. Ponto mais heterogeneo/homogeneo
2. Melhor e pior local da rua
3. Melhor e pior área da rua (considerando os dois lados)
4. Áreas muito diferentes entre lados
5. Descontinuidades no mesmo lado
6. Heterogeneidade/Homogeneidade no ponto -> Isso tudo pode ser explicado pela regressão geral das features?
7. O que é a rua?


#Cristina Procópio

```{r echo=FALSE, fig.height=10, fig.width=12, warning=FALSE}
best_folder <- "../percepcaoLocal/agradavel/melhores/intersects/"
worst_folder <- "../percepcaoLocal/agradavel/piores/intersects/"

cristina <- filter(all_data, street == "R._Cristina_Procópio_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, photo_name, street, num, angle, qscore, V3, ci)

print(">>> GINI da rua: ")
ineq(cristina$qscore, type="Gini")
gini <- data.frame("num"=integer(), "value"=double())
for (value in unique(cristina$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(cristina, num == value)$qscore, type="Gini"))
}
arrange(gini, desc(value))
```

```{r results='asis', echo=FALSE, fig.height=10, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(cristina, "Cristina Procopio", c(22, 45, 293, 315), c(135, 225))#Street 6 -> At number 436, 22 x 315 and 135 x 203
kable(mapping, format = "markdown")

show_street_data <- function (current_df, all_data, best_folder, worst_folder){
    color_space <- c("#000000", "#001900", "#003300", "#004c00", "#006600", "#007f00", "#009900", "#00b200", "#00cc00", "#00e500", "#00ff00")
    step <- (max(all_data$qscore) - min(all_data$qscore)) / length(color_space)
    thresholds <- seq(min(all_data$qscore), max(all_data$qscore), step)
    
    median_value <- median(all_data$qscore)
    cat(paste("++++++ Median ", median_value))
    cat("<div class='row'>")
    angleData = c()
    for(i in 1:nrow(current_df)) {
      row <- current_df[i,]
      
      street <- as.character(row$street)
      photo_name <- as.character(row$photo_name)
      num <- row$num
      angle <- row$angle
      score <- row$qscore
      angleData <- append(angleData, score)
      
      color_index <- findInterval(score, thresholds)[1]
      if (color_index > length(color_space)){
         color_index <- length(color_space)
      }
      
      folder <- "none"
      if (score >= median_value){
        if (file.exists(paste(best_folder, photo_name, sep=""))){
          url <- paste(best_folder, photo_name, sep="")
          folder <- "best"
        }else if (file.exists(paste(worst_folder, photo_name, sep=""))){
          url <- paste(worst_folder, photo_name, sep="")
          folder <- "worst"
        }else{
           url <- as.character(row$url)
        }
      }else{
        if (file.exists(paste(worst_folder, photo_name, sep=""))){
          url <- paste(worst_folder, photo_name, sep="")
          folder <- "worst"
        }else if (file.exists(paste(best_folder, photo_name, sep=""))){
          url <- paste(best_folder, photo_name, sep="")
          folder <- "best"
        }else{
           url <- as.character(row$url)
        }
      }
      
      cat(paste("<div class='col-xs-3' style=\"background-color:", color_space[color_index],"\">", sep=""))
      cat("<img src='", url,"' width='300px'>", sep = "")
      cat("<p style=\"color:white;font-size:90%\">", folder, "<br>", photo_name, "-> ", score,  "</p>", sep="")
      cat("</div>")
      if (i > 1 && i %% 4 == 0){
        cat("</div>")
        cat("####### Sumário do Número ", num, ": Max. ", max(angleData), " Min: ", min(angleData), " Diff: ", max(angleData) - min(angleData))
        cat("<div class='row'>")
        angleData = c()
      }
    }
}

show_street_data(cristina, all_data, best_folder, worst_folder)

```

1. Locais problemáticos na rua (olhando as fotos): 
    * 2 side1 (terreno com lixo)
    * 305 side2 (lixo, pouca manutenção)
    * 436 side2 203 (construção/menor manutenção) 
2. Melhor e pior local da rua: 
    * 66-p2 side2 (melhor) 
    * 305-p1 side2 (pior) diferença de 2.5 -> boa manutenção, verde, ruas largas x falta de manutenção, lixo
3. Melhor e pior lado da rua:
    * O side1 parece ligeiramente melhor (2 side2, 66 empate, 261, 305, 436 side1)
4. Melhor e pior área da rua (considerando os dois lados): 
    * 66 a 261 side1 (melhor) 
    * 305 a 436 side2 (pior) menor dif. de aprox. 2.1 -> verde, boa manutenção x lixo, menor manutenção, menos verde aparente (no 436 tem um ponto bacana que tem verde e boa manutenção, o outro nem tanto)
5. Áreas muito diferentes entre lados:  
    * 305 a 436 menor diferenca de aprox. 1 -> boa manutenção, verde x lixo, pouca manutenção, menos verde aparente (no 436 tem um ponto bacana que tem verde e boa manutenção, o outro nem tanto)
6. Descontinuidades no mesmo lado
    * 66 side2 dif de 0.8 -> manutenção e verde aparente
    * 305 side2 dif de 0.8 -> no meio da falta de manutenção, lixo a segunda imagem tem um prédio melhor conservado
    * 305 side1 dif. de 0.45 -> mais prédios mais conservados
    * 436 side2 dif. de 1.3 -> mais verde aparente, construção/manutenção
7. Heterogeneidade/Homogeneidade no ponto:
    * os pontos mais heterogêneros foram o 305 (lixo, falta de manutenção) e 436 (falta de manuteção, verde aparente). 
    * o mais homogêneo foi o 261 que é um ponto bem mantido e com verde
8. Foram encontrados os problemas? 
    * Dois (305 e 436) dos três pontos foram encontrados. Tanto no número 305 como no 436, dentre os pontos avaliados, pôde-se perceber locais que necessitam de melhoria na rua.
    * O ponto 2 seria encontrado se seguissemos a lista de heterogeneidade (2 mais homogeneo) ou se avaliassemos diferenças entre os dois lados por ponto (complicado em vários casos).
    * Além disso, no ponto 66 sugere-se uma melhoria com um pouco mais de verde de modo a homogenizar ainda mais o ponto.
9. O que é a rua?
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação? Variações de locais melhores e piores ao longo de toda a rua, alguns números com grande variação no local
    * Existe um lado melhor? No final da rua side1 parece despertar maiores preferências que o outro lado. Média e mediana de side1 melhores
    * Existe uma área melhor pior? Conforme questão 4 do número 66 ao 261 parece termos a melhor área da rua e do número 305 ao 436 a pior área.


#Edésio Silva

```{r echo=FALSE, fig.height=10, fig.width=12, warning=FALSE}
edesio <- filter(all_data, street == "R._Edésio_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, photo_name, street, num, angle, qscore, V3, ci)
print(paste(">>> GINI da rua: ", ineq(edesio$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
for (value in unique(edesio$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(edesio, num == value)$qscore, type="Gini"))
}
arrange(gini, desc(value))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(edesio, "Edésio Silva", c(22, 135), c(315, 203))#Street 1
kable(mapping, format = "markdown")

show_street_data(edesio, all_data,  best_folder, worst_folder)

```

1. Locais problemáticos na rua (olhando as fotos): 
    * 70 side1 135 (construção, menor manutenção, lixo) e side2 315 (menor manutenção), 203 (um pouco de lixo e menor manutenção); 
    * 602 side 203 (terreno com muito lixo); 
    * 1136 todos os lados (pouca manutenção, lixo, terrenos);
2. Melhor e pior local da rua: 
    * 602 p2 side2 
    * 70 p1 side1. Dif de 1.6 -> boa manutenção, algum verde x construção, pouca manutenção, sem verde
3. Melhor e pior lado da rua:
    * Não fica claro
4. Melhor e pior área da rua (considerando os dois lados): 
    * confuso, não dá pra discernir facilmente
5. Áreas muito diferentes entre lados: 
    * 70 a 306 melhora em side2 e piora em side1
        * No side1 temos um ponto muito bom (70, 22) que foge do padrão de melhoria que sairia de pouca manutenção e falta de áŕvore para melhor manutenção e mais árvores. 
        * No side2 temos uma certa melhoria de manutenção + árvores aparentes
6. Descontinuidades no mesmo lado
    * 70 no side1, diferença de 1.55 -> construção, falta de verde x melhor manutenção, verde
    * 602 no side1, diferença de 0.6 -> falta de manutenção, menos verde aparente x melhor manutenção, verde
    * 602 no side2, diferença de 1.15 -> manutenção, verde x lixão
    * 1136 no side2, diferença de 0.6 -> lixão
7. Heterogeneidade/Homogeneidade no ponto: 
    * os pontos mais heterogêneos foram o 70 (construção, menor manutenção x melhor manutenção e algum verde) e 602 (menor manutenção, lixão x melhor manutenção, verde)
    * o ponto mais homogêneo foi o 1546, é bem mantido e com alguma vegetação.
8. Foram encontrados os problemas? 
    * O número 1136 no side1 não foi apontado dentre os 5 problemas levantados. 
    * O 1136 seria encontrado (diferença de 0.45) se continuássemos olhando as descontinuidades no mesmo lado da rua ou as piores notas (2 pior nota)
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação?  Variações de locais melhores e piores ao longo de toda a rua, alguns números com grande variação no local
    * Existe um lado melhor? Não
    * Existe uma área melhor pior? Não


#Inácio Marques
```{r echo=FALSE, fig.height=10, fig.width=12, warning=FALSE}
inacio <- filter(all_data, street == "R._Inácio_Marquês_da_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, photo_name, street, num, angle, qscore, V3, ci)
print(paste(">>> GINI da rua: ", ineq(inacio$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
for (value in unique(inacio$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(inacio, num == value)$qscore, type="Gini"))
}
arrange(gini, desc(value))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(inacio, "Inacio", c(203, 112, 90), c(293, 270, 22))#Street 2
kable(mapping, format = "markdown")

show_street_data(inacio, all_data,  best_folder, worst_folder)

```

1. Locais problemáticos na rua (olhando as fotos): 
    * 54 angulos 203 e 293 (falta de manutenção e verde); 
    * 120 angulo 203 (falta de manutenção, lixo e verde); 
    * 360 angulos 90 e 203 (terreno); 
    * todo o número 500 
2. Melhor e pior local da rua: 
    * 239 p1 side1 
    * 54 p2 side2. Diferenca de 1.45 -> boa manutenção, algum verde x menor manutenção, lixo
3. Melhor e pior lado da rua:
    * O side2 parece ligeiramente melhor (54 e 239 empate (uma foto de um lado e outra do outro), 500 empate com igualdade, 120 e 360 side2)
4. Melhor e pior área da rua (considerando os dois lados): 
    * 239 a 360 (melhor)? manutenção, verde, museu, apesar de duas visões de terreno que tiveram notas não tão ruins 
5. Áreas muito diferentes entre lados: 
    * 120 a 239 -> no 239 temos um maior equilíbrio bom entre todos os pontos (boa manutenção, verde), mas no 120 temos um ponto pior para o side1 (menor manutenção, lixo, ausência de verde) 
6. Descontinuidades no mesmo lado:
    * 54 side1, diferenca de 1.2 -> melhor manutenção x pior manutenção
    * 54 side2, diferença de 0.6 -> melhor manutenção, verde x pior manutenção, falta de verde
    * 120 side1, diferença de 1.1 -> melhor manutenção, verde x pior manutenção, falta de verde
7. Heterogeneidade/Homogeneidade no ponto: 
    * os pontos mais heterogêneos foram o 54 (pior manutenção, falta de verde x melhor manutenção, verde) e 120 (pior manutenção, falta de verde x melhor manutenção); 
    * o mais homogêneo foi o 500 (pouca manutenção, muros, terrenos)  
8. Foram encontrados os problemas? 
    * Dos 4 pontos levantados o 360 não foi percebido pelas perguntas acima. 
    * Se olhássemos o terceiro ponto mais heterogêneo encontraríamos o problema do ponto 360 (menor diferença de 0.4) ou como os pontos de cada lado tem notas parecidas se olhássemos diferenças entre lados no ponto. 
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação?  Variações de locais melhores e piores ao longo de toda a rua, alguns números com grande variação no local
    * Existe um lado melhor? Side2 ligeiramente melhor
    * Existe uma área melhor pior? Não

#Floriano peixoto
```{r echo=FALSE, fig.height=10, fig.width=12, warning=FALSE}
floriano <- filter(all_data, street == "Av._Mal._Floriano_Peixoto") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, photo_name, street, num, angle, qscore, V3, ci)
print(paste(">>> GINI da rua: ", ineq(floriano$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
for (value in unique(floriano$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(floriano, num == value)$qscore, type="Gini"))
}
arrange(gini, desc(value))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(floriano, "Floriano Peixoto", c(22,293), c(112,203))#Street 5
kable(mapping, format = "markdown")

show_street_data(floriano, all_data,  best_folder, worst_folder)
```

1. Locais problemáticos na rua (olhando as fotos): 
    * 549 angulo 22 (manutenção no prédio)
    * 813 angulos 22 (manutenção no telegrafo/histórico) 
    * 913 angulo 203 (manutenção prédio amarelo)
2. Melhor e pior local da rua: 
    * 549 p2 side2 (muito verde bem mantido, praça) 
    * 913 p2 side1 (lojas com visual mais acanhado). Diferença de 1.4
3. Melhor e pior lado da rua:
    * O side2 parece ligeiramente melhor (445, 549, 913 side2, 691 side1, 813 empate)
4. Melhor e pior área da rua (considerando os dois lados): 
    * 691 a 813? verde, bem mantido e alguns pontos precisando de manutenção.
5. Áreas muito diferentes entre lados: 
    * 549 (praça x prédios mais acanhados)??
6. Descontinuidades no mesmo lado: 
    * 445 side1, diferença de 0.7 -> ônibus??
    * 445 side2, diferença de 0.6 -> mais verde x menos verde, prédio
    * 549 side2, diferença de 0.4 -> mais verde, praça x menos verde, estacionamento
7. Heterogeneidade/Homogeneidade no ponto: 
    * os pontos mais heterogêneos foram o 913 (visual das lojas?) e 549 (praça, verde x estacionamento, prédio). 
    * O mais homogênero foi o 691 (prédios até bem mantidos com algumas árvores)
8. Foram encontrados os problemas? 
    * O ponto 813 dos 3 apontados não foi percebido. 
    * Se olhássemos outras descontinuidades no mesmo lado acabaríamos chegando nessa comparação apesar da baixa diferença de 0.2.
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação? Rua mais homogênea, com pequenas variações entre alguns de seus pontos
    * Existe um lado melhor? Side2 ligeiramente melhor
    * Existe uma área melhor pior? Não


#Maciel Pinheiro
```{r echo=FALSE, fig.height=10, fig.width=12, warning=FALSE}
maciel <- filter(all_data, street == "R._Maciel_Pinheiro") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, photo_name, street, num, angle, qscore, V3, ci)
print(paste(">>> GINI da rua: ", ineq(maciel$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
for (value in unique(maciel$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(maciel, num == value)$qscore, type="Gini"))
}
arrange(gini, desc(value))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(maciel, "Maciel Pinheiro", c(360, 90), c(270, 180))#Street 3
kable(mapping, format = "markdown")

show_street_data(maciel, all_data,  best_folder, worst_folder)
```

1. Locais problemáticos na rua (olhando as fotos): 
    * 130 angulo 360 (manutenção de prédio); 
    * 190 angulo 180 (manutenção de prédio); 
    * 284 360 (manutenção de prédio); 
    * 360 270 (manutenção de prédio). 
    * Não existem árvores na rua?
2. Melhor e pior local da rua: 
    * 248 angulo 180 (boa manutenção)
    * 190 180 (manutenção de prédio faltando)
3. Melhor e pior lado da rua:
    * O side1 parece ligeiramente melhor (130, 284 empate, 190, 360 side1, 248 side2)
4. Melhor e pior área da rua (considerando os dois lados): 
    * confuso!
5. Áreas muito diferentes entre lados: 
    * 284 a 360, com side1 ligeiramente melhor (no side2 temos um estacionamento e um caminhão na vista)
6. Descontinuidades no mesmo lado: 
    * 190 side2, diferença de 0.9 -> prédio precisando de manutenção x boa manutenção
    * 248 side1, diferença de 0.7 -> menos identificadores, prédios um pouco mais novos x identificadores e prédios um pouco mais antigos
    * 248 side2, diferença de 0.5 -> menos identificadores, prédios um pouco mais novos x identificadores e prédios um pouco mais antigos
    * 284 side2, diferença de 0.5 -> boa manutenção x estacionamento, prédio, carros 
7.  Heterogeneidade/Homogeneidade no ponto: 
    * Os pontos mais heterogêneos foram o 248 (boa manutenção x mais identificadores/prédios) e 190 (boa manutenção x prédio que precisa de manutenção). 
    * O mais homogêneo foi o 284 (boa manutenção, apesar do estacionamento e prédio precisando de manutenção)
8.  Foram encontrados os problemas? 
    * Apenas o 190 dos 4 pontos foi encontrado. 
    * A valorização da presença de árvores no final da rua pareceu não fazer um efeito tão alto em relação ao restante da rua. 
    * O 130 seria encontrado se continuássemos a olhar descontinuidades por lado. 
    * O 360 270 seria verificado se olhando para a praça comparássemos. 
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação? Rua mais homogênea, com pequenas variações entre alguns de seus pontos. Variações parecem estar ligadas ao estado de manutenção e identificadores
    * Existe um lado melhor? O side1 parece ligeiramente melhor
    * Existe uma área melhor pior? Do 190 ao 248 parece ser a melhor área, e do 248 ao 284 a pior

#Manoel Pereira
```{r echo=FALSE, fig.height=10, fig.width=12, warning=FALSE}
manoel <- filter(all_data, street == "R._Manoel_Pereira_de_Araújo") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, photo_name, street, num, angle, qscore, V3, ci)
print(paste(">>> GINI da rua: ", ineq(manoel$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
for (value in unique(manoel$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(manoel, num == value)$qscore, type="Gini"))
}
arrange(gini, desc(value))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(manoel, "Manoel Pereira", c(22, 135, 293), c(315, 112, 203, 225))#Street 4
kable(mapping, format = "markdown")

show_street_data(manoel, all_data,  best_folder, worst_folder)
```

1. Locais problemáticos na rua (olhando as fotos): 
    * A rua em geral precisa de manutenção. 
    * Alguns pontos parecem ainda piores como o 222 angulo 22 (prédio acabado + itens na rua), 300 angulo 22 e 135 (barraca, itens na rua), 370 angulo 22, 203 e 315 (prédios acabados, barracas). 
    * Ausência de árvores de fato na rua.
2. Melhor e pior local da rua: 
    * 222 p1 side2 (prédio mais conservado da sucata) 
    * 188 p1 side2 (prédio acabado, carros, itens na rua)
3. Melhor e pior lado da rua:
    * Não fica claro
4. Melhor e pior área da rua (considerando os dois lados): 
    * confuso!
5. Áreas muito diferentes entre lados: 
    * 300 a 370 (um lado com alguns pontos melhor conservados, o outro lado com mais variação); 
    * 222 a 300 (um lado com alguns pontos melhor conservados, o outro lado com mais variação)
6. Descontinuidades no mesmo lado: 
    * 188 side2, diferença de 0.4 -> manutenção um pouco melhor
    * 222 side2, diferença de 0.4 -> manutenção de prédios e mais itens na rua na imagem menos preferida
    * 370 side1, diferença de 0.6 -> pequena variação de manutenção, menos itens na rua na imagem preferida
7. Heterogeneidade/Homogeneidade no ponto: 
    * Os pontos mais heterogêneos foram o 370 (manutenção um pouco melhor em alguns locais e menos itens na rua) e o 188 (manutenção um pouco melhor em alguns locais). 
    * O ponto mais homogêneo foi o 392 (melhor manutenção em média dos prédios)
8. Foram encontrados os problemas? 
    * Olhando as diferenças entre lados englobamos os números 222, 300 e 370. 
    * Olhando as maiores descontinuidades aparentes englobamos 222 e 370. 
    * Como a rua toda praticamente não tem árvores fica difícil pesar este aspecto dado a pobreza de manutenção, todavia a imagem 370 315 apesar de péssima manutenção e barracas/itens na rua teve uma nota melhor que outros locais e as árvores foram marcadas junto com o céu.
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para ruim, com notas baixas
    * Existe muita variação? Rua mais homogênea, com alguns pontos que se destacam positivamente por ter uma melhor manutenção ou menos itens na rua e outros que se destacam negativamente por terem manutenção ainda pior e/ou mais itens na rua
    * Existe um lado melhor? Não
    * Existe uma área melhor pior? Não
  
#Novas Ideias que não foram consideradas

* Olhar a diferença entre os lados da rua por ponto? 
    * Acharia 2 problemas não encontrados
* Olhar a favor/contra carros e comparar os scores?
    * Acharia 1 problema não encontrado
    
#Descartar/Alterar?

* Melhor e pior área por lado ao invés de melhor e pior área da rua?
