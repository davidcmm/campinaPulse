---
title: "analisaPorRua2"
output:
  html_document:
    self_contained: no
  pdf_document: default
---

Aqui apresenta-se uma análise mais detalhada, rua a rua, a partir das percepções capturadas.

```{r setup, include=FALSE}
library("vioplot")
library("ggplot2")
library("dplyr")
library("knitr")
library("texreg")
library("ineq")
library(R.utils)
library("spdep")
library("reshape")
library("fitdistrplus")

multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

Alguns pontos importantes:

* O número da rua indica o que? Metros? http://campinagrandepb.com.br/wp-content/uploads/2014/10/codigo-de-obras-Lei-5410.131.pdf
* Índices de dispersão/quebra (entre números da rua, entre lados da rua, no mesmo lado, etc.)? Séries temporais?
    * Anomalias? https://www.datascience.com/blog/python-anomaly-detection
    * Derivadas, máximos e mínimos locais? Pacote features do R?

TO DO: 

* Refinar o método
    * Escrever os passos
    * Aperfeiçoar visualização (diferença entre linhas?)
* Gerar mais pontos nas ruas mais heterogêneas?
    * Cristina e Inácio?
* Qual o nível de incerteza nos pontos?
    * Surprise Maps? https://medium.com/@uwdata/surprise-maps-showing-the-unexpected-e92b67398865
    * Surprise entre ruas? Tendo como base um modelo uniforme, ou média das ruas
    * Surprise na rua? Tendo como base um modelo uniforme, ou a média dos pontos
* Avaliar o mínimo de respostas necessárias?

* O que um especialista diria de útil na análise
* Comparação de modelo treinado x pessoas respondendo? Vantagens e desvantagens?

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12, warning=FALSE}
#Checking sample size
scores_data <- read.table("all100/all_ordenado.dat")
scores_data$sd <- apply(scores_data[,4:ncol(scores_data)], 1, sd)
scores_data$n <- ( 1.96 * scores_data$sd / 0.2) ** 2  #All QScores
scores_data$ci <- scores_data$sd * 1.96 / sqrt(100)
novoV2 <- lapply(as.character(scores_data$V2), function (x) strsplit(x, split="/", fixed=TRUE)[[1]][7])
novoV2 <- unlist(lapply(novoV2, '[[', 1))
novoV2 <- strsplit(novoV2, split="\\.jpg")
photo <- unlist(lapply(novoV2, '[[', 1))
scores_data$photo_name <- photo
scores_data <- arrange(scores_data, photo_name)

qscoresDFGeral <- read.csv("qscores-df-geral.csv", header = TRUE)
qscoresDFCampina<- read.csv("qscores-df-campina.csv", header = TRUE)
qscoresDFNotCampina <- read.csv("qscores-df-notcampina.csv", header = TRUE)

#Plotting Q-Scores through the street
all_data <- merge(qscoresDFGeral, scores_data, by.x = "url", by.y="V2")#qscoresDFGeral
all_data$street <- as.character(all_data$street)
all_data$street <- factor(all_data$street, levels=unique(all_data$street))

plot_ci_per_photo <- function(data, plotTitle, ids1, ids2){
  pd <- position_dodge(0.1)
  #data$xlabel <- factor(data$xlabel, levels = data$xlabel)
  data$side <- ""
  data$side[data$angle %in% ids1] <- "Side 1"
  data$side[data$angle %in% ids2] <- "Side 2"

  if(plotTitle == "Cristina Procopio"){
    data$side[data$num == 436 & (data$angle == 22 | data$angle == 135)] <- "Side 1"
    data$side[data$num == 436 & (data$angle == 203 | data$angle == 315)] <- "Side 2"
  }
  
  if(plotTitle == "Edésio Silva" || plotTitle == "Manoel Pereira"){
    data1 <- arrange(filter(data, side == "Side 1"), num, -angle)
    data2 <- arrange(filter(data, side == "Side 2"), num, angle)
  }else if (plotTitle == "Inacio"  || plotTitle == "Maciel Pinheiro" || plotTitle == "Cristina Procopio" || plotTitle == "Floriano Peixoto"){
    data1 <- arrange(filter(data, side == "Side 1"), num, angle)
    data2 <- arrange(filter(data, side == "Side 2"), num, angle)
    
    if (plotTitle == "Cristina Procopio"){
        to_change <- data1[nrow(data1)-1,]
        data1[nrow(data1)-1,] <- data1[nrow(data1),]
        data1[nrow(data1),] <- to_change
    }
  }
  
  #Creating sorted data info for area plot
  # data$ymin <- 0
  # data$ymax <- 0
  # sorted_data <- arrange(data, num)
  # for (i in seq(1, nrow(sorted_data), by = 4)) { 
  #   ymin <- min(sorted_data[i,]$qscore, sorted_data[i+1,]$qscore, sorted_data[i+2,]$qscore, sorted_data[i+3,]$qscore)
  #   ymax <- max(sorted_data[i,]$qscore, sorted_data[i+1,]$qscore, sorted_data[i+2,]$qscore, sorted_data[i+3,]$qscore)
  #   
  #   sorted_data[i,]$ymin <- ymin
  #   sorted_data[i,]$ymax <- ymax
  #   sorted_data[i+1,]$ymin <- ymin
  #   sorted_data[i+1,]$ymax <- ymax
  #   sorted_data[i+2,]$ymin <- ymin
  #   sorted_data[i+2,]$ymax <- ymax
  #   sorted_data[i+3,]$ymin <- ymin
  #   sorted_data[i+3,]$ymax <- ymax
  # }
  
  
  #Labeling first and second points of each street number in each side
  data1$xlabel <- paste(data1$num, "-", "p1") 
  data2$xlabel <- paste(data2$num, "-", "p1")
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data1)) { 
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data1[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data1[i,]$xlabel <- paste(data1[i,]$num, "-", "p2")
        cur_num <- 0
        occurred <- FALSE
    }
  } 
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data2)) {
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data2[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data2[i,]$xlabel <- paste(data2[i,]$num, "-", "p2")
        cur_num <- 0
        occurred <- FALSE
    }
  }
  numbers_to_show <- unique(append(data1$num, data2$num))
  #Pair values in side1 and odd values in side2
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data1)) { 
    if(data1[i,]$num %% 2 != 0){
        data1[i,]$num <- data1[i,]$num + 3
    }
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data1[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data1[i,]$num <- data1[i,]$num + 4
        cur_num <- 0
        occurred <- FALSE
    }   
  }
  cur_num <- 0
  occurred <- FALSE
  for (i in 1:nrow(data2)) { 
    if(data2[i,]$num %% 2 == 0){
        data2[i,]$num <- data2[i,]$num + 3
    }
    if(occurred == FALSE && cur_num == 0){
        cur_num <- data2[i,]$num
        occurred <- TRUE
    }else if(occurred == TRUE){
        data2[i,]$num <- data2[i,]$num + 4
        cur_num <- 0
        occurred <- FALSE
    }
  }
  
  data1 <- data1 %>% mutate(xlabel = factor(xlabel, levels = xlabel))
  data1$mean <- mean(data1$V3)
  data1$median <- median(data1$V3)
  data1$upper <- data1$mean + (sd(data1$V3) * 1.96 / sqrt(nrow(data1)))
  data1$lower <- data1$mean - (sd(data1$V3) * 1.96 / sqrt(nrow(data1)))
  data2 <- data2 %>% mutate(xlabel = factor(xlabel, levels = xlabel))
  data2$mean <- mean(data2$V3)
  data2$median <- median(data2$V3)
  data2$upper <- data2$mean + (sd(data2$V3) * 1.96 / sqrt(nrow(data2)))
  data2$lower <- data2$mean - (sd(data2$V3) * 1.96 / sqrt(nrow(data2)))
  
  side_summary <- data.frame(side=c(rep("side1",4), rep("side2",4)), upper=c(rep(unique(data1$upper),4), rep(unique(data2$upper),4)), lower= c(rep(unique(data1$lower),4), rep(unique(data2$lower),4)), x=rep(seq(max(numbers_to_show), max(numbers_to_show)+30, 10), 1) )  
  
  data <- rbind(data1, data2)
  data$side <- factor(data$side)

  mapping <- dplyr::select(data, xlabel, side, V3, street, num, angle)
  
  labels_to_show <- dplyr::select(dplyr::filter(data, side=="Side 1"), xlabel)[[1]][c(1,3,5,7,9)]
  g1 <- ggplot(data, aes(x=num, y=V3, fill=side, group=side)) + ylim(c(0,7)) + geom_line() + geom_point(aes(shape = side, colour=side), size=2.5) + geom_errorbar(aes(ymin=V3-ci, ymax=V3+ci), colour="black", width=.1, position=pd) + geom_area(position = "identity", alpha = 0.4) + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(vjust=10)) + labs(x = "Street points", title = plotTitle, y = "Q-Score") +  scale_x_continuous(limits=c(min(numbers_to_show)-10, max(numbers_to_show)+30), breaks=numbers_to_show, labels=labels_to_show) + geom_vline(data = data.frame(marks=numbers_to_show), aes(xintercept=marks), linetype="dashed") + geom_hline(aes(yintercept=mean, color=side), linetype="dashed") + geom_hline(aes(yintercept=median, color=side), linetype="dotdash") 
  #g1 + geom_ribbon(data=side_summary, aes(ymin=lower, ymax=upper, x=x, colour=side), linetype=1, alpha=0.3)#+ geom_line(aes(y=mean, x=num, col=side), linetype="dashed") + geom_line(aes(y=median, x=num, col=side), linetype="dotdash")    scale_fill_grey() + scale_color_grey() #reorder(xlabel, num)
  g2 <- ggplot(data, aes(x=num, y=surprise_street, size=3)) + geom_point(aes(colour = surprise_street, shape=side)) + scale_colour_continuous(low="red", high="green") + labs(title = "Uniform for Street") + ylim(c(-0.05, 0.05))
  g3 <- ggplot(data, aes(x=num, y=surprise_unif_base_norm, size=3)) + geom_point(aes(colour = surprise_unif_base_norm, shape=side)) + scale_colour_continuous(low="red", high="green") + labs(title = "Uniform + Base Rate + Normal for each street") + ylim(c(-0.05, 0.05))
  g4 <- ggplot(data, aes(x=num, y=surprise_unif_base_norm_fixed, size=3)) + geom_point(aes(colour = surprise_unif_base_norm_fixed, shape=side)) + scale_colour_continuous(low="red", high="green") + labs(title = "Uniform + Base Rate + Normal for each street - fixed PM") + ylim(c(-0.03, 0.03))
    g5 <- ggplot(data, aes(x=num, y=surprise_unif_baseMed_norm, size=3)) + geom_point(aes(colour = surprise_unif_baseMed_norm, shape=side)) + scale_colour_continuous(low="red", high="green") + labs(title = "Uniform + Base Rate (Median) + Normal for each street") + ylim(c(-0.05, 0.05))
   g6 <- ggplot(data, aes(x=num, y=surprise_unif_base_normAll, size=3)) + geom_point(aes(colour = surprise_unif_base_normAll, shape=side)) + scale_colour_continuous(low="red", high="green") + labs(title = "Uniform + Base Rate + Normal for all data") + ylim(c(-0.1, 0.1))
#Difference area plot: https://mcfromnz.wordpress.com/tag/ggplot/  
# mperson <-function(x) {
#     x <-x[order(x$num), ]
#     y <-x[-c(1, 2, nrow(x) -1, nrow(x)), ]
#     x <-rbind(x, y)
#     x <-x[order(x$num), ]
#     x$group <-rep(letters[1:(nrow(x)/4)], each = 4)
#     return(x)
# }
# data2 <-ddply(data, .(), mperson)
# mgroup <-function(x) {
#     x <-x[order(x$qscore), ]
#     left <-x[x$num ==min(x$num), ]
#     right <-x[x$num ==max(x$num), ]
#     if (all(left$side ==right$side)) {
#         left <-left[order(left$qscore, decreasing = T), ]
#         right <-right[order(right$qscore, decreasing = F), ]
#         return(rbind(left, right))
#     } else {
#         return(x[order(x$num), ])
#     }
# }
# data2 <-ddply(data2, .(group), mgroup)
#   
#   ggplot(data, aes(x=num, y=V3, fill=side, group=side)) + ylim(c(0,7)) + geom_line(aes(colour=side)) + geom_point(aes(shape = side, colour=side), size=2.5) + geom_errorbar(aes(ymin=V3-ci, ymax=V3+ci), colour="black", width=.1) + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(vjust=10)) + labs(x = "Street points", title = plotTitle, y = "Q-Score") +  scale_x_continuous(limits=c(min(numbers_to_show)-10, max(numbers_to_show)+10), breaks=numbers_to_show, labels=labels_to_show) + geom_vline(data = data.frame(marks=numbers_to_show), aes(xintercept=marks), linetype="dashed") + geom_hline(aes(yintercept=mean, color=side), linetype="dashed") + geom_hline(aes(yintercept=median, color=side), linetype="dotdash") +
# geom_polygon(data = dat2, aes(y = qscore, group = group), alpha = 0.3)
#     
#       geom_ribbon(data = sorted_data, aes(x = num, ymin = ymin, ymax = ymax), fill = "grey", alpha = 0.4)
  
  multiplot(g1, g2, g3, g4, g5, g6, cols=1)
  return (mapping)
}

```

De acordo com a heterogeneidade de cada rua (abaixo) vamos apresentar a discussão, a partir da próxima seção, da mais heterogênea para a mais homogênea.

```{r , echo=FALSE, warning=FALSE}
#GINI COEFFICIENTS
all_data$street <- factor(all_data$street, levels=unique(all_data$street))
inequalities <- data.frame( labels=c("Gini", "Entropy", "SD"), edesio=c(ineq(filter(all_data, street == "R._Edésio_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Edésio_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Edésio_Silva")$qscore)), inacio=c(ineq(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore)), maciel=c(ineq(filter(all_data, street == "R._Maciel_Pinheiro")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Maciel_Pinheiro")$qscore, type="entropy"), sd(filter(all_data, street == "R._Maciel_Pinheiro")$qscore)), manoel=c(ineq(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore, type="entropy"), sd(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore)), floriano=c(ineq(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore, type="Gini"), ineq(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore, type="entropy"), sd(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore)), cristina= c(ineq(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore)) )

gini <- melt(filter(inequalities, labels=="Gini"), id=c("labels"))
entropy <- melt(filter(inequalities, labels=="Entropy"), id=c("labels"))
SD <- melt(filter(inequalities, labels=="SD"), id=c("labels"))

arrange(gini, desc(value))
arrange(entropy, desc(value))
arrange(SD, desc(value))


surprise_street <- read.csv("./surprise/surprise_data_street.csv")
surprise_unif_base_norm <- read.csv("./surprise/surprise_unif_base_norm.csv")
surprise_unif_base_norm_fixed <- read.csv("./surprise/surprise_unif_base_norm_fixed.csv")
surprise_unif_baseMed_norm <- read.csv("./surprise/surprise_unif_baseMedian_norm.csv")
surprise_unif_base_normAll <- read.csv("./surprise/surprise_unif_base_normAll.csv")
```

O que procurar?

1. Ponto mais heterogeneo/homogeneo
2. Melhor e pior local da rua
3. Melhor e pior área da rua (considerando os dois lados)
4. Áreas muito diferentes entre lados
5. Descontinuidades no mesmo lado
6. Heterogeneidade/Homogeneidade no ponto -> Isso tudo pode ser explicado pela regressão geral das features?
7. O que é a rua?


#Cristina Procópio

```{r echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
best_folder <- "../percepcaoLocal/agradavel/melhores/intersects/"
worst_folder <- "../percepcaoLocal/agradavel/piores/intersects/"

cristina <- dplyr::filter(all_data, street == "R._Cristina_Procópio_Silva") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)
cristina$surprise_street <- melt(dplyr::filter(surprise_street, street == "R._Cristina_Procópio_Silva"), id.vars = "street")$value
cristina$surprise_unif_base_norm <- melt(dplyr::filter(surprise_unif_base_norm, street == "R._Cristina_Procópio_Silva"), id.vars = "street")$value
cristina$surprise_unif_base_norm_fixed <- melt(dplyr::filter(surprise_unif_base_norm_fixed, street == "R._Cristina_Procópio_Silva"), id.vars = "street")$value
cristina$surprise_unif_baseMed_norm <- melt(dplyr::filter(surprise_unif_baseMed_norm, street == "R._Cristina_Procópio_Silva"), id.vars = "street")$value
cristina$surprise_unif_base_normAll <- melt(dplyr::filter(surprise_unif_base_normAll, street == "R._Cristina_Procópio_Silva"), id.vars = "street")$value




shapiro.test(cristina$qscore)
fitdistr(cristina$qscore, "normal")

print(">>> GINI da rua: ")
ineq(cristina$qscore, type="Gini")
gini <- data.frame("num"=integer(), "value"=double())
gini_surp_num <- data.frame("num"=integer(), "value"=double())
gini_surp_st <- data.frame("num"=integer(), "value"=double())
for (value in unique(cristina$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(cristina, num == value)$qscore, type="Gini"))
  gini_surp_num[nrow(gini_surp_num) + 1,] = list(value, ineq(filter(cristina, num == value)$surprise_num, type="Gini"))
  gini_surp_st[nrow(gini_surp_st) + 1,] = list(value, ineq(filter(cristina, num == value)$surprise_street, type="Gini"))
}
arrange(gini, desc(abs(value)))
arrange(gini_surp_st, desc(abs(value)))
arrange(gini_surp_num, desc(abs(value)))
```

```{r results='asis', echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(cristina, "Cristina Procopio", c(22, 45, 293, 315), c(135, 225))#Street 6 -> At number 436, 22 x 315 and 135 x 203. ADD 203 in side2
kable(mapping, format = "markdown")

show_street_data <- function (current_df, all_data, best_folder, worst_folder){
    color_space <- c("#000000", "#001900", "#003300", "#004c00", "#006600", "#007f00", "#009900", "#00b200", "#00cc00", "#00e500", "#00ff00")
    step <- (max(all_data$qscore) - min(all_data$qscore)) / length(color_space)
    thresholds <- seq(min(all_data$qscore), max(all_data$qscore), step)
    
    median_value <- median(all_data$qscore)
    cat(paste("++++++ Median all", median_value, "<br>"))
    cat(paste("++++++ Mean all", mean(all_data$qscore), "<br>"))
    result <- group_by(all_data, street) %>% summarise(mean=mean(qscore), median=median(qscore), sd=sd(qscore), gini=ineq(qscore, type="Gini")) %>% arrange(mean)
    result$upper <- result$mean + (result$sd *  1.96/ sqrt(20))#1.645 for 90%
    result$lower <- result$mean - (result$sd * 1.96 / sqrt(20))
    print(kable(result, format = "markdown"))
    
    cat("<div class='row'>")
    angleData = c()
    for(i in 1:nrow(current_df)) {
      row <- current_df[i,]
      
      street <- as.character(row$street)
      photo_name <- as.character(row$photo_name)
      num <- row$num
      angle <- row$angle
      score <- row$qscore
      angleData <- append(angleData, score)
      
      color_index <- findInterval(score, thresholds)[1]
      if (color_index > length(color_space)){
         color_index <- length(color_space)
      }
      
      folder <- "none"
      if (score >= median_value){
        if (file.exists(paste(best_folder, photo_name, sep=""))){
          url <- paste(best_folder, photo_name, sep="")
          folder <- "best"
        }else if (file.exists(paste(worst_folder, photo_name, sep=""))){
          url <- paste(worst_folder, photo_name, sep="")
          folder <- "worst"
        }else{
           url <- as.character(row$url)
        }
      }else{
        if (file.exists(paste(worst_folder, photo_name, sep=""))){
          url <- paste(worst_folder, photo_name, sep="")
          folder <- "worst"
        }else if (file.exists(paste(best_folder, photo_name, sep=""))){
          url <- paste(best_folder, photo_name, sep="")
          folder <- "best"
        }else{
           url <- as.character(row$url)
        }
      }
      
      cat(paste("<div class='col-xs-3' style=\"background-color:", color_space[color_index],"\">", sep=""))
      cat("<img src='", url,"' width='300px'>", sep = "")
      cat("<p style=\"color:white;font-size:90%\">", folder, "<br>", photo_name, "-> ", score,  "</p>", sep="")
      cat("</div>")
      if (i > 1 && i %% 4 == 0){
        cat("</div>")
        cat("####### Sumário do Número ", num, ": Max. ", max(angleData), " Min: ", min(angleData), " Diff: ", max(angleData) - min(angleData))
        cat("<div class='row'>")
        angleData = c()
      }
    }
}

show_street_data(cristina, all_data, best_folder, worst_folder)

```

1. Locais problemáticos na rua (olhando as fotos): 
    * 2 side1 (terreno com lixo)
    * 305 side2 (lixo, pouca manutenção)
    * 436 side2 203 (construção/menor manutenção) 
1. Virtudes na rua (olhando as fotos): 
    * 2 side2 (prédios bem mantidos, verde)
    * 66 inteiro (prédios bem mantidos, verde)
    * 261 inteiro (verde, prédios bem mantidos)
    * 436 menos o 203 (verde, casas bem mantidas)

>> Olhando os Q-Scores ao longo da rua

2. Melhor e pior local da rua: 
    * 66-p2 side2 (melhor) 
    * 305-p1 side2 (pior) diferença de 2.5 -> boa manutenção, verde, ruas largas x falta de manutenção, lixo
3. Melhor e pior lado da rua:
    * O side1 parece ligeiramente melhor (2 side2, 66 empate, 261, 305, 436 side1)
4. Melhor e pior área da rua (considerando os dois lados): 
    * 66 a 261 side1 (melhor) 
    * 305 a 436 side2 (pior) menor dif. de aprox. 2.1 -> verde, boa manutenção x lixo, menor manutenção, menos verde aparente (no 436 tem um ponto bacana que tem verde e boa manutenção, o outro nem tanto)
5. Áreas muito diferentes entre lados:  
    * 305 a 436 menor diferenca de aprox. 1 -> boa manutenção, verde x lixo, pouca manutenção, menos verde aparente (no 436 tem um ponto bacana que tem verde e boa manutenção, o outro nem tanto)
6. Descontinuidades no mesmo lado
    * 66 side2 dif de 0.8 -> manutenção e verde aparente
    * 305 side2 dif de 0.8 -> no meio da falta de manutenção, lixo a segunda imagem tem um prédio melhor conservado
    * 305 side1 dif. de 0.45 -> mais prédios mais conservados
    * 436 side2 dif. de 1.3 -> mais verde aparente, construção/manutenção
7. Heterogeneidade/Homogeneidade no ponto:
    * os pontos mais heterogêneros foram o 305 (lixo, falta de manutenção) e 436 (falta de manuteção, verde aparente). 
    * o mais homogêneo foi o 261 que é um ponto bem mantido e com verde
8. Foram encontrados os problemas? 
    * Dois (305 e 436) dos três pontos foram encontrados. Tanto no número 305 como no 436, dentre os pontos avaliados, pôde-se perceber locais que necessitam de melhoria na rua.
    * O ponto 2 seria encontrado se seguissemos a lista de heterogeneidade (2 mais homogeneo) ou se avaliassemos diferenças entre os dois lados por ponto (complicado em vários casos).
    * Além disso, no ponto 66 sugere-se uma melhoria com um pouco mais de verde de modo a homogenizar ainda mais o ponto.
9. O que é a rua?
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação? Variações de locais melhores e piores ao longo de toda a rua, alguns números com grande variação no local
    * Existe um lado melhor? No final da rua side1 parece despertar maiores preferências que o outro lado. Média e mediana de side1 melhores
    * Existe uma área melhor pior? Conforme questão 4 do número 66 ao 261 parece termos a melhor área da rua e do número 305 ao 436 a pior área.


>> Olhando o surprise maps (uniforme + base rate + normal)

1. Máximo e Mínimo?
    * 66 p2 side2 
    * 305 p1 side2 diferença de 2.5 -> boa manutenção, verde, ruas largas x falta de manutenção, lixo
2. Mais diversidade?
   * 436, 1 estranho: verde, manutenção x construção, menor manutenção, problema na pista, lixo
   * 305, 2 lados separados: verde, manutenção x lixo, muro acabado
   * 66, 1 estranho: verde, prédios bem mantidos x verde menos destacado, manutenção
   * 261, 1 estranho: verde, boa manutenção x lixo, árvores pequenas, poste
   * 2, 2 lados separados: verde, prédios mantidos x terreno, lixo
3. Menor diversidade?
   * 2 como ponto mais homogêneo, mas ainda assim com dispersão
4. Diferenças/saltos no lado?
   * 436, side2
   * 261, side2
   * 66, side2 -> recaem nos estranhos apontados acima
5. Avaliação Problemas
   * Pesquisador: 3 problemas (descritos acima)
   * Recall = método / pesquisador = 3/3 = 1
   * Precisão = reais / método = 4/5 = 0.8 (menos o 66 1 estranho)
6. Avaliação Virtudes
   * Pesquisador: 4 virtudes (descritos acima)
   * Recall = método / pesquisador = 4/4 = 1
   * Precisão = reais / método = 4/5 = 0.75 (menos o 305 2 lados separdos)
7. Descrição
   * Média/mediana: 4.92/5.12 > 4.68/4.82 -> rua de mediana para boa
   * Variação no surprise? Variações ao longo da rua, alternando locais legais e não tão legais
   * Lado melhor? Side1 (8) x Side2 (5)
   * Região melhor? não fica claro no surprise, mas **nos scores pode-se falar do 66 ao 261**
   
   
#Edésio Silva

```{r echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
edesio <- dplyr::filter(all_data, street == "R._Edésio_Silva") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)
edesio$surprise_street <- melt(dplyr::filter(surprise_street, street == "R._Edésio_Silva"), id.vars = "street")$value
edesio$surprise_unif_base_norm <- melt(dplyr::filter(surprise_unif_base_norm, street == "R._Edésio_Silva"), id.vars = "street")$value
edesio$surprise_unif_base_norm_fixed <- melt(dplyr::filter(surprise_unif_base_norm_fixed, street == "R._Edésio_Silva"), id.vars = "street")$value
edesio$surprise_unif_baseMed_norm <- melt(dplyr::filter(surprise_unif_baseMed_norm, street == "R._Edésio_Silva"), id.vars = "street")$value
edesio$surprise_unif_base_normAll <- melt(dplyr::filter(surprise_unif_base_normAll, street == "R._Edésio_Silva"), id.vars = "street")$value

shapiro.test(edesio$qscore)
fitdistr(edesio$qscore, "normal")

print(paste(">>> GINI da rua: ", ineq(edesio$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
gini_surp_num <- data.frame("num"=integer(), "value"=double())
gini_surp_st <- data.frame("num"=integer(), "value"=double())
for (value in unique(edesio$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(edesio, num == value)$qscore, type="Gini"))
  gini_surp_num[nrow(gini_surp_num) + 1,] = list(value, ineq(filter(edesio, num == value)$surprise_num, type="Gini"))
  gini_surp_st[nrow(gini_surp_st) + 1,] = list(value, ineq(filter(edesio, num == value)$surprise_street, type="Gini"))
}
arrange(gini, desc(abs(value)))
arrange(gini_surp_st, desc(abs(value)))
arrange(gini_surp_num, desc(abs(value)))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=20, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(edesio, "Edésio Silva", c(22, 135), c(315, 203))#Street 1
kable(mapping, format = "markdown")

show_street_data(edesio, all_data,  best_folder, worst_folder)

```

1. Locais problemáticos na rua (olhando as fotos): 
    * 70 side1 135 (construção, menor manutenção, lixo) e side2 315 (menor manutenção), 203 (um pouco de lixo e menor manutenção); 
    * 602 side 203 (terreno com muito lixo); 
    * 1136 todos os lados (pouca manutenção, lixo, terrenos);
1. Virtudes na rua (olhando as fotos): 
    * 70 22 (verde, casas bem mantidas)
    * 306 menos o 315 (verde, casas bem mantidas)
    * 602 22 e 315 (verde, casas bem mantidas)
    * 1546 todo (casas bem mantidas, verde)
    
>> Olhando os Q-Scores ao longo da rua

2. Melhor e pior local da rua: 
    * 602 p2 side2 
    * 70 p1 side1. Dif de 1.6 -> boa manutenção, algum verde x construção, pouca manutenção, sem verde
3. Melhor e pior lado da rua:
    * Não fica claro
4. Melhor e pior área da rua (considerando os dois lados): 
    * confuso, não dá pra discernir facilmente
5. Áreas muito diferentes entre lados: 
    * 70 a 306 melhora em side2 e piora em side1
        * No side1 temos um ponto muito bom (70, 22) que foge do padrão de melhoria que sairia de pouca manutenção e falta de áŕvore para melhor manutenção e mais árvores. 
        * No side2 temos uma certa melhoria de manutenção + árvores aparentes
6. Descontinuidades no mesmo lado
    * 70 no side1, diferença de 1.55 -> construção, falta de verde x melhor manutenção, verde
    * 602 no side1, diferença de 0.6 -> falta de manutenção, menos verde aparente x melhor manutenção, verde
    * 602 no side2, diferença de 1.15 -> manutenção, verde x lixão
    * 1136 no side2, diferença de 0.6 -> lixão
7. Heterogeneidade/Homogeneidade no ponto: 
    * os pontos mais heterogêneos foram o 70 (construção, menor manutenção x melhor manutenção e algum verde) e 602 (menor manutenção, lixão x melhor manutenção, verde)
    * o ponto mais homogêneo foi o 1546, é bem mantido e com alguma vegetação.
8. Foram encontrados os problemas? 
    * O número 1136 no side1 não foi apontado dentre os 5 problemas levantados. 
    * O 1136 seria encontrado (diferença de 0.45) se continuássemos olhando as descontinuidades no mesmo lado da rua ou as piores notas (2 pior nota)
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação?  Variações de locais melhores e piores ao longo de toda a rua, alguns números com grande variação no local
    * Existe um lado melhor? Não
    * Existe uma área melhor pior? Não
    
>> Olhando o surprise maps (uniforme + base rate + normal)

1. Máximo e Mínimo?
    * 602 p2 side2 
    * 70 p1 side1. Dif de 1.6 -> boa manutenção, algum verde x construção, pouca manutenção, sem verde
2. Mais diversidade?
   * 1546, p2 side1 estranho: ??
   * 306, p1 side1 estranho: material de construção
   * 602, um ponto de cada side separado: casas bem mantidas, verde x terreno, muro mal mantido
   * 1136, um ponto de cada side separado: casa melhor mantida, verde x terreno, casas muito mal mantidas
   * 70, p2 side1 estranho: casa bem mantida, verde x construção, casas mal mantidas, casas mais simples, carro
3. Menor diversidade?
   * Não tem ponto homogêneo
4. Diferenças/saltos no lado?
   * 1136, um ponto de cada side separado
   * 602, um ponto de cada side separado
5. Avaliação Problemas
   * Pesquisador: 3 problemas (descritos acima)
   * Recall = método / pesquisador = 2.5/3 = 0.833 (dois de 4 problemas faltando no 1136)
   * Precisão = reais / método = 3/5 = 0.6 (1546 tem problema? 306 nao foi percebido)
6 Avaliação Virtudes
   * Pesquisador: 4 virtudes (descritos acima)
   * Recall = método / pesquisador = 3.75/4 = 0.93 (1 ponto do 1546 ficou como estranho negativo) 
   * Precisão = reais / método = 4/5 = 0.75 (menos o 1136)
7. Descrição
   * Média/mediana: 4.77/4.82 > 4.68/4.82 -> rua de mediana para boa
   * Variação no surprise? Variações ao longo da rua, alternando locais legais e não tão legais
   * Lado melhor? Não fica tão claro, Side1 (5) x Side2 (6)
   * Região melhor? não fica claro nem no surprise e nem nos scores


#Inácio Marques
```{r echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
inacio <- dplyr::filter(all_data, street == "R._Inácio_Marquês_da_Silva") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)
inacio$surprise_street <- melt(dplyr::filter(surprise_street, street == "R._Inácio_Marquês_da_Silva"), id.vars = "street")$value
inacio$surprise_unif_base_norm <- melt(dplyr::filter(surprise_unif_base_norm, street == "R._Inácio_Marquês_da_Silva"), id.vars = "street")$value
inacio$surprise_unif_base_norm_fixed <- melt(dplyr::filter(surprise_unif_base_norm_fixed, street == "R._Inácio_Marquês_da_Silva"), id.vars = "street")$value
inacio$surprise_unif_baseMed_norm <- melt(dplyr::filter(surprise_unif_baseMed_norm, street == "R._Inácio_Marquês_da_Silva"), id.vars = "street")$value
inacio$surprise_unif_base_normAll <- melt(dplyr::filter(surprise_unif_base_normAll, street == "R._Inácio_Marquês_da_Silva"), id.vars = "street")$value


shapiro.test(inacio$qscore)
fitdistr(inacio$qscore, "normal")

print(paste(">>> GINI da rua: ", ineq(inacio$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
gini_surp_num <- data.frame("num"=integer(), "value"=double())
gini_surp_st <- data.frame("num"=integer(), "value"=double())
for (value in unique(inacio$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(inacio, num == value)$qscore, type="Gini"))
  gini_surp_num[nrow(gini_surp_num) + 1,] = list(value, ineq(filter(inacio, num == value)$surprise_num, type="Gini"))
  gini_surp_st[nrow(gini_surp_st) + 1,] = list(value, ineq(filter(inacio, num == value)$surprise_street, type="Gini"))
}
arrange(gini, desc(abs(value)))
arrange(gini_surp_st, desc(abs(value)))
arrange(gini_surp_num, desc(abs(value)))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=20, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(inacio, "Inacio", c(203, 112, 90), c(293, 270, 22))#Street 2. ADD 180 in side1 
kable(mapping, format = "markdown")

show_street_data(inacio, all_data,  best_folder, worst_folder)

```

1. Locais problemáticos na rua (olhando as fotos): 
    * 54 angulos 203 e 293 (falta de manutenção e verde); 
    * 120 angulo 203 (falta de manutenção, lixo e verde); 
    * 360 angulos 90 e 203 (terreno); 
    * todo o número 500 
1. Virtudes na rua (olhando as fotos): 
    * 54, 22 (casas bem mantidas, verde)
    * 120, 22 e 293 (casas bem mantidas, verde)
    * 239 todo (casas bem mantidas, verde)
    * 360, 22 e 270 (museu, verde, boa manutenção)
    
>> Olhando os Q-Scores ao longo da rua

2. Melhor e pior local da rua: 
    * 239 p1 side1 
    * 54 p2 side2. Diferenca de 1.45 -> boa manutenção, algum verde x menor manutenção, lixo
3. Melhor e pior lado da rua:
    * O side2 parece ligeiramente melhor (54 e 239 empate (uma foto de um lado e outra do outro), 500 empate com igualdade, 120 e 360 side2)
4. Melhor e pior área da rua (considerando os dois lados): 
    * 239 a 360 (melhor)? manutenção, verde, museu, apesar de duas visões de terreno que tiveram notas não tão ruins 
5. Áreas muito diferentes entre lados: 
    * 120 a 239 -> no 239 temos um maior equilíbrio bom entre todos os pontos (boa manutenção, verde), mas no 120 temos um ponto pior para o side1 (menor manutenção, lixo, ausência de verde) 
6. Descontinuidades no mesmo lado:
    * 54 side1, diferenca de 1.2 -> melhor manutenção x pior manutenção
    * 54 side2, diferença de 0.6 -> melhor manutenção, verde x pior manutenção, falta de verde
    * 120 side1, diferença de 1.1 -> melhor manutenção, verde x pior manutenção, falta de verde
7. Heterogeneidade/Homogeneidade no ponto: 
    * os pontos mais heterogêneos foram o 54 (pior manutenção, falta de verde x melhor manutenção, verde) e 120 (pior manutenção, falta de verde x melhor manutenção); 
    * o mais homogêneo foi o 500 (pouca manutenção, muros, terrenos)  
8. Foram encontrados os problemas? 
    * Dos 4 pontos levantados o 360 não foi percebido pelas perguntas acima. 
    * Se olhássemos o terceiro ponto mais heterogêneo encontraríamos o problema do ponto 360 (menor diferença de 0.4) ou como os pontos de cada lado tem notas parecidas se olhássemos diferenças entre lados no ponto. 
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação?  Variações de locais melhores e piores ao longo de toda a rua, alguns números com grande variação no local
    * Existe um lado melhor? Side2 ligeiramente melhor
    * Existe uma área melhor pior? Não
    
>> Olhando o surprise maps (uniforme + base rate + normal)

1. Máximo e Mínimo?
    * 239 p1 side1 
    * 54 p2 side2. Diferenca de 1.45 -> boa manutenção, algum verde x menor manutenção, lixo
2. Mais diversidade?
   * 120, side1 p2 estranho: lixo, falta de manutenção x melhor manutenção, verde
   * 360, side1 separado de side2: visões do museu x terreno
   * 54, 1 ponto de cada side separado: melhor manutenção, verde x pior manutenção, lixo
3. Menor diversidade?
   * 239 homogêneo e positivo (boa manunteção, verde)
   * 500 homogêneo e negativo (falta de manutenção, muros, terreno)
4 Diferenças/saltos no lado?
   * 54, 1 ponto de cada side separado
5. Avaliação Problemas
   * Pesquisador: 4 problemas (descritos acima)
   * Recall = método / pesquisador = 4/4 = 1
   * Precisão = reais / método = 4/4 = 1
6. Avaliação Virtudes
   * Pesquisador: 4 virtudes (descritos acima)
   * Recall = método / pesquisador = 4/4 = 1
   * Precisão = reais / método = 4/4 = 1
7. Descrição
   * Média/mediana: 4.84/5.08 > 4.68/4.82, rua de mediana para boa
   * Variação no surprise? Alguns pontos mais homogêneos ao longo da rua, um bom e outro ruim, porém existem pontos de altos e baixos ao longo da rua
   * Lado melhor? Side1 (4) x Side2 (7), side2 ligeiramente melhor
   * Região melhor? Pelo surprise parece ser a região de 120 a 360, mesma sensação olhando os scores.

#Floriano peixoto
```{r echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
floriano <- dplyr::filter(all_data, street == "Av._Mal._Floriano_Peixoto") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)
floriano$surprise_street <- melt(dplyr::filter(surprise_street, street == "Av._Mal._Floriano_Peixoto"), id.vars = "street")$value
floriano$surprise_unif_base_norm <- melt(dplyr::filter(surprise_unif_base_norm, street == "Av._Mal._Floriano_Peixoto"), id.vars = "street")$value
floriano$surprise_unif_base_norm_fixed <- melt(dplyr::filter(surprise_unif_base_norm_fixed, street == "Av._Mal._Floriano_Peixoto"), id.vars = "street")$value
floriano$surprise_unif_baseMed_norm <- melt(dplyr::filter(surprise_unif_baseMed_norm, street == "Av._Mal._Floriano_Peixoto"), id.vars = "street")$value
floriano$surprise_unif_base_normAll <- melt(dplyr::filter(surprise_unif_base_normAll, street == "Av._Mal._Floriano_Peixoto"), id.vars = "street")$value

shapiro.test(floriano$qscore)
fitdistr(floriano$qscore, "normal")

print(paste(">>> GINI da rua: ", ineq(floriano$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
gini_surp_num <- data.frame("num"=integer(), "value"=double())
gini_surp_st <- data.frame("num"=integer(), "value"=double())
for (value in unique(floriano$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(floriano, num == value)$qscore, type="Gini"))
  gini_surp_num[nrow(gini_surp_num) + 1,] = list(value, ineq(filter(floriano, num == value)$surprise_num, type="Gini"))
  gini_surp_st[nrow(gini_surp_st) + 1,] = list(value, ineq(filter(floriano, num == value)$surprise_street, type="Gini"))
}
arrange(gini, desc(abs(value)))
arrange(gini_surp_st, desc(abs(value)))
arrange(gini_surp_num, desc(abs(value)))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=20, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(floriano, "Floriano Peixoto", c(22,293), c(112,203))#Street 5
kable(mapping, format = "markdown")

show_street_data(floriano, all_data,  best_folder, worst_folder)
```

1. Locais problemáticos na rua (olhando as fotos): 
    * 549 angulo 22 (manutenção no prédio)
    * 813 angulos 22 (manutenção no telegrafo/histórico) 
    * 913 angulo 203 (manutenção prédio amarelo)
1. Virtudes na rua (olhando as fotos): 
    * 480 todo (verde, boa manutenção)
    * 580 112 e 203 (verde)
    * 660 (verde, boa manutenção)
    * 826 22 (telegrafo) e 112 (igreja)
    
>> Olhando os Q-Scores ao longo da rua    
    
  
2. Melhor e pior local da rua: 
    * 549 p2 side2 (muito verde bem mantido, praça) 
    * 913 p2 side1 (lojas com visual mais acanhado). Diferença de 1.4
3. Melhor e pior lado da rua:
    * O side2 parece ligeiramente melhor (445, 549, 913 side2, 691 side1, 813 empate)
4. Melhor e pior área da rua (considerando os dois lados): 
    * 691 a 813? verde, bem mantido e alguns pontos precisando de manutenção.
5. Áreas muito diferentes entre lados: 
    * 549 (praça x prédios mais acanhados)??
6. Descontinuidades no mesmo lado: 
    * 445 side1, diferença de 0.7 -> ônibus??
    * 445 side2, diferença de 0.6 -> mais verde x menos verde, prédio
    * 549 side2, diferença de 0.4 -> mais verde, praça x menos verde, estacionamento
7. Heterogeneidade/Homogeneidade no ponto: 
    * os pontos mais heterogêneos foram o 913 (visual das lojas?) e 549 (praça, verde x estacionamento, prédio). 
    * O mais homogênero foi o 691 (prédios até bem mantidos com algumas árvores)
8. Foram encontrados os problemas? 
    * O ponto 813 dos 3 apontados não foi percebido. 
    * Se olhássemos outras descontinuidades no mesmo lado acabaríamos chegando nessa comparação apesar da baixa diferença de 0.2.
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação? Rua mais homogênea, com pequenas variações entre alguns de seus pontos
    * Existe um lado melhor? Side2 ligeiramente melhor
    * Existe uma área melhor pior? Não

>> Olhando o surprise maps (uniforme + base rate + normal)

1. Máximo e Mínimo?
    * 549 p2 side2 (muito verde bem mantido, praça) 
    * 913 p2 side1 (lojas com visual mais acanhado). Diferença de 1.4
2. Mais diversidade?
   * 913, side2 separado de side1: visual das lojas, manutenção?
   * 549, p2 side1 afastado: visual de lojas x praça
   * 445, 1 ponto de cada side separado: verde, praça x mais prédio?
   * 813, 1 ponto de cada side separado: igreja, prédios x estilo de prédios, telegráfo?
3. Menor diversidade?
   * 660, ponto mais homogêneo e positivo: verde, prédios bem mantidos
4 Diferenças/saltos no lado?
   * 445, 1 ponto de cada side separado
   * 813, 1 ponto de cada side separado
5. Avaliação Problemas
   * Pesquisador: 3 problemas (descritos acima)
   * Recall = método / pesquisador = 1/3 = 0.33 (menos o 549 ang 22 e o 913 ang 203 )
   * Precisão = reais / método = 1/4 = 0.25 (913 sides afastados, 549 p2 side1 afastado, 445 1 ponto de cada side afastado)
6. Avaliação Virtudes
   * Pesquisador: 4 virtudes (descritos acima)
   * Recall = método / pesquisador = 3.5/4 = 0.87 (metade do 480)
   * Precisão = reais / método = 3/4 = 0.75 (menos o 913)
7. Descrição
   * Média/mediana: 5.06/5.04 x 4.68/4.82 -> rua de mediana para boa
   * Variação no surprise? Em cada ponto temos algumas variações ao longo da rua e um ponto mais homogêneo positivamente
   * Lado melhor? Side1 (6) x Side2 (8), side2 ligeiramente melhor
   * Região melhor? Não dá para identificar pelo surprise, pelos **scores poderia-se dizer do 552 ao 694?**

#Maciel Pinheiro
```{r echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
maciel <- dplyr::filter(all_data, street == "R._Maciel_Pinheiro") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)
maciel$surprise_street <- melt(dplyr::filter(surprise_street, street == "R._Maciel_Pinheiro"), id.vars = "street")$value
maciel$surprise_unif_base_norm <- melt(dplyr::filter(surprise_unif_base_norm, street == "R._Maciel_Pinheiro"), id.vars = "street")$value
maciel$surprise_unif_base_norm_fixed <- melt(dplyr::filter(surprise_unif_base_norm_fixed, street == "R._Maciel_Pinheiro"), id.vars = "street")$value
maciel$surprise_unif_baseMed_norm <- melt(dplyr::filter(surprise_unif_baseMed_norm, street == "R._Maciel_Pinheiro"), id.vars = "street")$value
maciel$surprise_unif_base_normAll <- melt(dplyr::filter(surprise_unif_base_normAll, street == "R._Maciel_Pinheiro"), id.vars = "street")$value

shapiro.test(maciel$qscore)
fitdistr(maciel$qscore, "normal")

print(paste(">>> GINI da rua: ", ineq(maciel$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
gini_surp_num <- data.frame("num"=integer(), "value"=double())
gini_surp_st <- data.frame("num"=integer(), "value"=double())
for (value in unique(maciel$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(maciel, num == value)$qscore, type="Gini"))
  gini_surp_num[nrow(gini_surp_num) + 1,] = list(value, ineq(filter(maciel, num == value)$surprise_num, type="Gini"))
  gini_surp_st[nrow(gini_surp_st) + 1,] = list(value, ineq(filter(maciel, num == value)$surprise_street, type="Gini"))
}
arrange(gini, desc(abs(value)))
arrange(gini_surp_st, desc(abs(value)))
arrange(gini_surp_num, desc(abs(value)))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=20, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(maciel, "Maciel Pinheiro", c(360, 90), c(270, 180))#Street 3
kable(mapping, format = "markdown")

show_street_data(maciel, all_data,  best_folder, worst_folder)
```

1. Locais problemáticos na rua (olhando as fotos): 
    * 130 angulo 360 (manutenção de prédio); 
    * 190 angulo 180 (manutenção de prédio); 
    * 284 360 (manutenção de prédio); 
    * 360 270 (manutenção de prédio). 
    * Não existem árvores na rua?
    
1. Virtudes na rua (olhando as fotos): 
    * Em geral bem conservada
    * 360, 360 (prédio conservado + praça)
    * 190, 90 e 360 (prédios ainda mais bem conservados + estilo)
    * 130, 90, 180 e 270 (prédios ainda mais bem conservados + estilo)
    
>> Olhando os Q-Scores ao longo da rua    
  
2. Melhor e pior local da rua: 
    * 248 angulo 180 (boa manutenção)
    * 190 180 (manutenção de prédio faltando)
3. Melhor e pior lado da rua:
    * O side1 parece ligeiramente melhor (130, 284 empate, 190, 360 side1, 248 side2)
4. Melhor e pior área da rua (considerando os dois lados): 
    * confuso!
5. Áreas muito diferentes entre lados: 
    * 284 a 360, com side1 ligeiramente melhor (no side2 temos um estacionamento e um caminhão na vista)
6. Descontinuidades no mesmo lado: 
    * 190 side2, diferença de 0.9 -> prédio precisando de manutenção x boa manutenção
    * 248 side1, diferença de 0.7 -> menos identificadores, prédios um pouco mais novos x identificadores e prédios um pouco mais antigos
    * 248 side2, diferença de 0.5 -> menos identificadores, prédios um pouco mais novos x identificadores e prédios um pouco mais antigos
    * 284 side2, diferença de 0.5 -> boa manutenção x estacionamento, prédio, carros 
7.  Heterogeneidade/Homogeneidade no ponto: 
    * Os pontos mais heterogêneos foram o 248 (boa manutenção x mais identificadores/prédios) e 190 (boa manutenção x prédio que precisa de manutenção). 
    * O mais homogêneo foi o 284 (boa manutenção, apesar do estacionamento e prédio precisando de manutenção)
8.  Foram encontrados os problemas? 
    * Apenas o 190 dos 4 pontos foi encontrado. 
    * A valorização da presença de árvores no final da rua pareceu não fazer um efeito tão alto em relação ao restante da rua. 
    * O 130 seria encontrado se continuássemos a olhar descontinuidades por lado. 
    * O 360 270 seria verificado se olhando para a praça comparássemos. 
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para boa
    * Existe muita variação? Rua mais homogênea, com pequenas variações entre alguns de seus pontos. Variações parecem estar ligadas ao estado de manutenção e identificadores
    * Existe um lado melhor? O side1 parece ligeiramente melhor
    * Existe uma área melhor pior? Do 190 ao 248 parece ser a melhor área, e do 248 ao 284 a pior

>> Olhando o surprise maps (uniforme + base rate + normal) - DAQUI!

1. Máximo e Mínimo?
    * 248 angulo 180 (boa manutenção)
    * 190 180 (manutenção de prédio faltando)
2. Mais diversidade?
   * 360, p2 side1 (360) afastado (melhor conservação, estilo, sem caminhão + praça)
   * 190, p1 side2 (180) afastado (prédio precisando de manutenção)
   * 248, 1 ponto de cada side separado (prédios conservados, estilo + motos, estilos)
   * 284, p2 side2 (270) afastado (estacionamento + prédio + carros)
   * 130, 1 ponto de cada side separado (prédios conservados, estilo + estilo, prédio precisando de conservação)
3. Menor diversidade?
   * alguma heterogeneidade em todos os pontos
4 Diferenças/saltos no lado?
   * 248, 1 ponto de cada side separado
   * 130, 1 ponto de cada side separado 
5. Avaliação Problemas
   * Pesquisador: 5 problemas (descritos acima)
   * Recall = método / pesquisador = 3 de 5 (arvore no geral e 284 360 não foram percebidos) = 0.6
   * Precisão = reais / método = 3/5 (248 1 ponto de cada side separado, 284 270 afastado) = 0.6
6. Avaliação Virtudes
   * Pesquisador: 4 virtudes (descritos acima)
   * Recall = método / pesquisador = 3.66/4 = 0.91 (130 o método acha 2 pontos legais, falta 1)
   * Precisão = reais / método = 3/5 = 0.6 (248 180, 284 3 pontos legais)
7. Descrição
   * Média/mediana: 4.84/4.88 > 4.68/4.82 -> rua de mediana para boa
   * Variação no surprise? Temos alternância de pontos melhores e piores ao longo de toda a rua
   * Lado melhor? Side1 (7) x Side2(4) -> side1 ligeiramente melhor
   * Região melhor? O meio da rua (190 a 284) parece ter mais concentração de surpresas positivas, confirmado olhando os scores

#Manoel Pereira
```{r echo=FALSE, fig.height=20, fig.width=12, warning=FALSE}
manoel <- dplyr::filter(all_data, street == "R._Manoel_Pereira_de_Araújo") %>% dplyr::group_by(num) %>% dplyr::arrange(street, num, angle) %>% dplyr::select(url, photo_name, street, num, angle, qscore, V3, ci)
manoel$surprise_street <- melt(dplyr::filter(surprise_street, street == "R._Manoel_Pereira_de_Araújo"), id.vars = "street")$value
manoel$surprise_unif_base_norm <- melt(dplyr::filter(surprise_unif_base_norm, street == "R._Manoel_Pereira_de_Araújo"), id.vars = "street")$value
manoel$surprise_unif_base_norm_fixed <- melt(dplyr::filter(surprise_unif_base_norm_fixed, street == "R._Manoel_Pereira_de_Araújo"), id.vars = "street")$value
manoel$surprise_unif_baseMed_norm <- melt(dplyr::filter(surprise_unif_baseMed_norm, street == "R._Manoel_Pereira_de_Araújo"), id.vars = "street")$value
manoel$surprise_unif_base_normAll <- melt(dplyr::filter(surprise_unif_base_normAll, street == "R._Manoel_Pereira_de_Araújo"), id.vars = "street")$value

shapiro.test(manoel$qscore)
fitdistr(manoel$qscore, "normal")

print(paste(">>> GINI da rua: ", ineq(manoel$qscore, type="Gini")))
gini <- data.frame("num"=integer(), "value"=double())
gini_surp_num <- data.frame("num"=integer(), "value"=double())
gini_surp_st <- data.frame("num"=integer(), "value"=double())
for (value in unique(manoel$num)){
  gini[nrow(gini) + 1,] = list(value, ineq(filter(manoel, num == value)$qscore, type="Gini"))
  gini_surp_num[nrow(gini_surp_num) + 1,] = list(value, ineq(filter(manoel, num == value)$surprise_num, type="Gini"))
  gini_surp_st[nrow(gini_surp_st) + 1,] = list(value, ineq(filter(manoel, num == value)$surprise_street, type="Gini"))
}
arrange(gini, desc(abs(value)))
arrange(gini_surp_st, desc(abs(value)))
arrange(gini_surp_num, desc(abs(value)))
```

```{r results='asis', echo=FALSE, out.extra='', fig.height=20, fig.width=12, warning=FALSE}
mapping <- plot_ci_per_photo(manoel, "Manoel Pereira", c(22, 135, 293), c(315, 112, 203, 225))#Street 4
kable(mapping, format = "markdown")

show_street_data(manoel, all_data,  best_folder, worst_folder)
```

1. Locais problemáticos na rua (olhando as fotos): 
    * A rua em geral precisa de manutenção. 
    * Alguns pontos parecem ainda piores como o 222 angulo 22 (prédio acabado + itens na rua), 300 angulo 22 e 135 (barraca, itens na rua), 370 angulo 22, 203 e 315 (prédios acabados, barracas). 
    * Ausência de árvores de fato na rua.

1. Virtudes na rua (olhando as fotos): 
    * 222, 203 e 315 (prédios mais bem conservados, apesar de parecerem galpões)
    * 300, 203 (prédio melhor conservado)
    
>> Olhando os Q-Scores ao longo da rua
    
2. Melhor e pior local da rua: 
    * 222 p1 side2 (prédio mais conservado da sucata) 
    * 188 p1 side2 (prédio acabado, carros, itens na rua)
3. Melhor e pior lado da rua:
    * Não fica claro
4. Melhor e pior área da rua (considerando os dois lados): 
    * confuso!
5. Áreas muito diferentes entre lados: 
    * 300 a 370 (um lado com alguns pontos melhor conservados, o outro lado com mais variação); 
    * 222 a 300 (um lado com alguns pontos melhor conservados, o outro lado com mais variação)
6. Descontinuidades no mesmo lado: 
    * 188 side2, diferença de 0.4 -> manutenção um pouco melhor
    * 222 side2, diferença de 0.4 -> manutenção de prédios e mais itens na rua na imagem menos preferida
    * 370 side1, diferença de 0.6 -> pequena variação de manutenção, menos itens na rua na imagem preferida
7. Heterogeneidade/Homogeneidade no ponto: 
    * Os pontos mais heterogêneos foram o 370 (manutenção um pouco melhor em alguns locais e menos itens na rua) e o 188 (manutenção um pouco melhor em alguns locais). 
    * O ponto mais homogêneo foi o 392 (melhor manutenção em média dos prédios)
8. Foram encontrados os problemas? 
    * Olhando as diferenças entre lados englobamos os números 222, 300 e 370. 
    * Olhando as maiores descontinuidades aparentes englobamos 222 e 370. 
    * Como a rua toda praticamente não tem árvores fica difícil pesar este aspecto dado a pobreza de manutenção, todavia a imagem 370 315 apesar de péssima manutenção e barracas/itens na rua teve uma nota melhor que outros locais e as árvores foram marcadas junto com o céu.
9. O que é a rua? 
    * A nota média/mediana é boa ou ruim? De mediana para ruim, com notas baixas
    * Existe muita variação? Rua mais homogênea, com alguns pontos que se destacam positivamente por ter uma melhor manutenção ou menos itens na rua e outros que se destacam negativamente por terem manutenção ainda pior e/ou mais itens na rua
    * Existe um lado melhor? Não
    * Existe uma área melhor pior? Não
    
    
>> Olhando o surprise maps (uniforme + base rate + normal)

1. Máximo e Mínimo?
    * 222 p1 side2 (prédio mais conservado da sucata) 
    * 188 p1 side2 (prédio acabado, carros, itens na rua)
2. Mais diversidade?
   * 392, 1 ponto de cada side separado (prédios melhores conservados x construção, mais itens na rua)
   * 222, p1 side2 separado (prédio melhor conservado)
   * 370, 1 ponto de cada side separado (melhor conservação, menos itens x pior conservação, mais itens na rua)
   * 300, side2 melhor que side1 (menos itens na rua, conservação)
3. Menor diversidade?
   * 188 mais próximo de homogêneo
4 Diferenças/saltos no lado?
   * 392, 1 ponto de cada side separado
   * 370, 1 ponto de cada side separado 
5. Avaliação Problemas
   * Pesquisador: 5 problemas (descritos acima)
   * Recall = método / pesquisador = 3.66/5 = 0.73 (falta de arvore e um ponto do 370)
   * Precisão = reais / método =  3/6 = 0.5 (188 p1 side2, 392 1 ponto de cada side, 188 homogeneo mais negativo)
6. Avaliação Virtudes
   * Pesquisador:  2 virtudes (descritos acima)
   * Recall = método / pesquisador = 2/2 = 1
   * Precisão = reais / método = 2/4 = 0.5 (392 1 ponto de cada side, 370 1 ponto de cada side)
7. Descrição
   * Média/mediana: 3.65/3.65 x 4.68/4.82 -> rua de mediana para ruim
   * Variação no surprise? Início da rua mais homogêneo, mas com alternâncias de melhores e piores pontos ao longo da rua
   * Lado melhor? Side1 (3) x Side2 (5) -> side2 ligeiramente melhor
   * Região melhor? Não dá para dizer pelo surprise maps, olhando os scores também é complicado

#Sumário comparações dos Surprise Maps com base rate usando média ou mediana

```{r table2, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "  
| Street        | Base Rate (median)           | Base Rate (mean)  |
|---------------|:-------------:|------:|
| Cristina      |  |  X:  2 (dois lados separados), 261 (1 estranho no side2)|
| Edésio        |   1546 (todos positivos)   |  X: 306-135 (pior), 1136 (1 ponto de cada side abaixo e acima)     |
| Inácio        | 0: 54 (side2 talvez um pouco mais surpreendente positivamente)  | 0    |
| Floriano      |   549 (side2 mais positivo)     | X: 549 (um ponto de side1 positivo é aceitável), 660 (a representação menos ruim é colocar todos positivos)    |
| Maciel        | 284 (todos negativos pode ser entendido por notas mais baixas que resto da rua)  |  X: 130 (1 ponto de cada side abaixo e acima), 284 (270 negativo é aceitável)   |
| Manoel        | 188 (1 ponto de side2 mais positivo e side1 com 1 ponto ligeiramente melhor)  | X: 188 (1 ponto de cada side no 0, 1 positivo e outro negativo), 222 (1 ponto de side2 mais positivo)   |
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```


#Sumário comparações dos Surprise Maps com normal para todas as ruas x normal por rua

```{r table3, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "  
| Street        | Normal All           | Normal Street  |
|---------------|:-------------:|------:|
| Cristina      | Aceitável, mas 284 tem um ponto pouco pior que não está representado | X |
| Edésio        | 1546 melhor modelado      |   X - 602 e 1136 melhor modelados |
| Inácio        | 500 não tem 1 ponto bem positivo  |    X |
| Floriano      | 549 melhor modelado       |    X - 445 e 813 melhor modelados |
| Maciel        |   |    X - 248, 284 e 360 melhor modelados |
| Manoel        | 188 e 300 melhor modelados  |   X - 222, 370 e 392 melhor modelados |
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```
  
#Novas Ideias que não foram consideradas - Q-Scores

* Olhar a diferença entre os lados da rua por ponto? 
    * Acharia 2 problemas não encontrados
* Olhar a favor/contra carros e comparar os scores?
    * Acharia 1 problema não encontrado
    
#Descartar/Alterar? - Q-Scores

* Melhor e pior área por lado ao invés de melhor e pior área da rua?
