---
title: "RoyalSociety"
output: pdf_document
---

#Homens e Mulheres
```{r, echo=FALSE, fig.show='asis', fig.width=10, fig.height=5}
library(ggplot2)
library(gridExtra)

facet_names <- list(
  'agrad%C3%A1vel?'="Pleasant",
  'seguro?'="Safeness"
)

facet_labeller <- function(variable,value){
  return(facet_names[value])
}

dados <- read.table("geral2.dat", header=TRUE)

#Intervalo de confiança por ponto
temp <- dados
qscoreSim <- temp [ c(4:103) ]
icData <- apply(qscoreSim, 1, ic)
temp$distance <- icData

#Subset of columns
dadosSub <- temp[, c("V2", "V1", "V3", "diag", "hor", "vert", "red", "green", "blue", "grupo", "bairro", "distance")]

novosDados <- reshape(dadosSub, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Copia com todos os dados
dadosCopy <- temp[, c("V2", "V1", "V3", "diag", "hor", "vert", "red", "green", "blue", "grupo", "bairro")]

#Separando homens e mulheres
grupo1 <- dadosSub[(dadosSub$grupo == 'Masculino' & dadosSub$V1=='agradavel?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Feminino' & dadosSub$V1=='agradavel?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Masculino ~ V3.Feminino, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-hom-mul-agrad.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Masculino", "V3.Feminino", "residuals", "residualsPos")], file="reg-hom-mul-data-agrad.dat", sep = "\t")

#Separando homens e mulheres
grupo1 <- dadosSub[(dadosSub$grupo == 'Masculino' & dadosSub$V1=='seguro?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Feminino' & dadosSub$V1=='seguro?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Masculino ~ V3.Feminino, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-hom-mul-seg.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Masculino", "V3.Feminino", "residuals", "residualsPos")], file="reg-hom-mul-data-seg.dat", sep = "\t")
```


#Jovens e Adultos
```{r, echo=FALSE, fig.show='asis', fig.width=10, fig.height=5}
#Separando jovens e adultos
grupo1 <- dadosSub[(dadosSub$grupo == 'Jovem' & dadosSub$V1=='agradavel?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Adulto' & dadosSub$V1=='agradavel?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Jovem ~ V3.Adulto, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-jov-adu-agrad.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Jovem", "V3.Adulto", "residuals", "residualsPos")], file="reg-jov-adu-data-agrad.dat", sep = "\t")

#Separando jovens e adultos
grupo1 <- dadosSub[(dadosSub$grupo == 'Jovem' & dadosSub$V1=='seguro?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Adulto' & dadosSub$V1=='seguro?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Jovem ~ V3.Adulto, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-jov-adu-seg.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Jovem", "V3.Adulto", "residuals", "residualsPos")], file="reg-jov-adu-data-seg.dat", sep = "\t")
```

#Casados e Solteiros
```{r, echo=FALSE, fig.show='asis', fig.width=10, fig.height=5}
#Separando casados e solteiros
grupo1 <- dadosSub[(dadosSub$grupo == 'Casado' & dadosSub$V1=='agradavel?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Solteiro' & dadosSub$V1=='agradavel?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Casado ~ V3.Solteiro, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-cas-sol-agrad.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Casado", "V3.Solteiro", "residuals", "residualsPos")], file="reg-cas-sol-data-agrad.dat", sep = "\t")

#Separando casados e solteiros
grupo1 <- dadosSub[(dadosSub$grupo == 'Casado' & dadosSub$V1=='seguro?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Solteiro' & dadosSub$V1=='seguro?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Casado ~ V3.Solteiro, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-cas-sol-seg.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Casado", "V3.Solteiro", "residuals", "residualsPos")], file="reg-cas-sol-data-seg.dat", sep = "\t")
```

#Baixa renda e Media renda
```{r, echo=FALSE, fig.show='asis', fig.width=10, fig.height=5}
#Separando casados e solteiros
grupo1 <- dadosSub[(dadosSub$grupo == 'Baixa' & dadosSub$V1=='agradavel?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Media' & dadosSub$V1=='agradavel?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Baixa ~ V3.Media, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-bai-med-agrad.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Baixa", "V3.Media", "residuals", "residualsPos")], file="reg-bai-med-data-agrad.dat", sep = "\t")

#Separando casados e solteiros
grupo1 <- dadosSub[(dadosSub$grupo == 'Baixa' & dadosSub$V1=='seguro?' ),] 
grupo2 <- dadosSub[(dadosSub$grupo == 'Media' & dadosSub$V1=='seguro?'),] 
temp <- rbind(grupo1, grupo2)

novosgrupo1grupo2 <- reshape(temp, timevar="grupo", idvar=c("V2", "V1", "diag", "hor", "vert", "red", "green", "blue", "bairro"), direction="wide")

#Regressao
library(texreg)

regAgrad <- lm(V3.Baixa ~ V3.Media, data=novosgrupo1grupo2)

novosgrupo1grupo2$residuals <- regAgrad$residuals
novosgrupo1grupo2$residualsPos <- abs(regAgrad$residuals)

novosgrupo1grupo2 <- novosgrupo1grupo2[with(novosgrupo1grupo2, order(-residualsPos)), ]

#Modelo
sink("reg-bai-med-seg.txt")
texreg(regAgrad)
summary(regAgrad)
sink()

#Fotos, QScores e resíduos
write.table(novosgrupo1grupo2[, c("V2", "V3.Baixa", "V3.Media", "residuals", "residualsPos")], file="reg-bai-med-data-seg.dat", sep = "\t")
```

#Elementos urbanos
```{r, echo=FALSE, fig.show='asis', fig.width=10, fig.height=5}
library(dplyr)

substituiURL <- function(dadosPorGrupo){
    localData <- lapply(as.character(dadosPorGrupo$image_url), function (x) paste(strsplit(x, split="/", fixed=TRUE)[[1]][6], "/", strsplit(x, split="/", fixed=TRUE)[[1]][7], sep=""))
    local <- unlist(lapply(localData, '[[', 1))
    return(local)
}

#Lendo resultados do CrowdFlower
dadosg1 <- read.csv("regressao100/g1.csv")
dadosg1$image_url <- substituiURL(dadosg1)

dadosg2 <- read.csv("regressao100/g2.csv")
dadosg2$image_url <- substituiURL(dadosg2)

dadosg3 <- read.csv("regressao100/g3.csv")
dadosg3$image_url <- substituiURL(dadosg3)

dadosg4 <- read.csv("regressao100/g4.csv")
dadosg4$image_url <- substituiURL(dadosg4)

dadosg5 <- read.csv("regressao100/g5.csv")
dadosg5$image_url <- substituiURL(dadosg5)

dadosg6 <- read.csv("regressao100/g6.csv")
dadosg6$image_url <- substituiURL(dadosg6)

dadosg7 <- read.csv("regressao100/g7.csv")
dadosg7$image_url <- substituiURL(dadosg7)

dadosg8 <- read.csv("regressao100/g8.csv")
dadosg8$image_url <- substituiURL(dadosg8)

dadosg9 <- read.csv("regressao100/g9.csv")
dadosg9$image_url <- substituiURL(dadosg9)

dadosg10 <- read.csv("regressao100/g10.csv")
dadosg10$image_url <- substituiURL(dadosg10)

dadosg11 <- read.csv("regressao100/g11.csv")
dadosg11$image_url <- substituiURL(dadosg11)

dadosg12 <- read.csv("regressao100/g12.csv")
dadosg12$image_url <- substituiURL(dadosg12)

dadosg13 <- read.csv("regressao100/g13.csv")
dadosg13$image_url <- substituiURL(dadosg13)

#Agrupando por imagem e por questao - G1
by_image <- group_by(dadosg1, image_url)
groupedData1 <- summarise(by_image,
  count = n(),
  q1 = mean(question1, na.rm = TRUE),
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE),
  q3 = mean(question3, na.rm = TRUE))

#Agrupando por imagem e por questao - G2
by_image <- group_by(dadosg2, image_url)
groupedData2 <- summarise(by_image,
  count = n(),
  q1 = mean(question1, na.rm = TRUE),
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE),
  q3 = mean(question3, na.rm = TRUE))

#Agrupando por imagem e por questao - G3
by_image <- group_by(dadosg3, image_url)
groupedData3 <- summarise(by_image,
  count = n(),
  q1 = mean(question1, na.rm = TRUE),
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE),
  q3 = mean(question3, na.rm = TRUE))

#Agrupando por imagem e por questao - G4
by_image <- group_by(dadosg4, image_url)
groupedData4 <- summarise(by_image,
  count = n(),
  q1 = mean(question1, na.rm = TRUE),
  q2 = mean(question2 na.rm = TRUE))

#Agrupando por imagem e por questao - G5
by_image <- group_by(dadosg5, image_url)
groupedData5 <- summarise(by_image,
  count = n(),
  q1 = mean(question1, na.rm = TRUE),
  q2 = mean(question2, na.rm = TRUE))

#Agrupando por imagem e por questao - G6
by_image <- group_by(dadosg6, image_url)
groupedData6 <- summarise(by_image,
  count = n(),
  q1_left = mean(question1__left_side, na.rm = TRUE),
  q1_right = mean(question1__right_side, na.rm = TRUE),
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE))

#Agrupando por imagem e por questao - G7
by_image <- group_by(dadosg7, image_url)
groupedData7 <- summarise(by_image,
  count = n(),
  q1 = mean(question1, na.rm = TRUE),
  q2 = mean(question2, na.rm = TRUE),
  q3_left = mean(question3__left_side, na.rm = TRUE),
  q3_right = mean(question3__right_side, na.rm = TRUE))

#Agrupando por imagem e por questao - G8
by_image <- group_by(dadosg8, image_url)
groupedData8 <- summarise(by_image,
  count = n(),
  q1 = table(question1),
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE))

#Agrupando por imagem e por questao - G9
by_image <- group_by(dadosg9, image_url)
groupedData9 <- summarise(by_image,
  count = n(),
  q1_left = mean(question1__left_side, na.rm = TRUE),
  q1_right = mean(question1__right_side, na.rm = TRUE))

#Agrupando por imagem e por questao - G10
by_image <- group_by(dadosg10, image_url)
groupedData10 <- summarise(by_image,
  count = n(),
  q1 = table(question1),
  q2 = mean(question2, na.rm = TRUE),
  q3 = mean(question3, na.rm = TRUE))

#Agrupando por imagem e por questao - G11
by_image <- group_by(dadosg11, image_url)
groupedData11 <- summarise(by_image,
  count = n(),
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE),
  q3_left = mean(question3__left_side, na.rm = TRUE),
  q3_right = mean(question3__right_side, na.rm = TRUE))

#Agrupando por imagem e por questao - G12
by_image <- group_by(dadosg12, image_url)
groupedData12 <- summarise(by_image,
  count = n(),
  q1 = mean(question1, na.rm = TRUE),
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE),
  q3 = mean(question3, na.rm = TRUE))

#Agrupando por imagem e por questao - G13
by_image <- group_by(dadosg13, image_url)
groupedData13 <- summarise(by_image,
  count = n(),
  q1_left = mean(question1__left_side, na.rm = TRUE),
  q1_right = mean(question1__right_side, na.rm = TRUE)
  q2_left = mean(question2__left_side, na.rm = TRUE),
  q2_right = mean(question2__right_side, na.rm = TRUE))

#Regressao?
temp <- merge(groupedData1, novosDados, by.x="image_url", by.y="V2")


#Correlacao?


```
