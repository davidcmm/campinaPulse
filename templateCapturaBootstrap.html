<head>
<meta charset="UTF-8">
</head>

<div class="row">
    <!-- Success and Error Messages for the user --> 
    <div class="span6 offset2" style="height:50px">
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a>
            <strong>Ótimo!</strong> Sua resposta foi salva
        </div>
        <div id="loading" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            Carregando próxima tarefa...
        </div>
        <div id="taskcompleted" class="alert alert-info" style="display:none;">
            <strong>Tarefa completada!</strong> Obrigado!
        </div>
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong>Parabéns!</strong> Você completou todas as tarefas!
            <br/>
            <div class="alert-actions">
                <a class="btn small" href="/">Volte</a>
                <a class="btn small" href="/app">ou, Veja outras aplicações</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none;">
            <a class="close">×</a>
            <strong>Erro!</strong> Algo errado, entre em contato com os administradores
        </div>
    </div> <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<div class="row skeleton"> <!-- Start Skeleton Row-->
    <div class="span12 ">
        <div id="modal" class="modal hide fade">
            <!--<div class="modal-header">
                <h3>Você deseja avaliar as imagens em relação a qual pergunta?</h3>
            </div>-->
            <div id="0" class="modal-body" style="display:none">
                <p>Qual local lhe parece mais ...?</p>
		    <!--<select id="questoes" style="width: 300px; position: relative; left: 50%; margin-left: -150px;" >
					<option value="1"> Qual local lhe parece mais bonito?</option>
					<option value="2"> Qual local lhe parece mais seguro?</option>
					<option value="3"> Qual local lhe parece mais único?</option>
					<option value="4"> Qual local lhe parece mais rico?</option>
		     </select> -->
              <form>
              <div id="aspect">
               <table cellpadding="5px" cellspacing="10px">
                 <tr>
                   <td>
                     <input type="radio" name="aspe" id="beautiful" value="1"/>
                      <label for="beautiful"><img src="/icones/beleza.jpg" alt="bonito" title="bonito" style="width:170px"/></label>
                   </td>
                   
                   <td>
                     <input type="radio" name="aspe" id="secure" value="2"/>
                      <label for="secure"><img src="http://socientize.lsd.ufcg.edu.br/icones/seguranca.jpg" alt="seguro" title="seguro" style="width:170px"/></label>
                   </td>  
                 </tr>
                 <tr>
                   <td>
                     <input type="radio" name="aspe" id="unique" value="3"/>
                     <label for="unique"><img src="http://socientize.lsd.ufcg.edu.br/icones/unicidade/unique.jpeg" alt="único" title="único" style="width:200px"/></label>
                   </td>
                   
                   <td>
                     <input type="radio" name="aspe" id="rich" value="4"/>
		         		<label for="rich"><img src="http://socientize.lsd.ufcg.edu.br/icones/riqueza/tio-patinhas-690f8.jpg" alt="rico" title="rico" style="width:170px"/></label>
                   </td>  
                 </tr> 
              </table> 	  
            </div>
           </form>   
	</div>
        <div id="1" class="modal-body" style="display:none">
            <form accept-charset="UTF-8">  
			Idade: <input name="user1" id="userage" type="text" size="3" /><br><br>  
			Sexo: 
			<select name="user2" id="usersex">  
				<option>Masculino</option>  
				<option>Feminino</option>  				
			</select> <br><br> 
                        Classe Social: 
			<select name="user3" id="userclass">  
				<option>Alta</option>  
				<option>Média Alta</option>  
				<option>Média</option>  
				<option>Média Baixa</option>  
				<option>Baixa</option>  
			</select> <br><br> 
			Qual seu grau de formação? 
			<select name="user4" id="usereduc">  
				<option>Doutorado</option>  
				<option>Mestrado</option>  
				<option>Graduação</option>  
				<option>Ensino Médio</option>  
				<option>Ensino Fundamental</option>  
			</select> <br><br> 
			Sua Cidade: <input name="user5" id="usercity" type="text" size="15" /><br /><br />  			
                        Há quanto tempo mora no local? <input name="user6" id="usercitytime" type="text" size="2"/><br /><br />
		</form>       
        </div>
	<div class="modal-footer">
             <a id="startContrib" href="#" class="btn btn-primary" style="display:none"><i class="icon-thumbs-up"></i> Continuar!</a>
        </div>
   </div>  
 </div>
</div>

<div class="row skeleton">
  <div class="span12">
      <button id="changeQuest" class="btn btn-primary btn-medium" value='change' style="width: 20%; margin-left: 80%" ><i class="icon icon-white icon-question-sign"></i> Alterar pergunta</button>
  </div>
</div>

<div class="row skeleton">
  <div class="span12">
      <h3 id="question" style="width: 500px; position: relative; left: 50%; margin-left: -150px;">Question</h3>
  </div>
</div>

<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<div class="row skeleton" style="width:1024px"> <!-- Start Skeleton Row-->
  <div class="span6" style="width:47%"><!-- Start of Photo DIV (column) -->
      <a id="photo-link" href="#">
          <img id="photo" src="http://img339.imageshack.us/img339/9017/loadingo.png" style="max-width=100%">
      </a>
      </div><!-- End of Photo DIV (columnt) -->
  <div class="span6" style="width:47%"><!-- Start of Photo DIV (column) -->
      <a id="photo-link2" href="#">
          <img id="photo2" src="http://img339.imageshack.us/img339/9017/loadingo.png" style="max-width=100%">
      </a>
   </div><!-- End of Photo DIV (columnt) -->
</div><!-- End of Skeleton Row -->

<div class="row skeleton"> <!-- Start Skeleton Row-->
   <br>
   <br>  
   <div class="span12 "><!-- Start of Question and Submission DIV (column) -->
      <div id="answer"> <!-- Start DIV for the submission buttons -->
            <!-- If the user clicks this button, the saved answer will be value="yes"-->
            <!-- <button class="btn btn-answer" value='Left'><i class="icon icon-white"></i>Local da esquerda</button> -->
            <!-- If the user clicks this button, the saved answer will be value="no"-->
            <!-- <button class="btn btn-answer" value='Right'><i class="icon icon-white"></i>Local da direita</button> -->
            <!-- If the user clicks this button, the saved answer will be value="NotKnown"-->
      <button id="notknown" class="btn btn-info btn-large" value='NotKnown' style="width: 15%; margin-left: 42%; margin-right: 43%" ><i class="icon icon-white"></i> Tanto faz!</button>
      
     </div><!-- End of DIV for the submission buttons -->
    </div><!-- End of Skeleton Row -->
</div>

<div class="row skeleton"> <!-- Start Skeleton Row-->
    <div class="span6 "><!-- Start of Question and Submission DIV (column) -->
      <br>
        
        <!-- Feedback items for the user -->
        <p>Você está na tarefa: <span id="task-id" class="label label-warning">#</span></p>
        <p>Você já completou: <span id="done" class="label label-info"></span> tarefas de
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%;"></div>
        </div>
        <!-- 
            This application uses Disqus to allow users to provide some feedback.
            The next section includes a button that when a user clicks on it will
            load the comments, if any, for the given task
        -->
        <!-- <div id="disqus_show_btn" style="margin-top:5px;"> -->
            <!-- <button class="btn btn-primary btn-large btn-disqus" onclick="loadDisqus()"><i class="icon-comments"></i> Show comments</button> -->
            <!-- <button class="btn btn-large btn-disqus" onclick="loadDisqus()" style="display:none"><i class="icon-comments"></i> Hide comments</button> -->
        <!-- </div> --><!-- End of Disqus Button section -->
        <!-- Disqus thread for the given task -->
        <!-- <div id="disqus_thread" style="margin-top:5px;display:none"></div> -->
    </div><!-- End of Question and Submission DIV (column) -->
    </div><!-- End of Skeleton Row -->

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    /* * * DON'T EDIT BELOW THIS LINE * * */
    function loadDisqus() {
    $("#disqus_thread").toggle();
    $(".btn-disqus").toggle();
    var disqus_shortname = 'pybossa'; // required: replace example with your forum shortname
    //var disqus_identifier = taskId;
    var disqus_developer = 1;

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    }

</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script charset="UTF-8">
endpoint = "/pybossa";
pybossa.setEndpoint(endpoint);  

var perguntaAResponder = "";
var step = 0;
var respostasIniciais = 0;
var respostasDadas = 0;

  
function showForm(currentInfo){
  var show = false;
  //alert("CI"+currentInfo);  
  if (null == currentInfo || undefined == currentInfo || !currentInfo || currentInfo.length == 0) {	
	    show = true;
    //alert("Vazio");
	    $('#startContrib').off('click').on('click', function(evt) {
          //Save captured user data!
          var age = document.getElementById('userage').value;
          var userClass = document.getElementById('userclass').value;
          var userEduc = document.getElementById('usereduc').value;
          var userCity = document.getElementById('usercity').value;
          var userCityTime = document.getElementById('usercitytime').value;          
          var userSex = document.getElementById('usersex').value;
          //var newInfo = "{age="+age+",sex="+userSex+",class="+userClass+",educ="+userEduc+",city="+userCity+",time="+userCityTime+"}";
          //alert("NewINFO01"+newInfo);
          $.ajaxSetup({ scriptCharset: "utf-8" , contentType: "application/json; charset=utf-8"});
          $.get('http://socientize.lsd.ufcg.edu.br/pybossa/account/saveUserInfo', {
              age: age+"",
                class: userClass+"",
            educ: userEduc+"",
            city: userCity+"",
            time: userCityTime+"",
            sex: userSex+""
              });
          
		$("#startContrib").hide();
		$("#0").hide();
		$("#1").hide();
		$("#modal").modal('hide');
		
	   });
   } else {
		currentInfo = currentInfo.substring(1, currentInfo.length-1);
     //alert("Cheio");
        var userData = currentInfo.split(",");
		var userAge = userData[0].split("=")[1];
		var userClass = userData[1].split("=")[1];
		var userDegree = userData[2].split("=")[1];
		var userCity = userData[3].split("=")[1];
        var userCityTime = userData[4].split("=")[1];
        var userSex = userData[5].split("=")[1];
        
     //alert("Getting Info"+userAge);
        
		if (!(userAge.length > 0 && userClass.length > 0 && userDegree.length > 0 && userCity.length > 0 && userCityTime.length > 0 && userSex.length > 0)){
			
		    	show = true;
		    	//Setting values already given in the form!
			$("#userage").val(userAge);
			$("#usercity").val(userCity);
            $("#usercitytime").val(userCityTime);
			
		    if(userClass.length > 0){
              var classField  = document.getElementById('userclass');
              if(classField){
                  for(var i=0; i < classField.options.length; i++) { 
                      if(classField.options[i].value == userClass) { 
                          classField.options[i].selected = true;
                          break;
                      }
                  }
              }
           }
          
          if(userSex.length > 0){
              var classField  = document.getElementById('usersex');
              if(classField){
                  for(var i=0; i < classField.options.length; i++) { 
                      if(classField.options[i].value == userSex) { 
                          classField.options[i].selected = true;
                          break;
                      }
                  }
              }
           }
			
	  	   if(userDegree.length > 0){
              var degreeField  = document.getElementById('usereduc');
              if(degreeField){
                  for(var i=0; i < degreeField.options.length; i++) { 
                  if(degreeField.options[i].value == userDegree) { 
                      degreeField.options[i].selected = true;
                      break;
                  }
                  }
              }
	       }
             
		//Asking for other values!
		$('#startContrib').off('click').on('click', function(evt) {
			//Save captured user data!
			var age = document.getElementById('userage').value;
          var userClass = document.getElementById('userclass').value;
          var userEduc = document.getElementById('usereduc').value;
          var userCity = document.getElementById('usercity').value;
          var userCityTime = document.getElementById('usercitytime').value;          
          var userSex = document.getElementById('usersex').value;
          // var newInfo = "{age="+age+",sex="+userSex+",class="+userClass+",educ="+userEduc+",city="+userCity+",time="+userCityTime+"}";
          //alert("NewINFO02"+newInfo);
          $.ajaxSetup({ scriptCharset: "utf-8" , contentType: "application/json; charset=utf-8"});
          $.get('http://socientize.lsd.ufcg.edu.br/pybossa/account/saveUserInfo', {
				age: age+"",
                class: userClass+"",
            educ: userEduc+"",
            city: userCity+"",
            time: userCityTime+"",
            sex: userSex+""
      			});
          
		      $("#startContrib").hide();
		      $("#0").hide();
		      $("#1").hide();
		      $("#modal").modal('hide');
              });
                   	
	   }
  }
  
  if(show){
    //alert("Estou habilitando");
        $("#startContrib").show();
        $("#1").show();
    	return show;
  }
}  
  
function showStep(action) {
   var show = false;
   if (action == 'init' && perguntaAResponder.length == 0){
       show = true;
       $("#startContrib").show();
       $("#0").show();
       $("#1").hide();
       
       //Start contributing clicked!
       $('#startContrib').off('click').on('click', function(evt) {
	  if (document.getElementById('beautiful').checked){
	    perguntaAResponder = "Qual local lhe parece mais bonito?";            			
	  }else if (document.getElementById('secure').checked){
	    //perguntaAResponder = "Qual local lhe parece mais seguro?";
		$.get('http://socientize.lsd.ufcg.edu.br/pybossa/account/saveUserRedirect', {
			redir: "True"
      		});                
	    window.location = "http://socientize.lsd.ufcg.edu.br/pybossa/app/comoecampinasegura/newtask";
	  }else if (document.getElementById('unique').checked){
	    //perguntaAResponder = "Qual local lhe parece mais único?";
		$.get('http://socientize.lsd.ufcg.edu.br/pybossa/account/saveUserRedirect', {
			redir: "True"
      		});
	    window.location = "http://socientize.lsd.ufcg.edu.br/pybossa/app/comoecampinaunica/newtask";
	  }else {
	    //perguntaAResponder = "Qual local lhe parece mais rico?";
		$.get('http://socientize.lsd.ufcg.edu.br/pybossa/account/saveUserRedirect', {
			redir: "True"
      		});
	    window.location = "http://socientize.lsd.ufcg.edu.br/pybossa/app/comoecampinarica/newtask";
	  }
	  $("#startContrib").hide();
	  $("#0").hide();
	  $("#1").hide();
	  $("#modal").modal('hide');
	  step = 1;
	  $("#question").html(perguntaAResponder);
      });
      return show;
   }else if(action == 'next') {
      $.ajax({
	  url: "http://socientize.lsd.ufcg.edu.br/pybossa/account/currentUserInfo",
	  async: false,
	  dataType: 'json',
	  success: function(data) {
	     show = showForm(data.info);
        //alert("Show form"+show);         
	  }    
     });
     return show;
  }
}

$.ajax({
          url: "http://socientize.lsd.ufcg.edu.br/pybossa/account/currentUserRedirect",
          async: false,
          dataType: 'json',
          success: function(data) {
             show = data.redir;
            //alert("VAL" + show + "" + (show == "true"));
             if (!show){
                if(showStep('init')){
                  $("#modal").modal('show');
                }       
             }else{
                perguntaAResponder = "Qual local lhe parece mais bonito?"; 
               	$("#question").html(perguntaAResponder);
                $.get('http://socientize.lsd.ufcg.edu.br/pybossa/account/saveUserRedirect', {
					redir: "False"
      			});
             }  
          }    
 });
  
function loadUserProgress() {
    pybossa.userProgress('comoecampina').done(function(data){
        var pct = Math.round((data.done*100)/data.total);
        $("#progress").css("width", pct.toString() +"%");
        $("#progress").attr("title", pct.toString() + "% completed!");
        $("#progress").tooltip({ 'placement' : 'left' });
        
        $("#total").text(data.total);
        $("#done").text(data.done);
      	if (respostasIniciais == 0) {
          	respostasIniciais = data.done;
        }else{
          	respostasDadas = data.done;
        }	
    });

}

pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        // load image from flickr
        var left = $('<img />');
        left.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        left.attr('src', task.info.url_c);
      	left.attr('id', "photo");
        left.addClass('img-polaroid');
        task.info.left = left;

        var right = $('<img />');
        right.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        right.attr('src', task.info.url_a);
      	right.attr('id', "photo2");
        right.addClass('img-polaroid');
        task.info.right = right;
    }
    else {
        deferred.resolve(task);
    }
});

pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        loadUserProgress();
	//At each 10 questions answered check user profile information
	if (respostasDadas != 0 && (respostasDadas-respostasIniciais) % 9 == 0){
      step = 1;
         
      if(showStep('next')){
        //alert("Estou habilitando 2");
             $("#modal").modal('show');
      }
	}
      
          
        $('#photo-link').html('').append(task.info.left);
        $("#photo-link").attr("href", task.info.link);
 	$('#photo-link2').html('').append(task.info.right);
        $("#photo-link2").attr("href", task.info.link);
        $('#task-id').html(task.id);
        
        //Left image chosen
        $('#photo').off('click').on('click', function(evt) {
          var question = perguntaAResponder;
	      var answerToSave = String(question) + " " + "Left" + " " + String(task.info.url_c) + " " + String(task.info.url_a);
          pybossa.saveTask(task.id, answerToSave).done(function() {
              	      deferred.resolve();
          });
          $("#loading").fadeIn(500);
          if ($("#disqus_thread").is(":visible")) {
            $('#disqus_thread').toggle();
            $('.btn-disqus').toggle();
          }
        });
      
        //Right image chosen
        $('#photo2').off('click').on('click', function(evt) {
          var question = $('#questoes').attr("value");
	      var answerToSave = String(question) + " " + "Right" + " " + String(task.info.url_c) + " " + String(task.info.url_a);
          pybossa.saveTask(task.id, answerToSave).done(function() {
              	      deferred.resolve();
          });
          $("#loading").fadeIn(500);
          if ($("#disqus_thread").is(":visible")) {
            $('#disqus_thread').toggle();
            $('.btn-disqus').toggle();
          }
        });
      
             
       //Change question button clicked
       $('#changeQuest').off('click').on('click', function(evt) {
               perguntaAResponder = "";
	       step = 0;
		if(showStep('init')){
		   $("#modal").modal('show');
		}
        });
      
       $('#notknown').off('click').on('click', function(evt) {
            var answer = $(evt.target).attr("value");
	        var question = $('#question').attr("value");
	        var answerToSave = String(question) + " " + String(answer) + " " + String(task.info.url_c) + " " + String(task.info.url_a);
            if (typeof answer != 'undefined') {
                //console.log(answer);
                //pybossa.saveTask(task.id, answer).done(function() {
                //    deferred.resolve();
                //});
		pybossa.saveTask(task.id, answerToSave).done(function() {
              	      deferred.resolve();
                });
                $("#loading").fadeIn(500);
                if ($("#disqus_thread").is(":visible")) {
                    $('#disqus_thread').toggle();
                    $('.btn-disqus').toggle();
                }
            }
            else {
                $("#error").show();
            }
        });
        $("#loading").hide();
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
  
});

pybossa.run('comoecampina');
</script>


