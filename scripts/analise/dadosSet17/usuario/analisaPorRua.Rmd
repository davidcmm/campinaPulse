---
title: "analisaPorRua"
output:
  html_document:
    self_contained: no
  pdf_document: default
---

```{r setup, include=FALSE}
library("vioplot")
library("ggplot2")
library("dplyr")
library("knitr")
library("texreg")
library("ineq")

multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}

```

Os estudos de percepção realizados até o momento têm focado em capturar diversas imagens espalhadas pela cidade, obter as QScores/preferências das pessoas e treinar modelos de mais baixo nível ou alto nível (vide nosso artigo do HT ou o artigo com índice de ceu, verde, etc.) para predizer preferências para novas fotos que ainda não foram avaliadas por pessoas. Com isso surgem alguns pontos a serem considerados:

1. Os modelos treinados com estes conjuntos de dados tendem a capturar as tendências médias, o típico presente nos dados. E se pensarmos em analisar outro contexto social, ruas de outros locais ou, ainda, traçar um panorama detalhado de alguma rua?
+ O contexto social podemos pensar em lidar capturando preferências dos diferentes segmentos sociais
+ As ruas de outras cidades podemos pensar em capturar imagens de outras cidades, cujo contexto seja mais parecido com o contexto da cidade que queremos avaliar
+ E o panorama detalhado da rua? Precisamos ter ideias mais precisas de como são as várias ruas daquela cidade, suas particularidades, para que os modelos treinados com esses dados possam reproduzir mais fielmente as preferências das pessoas sobre aqueles locais. Com essa ideia estamos buscando avaliar as particularidades, ou o que podemos ganhar/perder, pensando em captura de percepções em um nível mais micro em relação à captura de percepção em um nível mais macro.

Para isso, foram escolhidas 4 ruas de Campina Grande, 20 fotos por rua (5 pontos da rua x 4 ângulos), para avaliação quanto à questão agradável. 2 dessas ruas apresentaram os pontos de maior divergência de percepção em nossa análise anterior (Edésio Silva e Inácio Marques), uma rua apresentou o ponto de maior homogeneidade (Manoel Pereira), porém com notas baixas, e a outra rua é uma rua importante do centro da cidade (Maciel Pinheiro), que tem uma tendência de homogeneidade, com notas boas. 

Alguns questionamentos foram inicialmente levantados:

1. Na média as ruas são parecidas ou não? Tem alguma rua que parece muito boa ou muito ruim?
2. Será que ruas que são parecidas na média, são de fato similares?
3. Olhando a dispersão da rua como um todo, posso tentar dizer algo sobre a rua?
4. Olhando as variações dos QScores por número/ponto na rua, consigo perceber variações que podem indicar problemas?
5. Confrontando as variações no QScores com as fotos, podemos apontar problemas/virtudes das ruas?

# Tamanho das amostras e comparação entre rankings

Abaixo temos, primeiramente, uma análise, para determinar o tamanho da amostra para 95% de confiança. Em seguida, temos a comparação do ranking geral com 29 usuários (primeira amostra analisada), com a amostra com 69 pessoas e todas como moradores de Campina e com a amostra atual contendo 164 pessoas (69 pessoas que não são de Campina e 60 que são daqui).

```{r}
#Checking sample size
current_data <- read.table("all100/all_ordenado.dat")
current_data$sd <- apply(current_data[,4:ncol(current_data)], 1, sd)
current_data$n <- ( 1.96 * current_data$sd / 0.2) ** 2  #All QScores
print(">>>> Maior e menor amostra necessária ")
print(max(current_data$n))
print(min(current_data$n))

#Checking rankings similarity
mergeSort <- function(x){
  if(length(x) == 1){
    inv <- 0
  } else {
    n <- length(x)
    n1 <- ceiling(n/2)
    n2 <- n-n1
    y1 <- mergeSort(x[1:n1])
    y2 <- mergeSort(x[n1+1:n2])
    inv <- y1$inversions + y2$inversions
    x1 <- y1$sortedVector
    x2 <- y2$sortedVector
    i1 <- 1
    i2 <- 1
    while(i1+i2 <= n1+n2+1){
      if(i2 > n2 || (i1 <= n1 && x1[i1] <= x2[i2])){
        x[i1+i2-1] <- x1[i1]
        i1 <- i1 + 1
      } else {
        inv <- inv + n1 + 1 - i1
        x[i1+i2-1] <- x2[i2]
        i2 <- i2 + 1
      }
    }
  }
  return (list(inversions=inv,sortedVector=x))
}
numberOfInversions <- function(x){
  r <- mergeSort(x)
  return (r$inversions)
}
normalizedKendallTauDistance2 <- function(data1, data2){
  x <- data1
  y <- data2
  
  tau = numberOfInversions(order(x)[rank(y)])
  print(tau)
  nItens = length(x)
  maxNumberOfInverstions <- (nItens*(nItens-1))/2
  normalized = tau/maxNumberOfInverstions

  print (normalized)
}
data29 <- read.table("29users/all_ordenado.dat")

d29_cur <- merge(select(data29, V2, V3), select(current_data, V2, V3), by = "V2")
print(cor.test(d29_cur$V3.x, d29_cur$V3.y, method = "kendall"))
print(cor.test(d29_cur$V3.x, d29_cur$V3.y, method = "spearman"))

print(paste(">>>> Kendall Distance ", normalizedKendallTauDistance2(d29_cur$V3.x, d29_cur$V3.y)))

data69 <- read.table("69users/all_ordenado.dat")

d69_cur <- merge(select(data69, V2, V3), select(current_data, V2, V3), by = "V2")
print(cor.test(d69_cur$V3.x, d69_cur$V3.y, method = "kendall"))
print(cor.test(d69_cur$V3.x, d69_cur$V3.y, method = "spearman"))

print(paste(">>>> Kendall Distance ", normalizedKendallTauDistance2(d69_cur$V3.x, d69_cur$V3.y)))
```

# Comparação entre rankings de moradores e não moradores

Feita a seleção de quem é morador e não morador de Campina temos, atualmente, 60 moradores e 59 não moradores.

```{r}
datacampina <- read.table("all100/all_campina_ordenado.dat")
datanotcampina <- read.table("all100/all_notcampina_ordenado.dat")

camp_notcampina <- merge(select(datacampina, V2, V3), select(datanotcampina, V2, V3), by = "V2")
print(cor.test(camp_notcampina$V3.x, camp_notcampina$V3.y, method = "kendall"))
print(cor.test(camp_notcampina$V3.x, camp_notcampina$V3.y, method = "spearman"))

print(paste(">>>> Kendall Distance ", normalizedKendallTauDistance2(camp_notcampina$V3.x, camp_notcampina$V3.y)))
```


# Impressão Geral das Ruas

## Ranking Geral

Computados os QScores as cinco melhores e cinco piores imagens avaliadas estão apresentadas abaixo juntamente com as interseções das marcações dos usuários do porquê as escolheram como melhor ou pior imagem dentre as 4 apresentadas nas tarefas.

```{r results='asis', echo=FALSE, out.extra='', fig.height=10, fig.width=12}
show_general_ranking <- function (data){
    top <- head(data, n=10)
    bottom <- tail(data, n=10)
    
    cat("<h3>Top</h3>")
    cat("<div class='row'>")
    for(i in 1:nrow(top)) {
      row <- top[i,]
      photo_name <- as.character(row$photo_name)
      score <- row$V3
      
      cat("<div class='col-xs-4'>")
      cat("<img src='", "../percepcaoLocal/agradavel/melhores/intersects/",photo_name,"' width='400px'>", sep = "")
      cat("<div class='caption'>", photo_name, " " , score,  "</div>", sep="")
      cat("</div>")
      if (i > 1 && i %% 3 == 0){
        cat("</div>")
        cat("<div class='row'>")
      }
    }
    cat("</div>")
    
    cat("<h3>Bottom</h3>")
    cat("<div class='row'>")
    for(i in 1:nrow(bottom)) {
      row <- bottom[i,]
      photo_name <- as.character(row$photo_name)
      score <- row$V3
      
      cat("<div class='col-xs-4'>")
      cat("<img src='", "../percepcaoLocal/agradavel/piores/intersects/",photo_name,"' width='400px'>", sep = "")
      cat("<div class='caption'>", photo_name, " " , score,  "</div>", sep="")
      cat("</div>")
      if (i > 1 && i %% 3 == 0){
        cat("</div>")
        cat("<div class='row'>")
      }
    }
    cat("</div>")
}

novoV2 <- lapply(as.character(current_data$V2), function (x) strsplit(x, split="/", fixed=TRUE)[[1]][7])
novoV2 <- unlist(lapply(novoV2, '[[', 1))
novoV2 <- strsplit(novoV2, split="\\.jpg")
photo <- unlist(lapply(novoV2, '[[', 1))
current_data$photo_name <- photo
show_general_ranking(current_data)

#Calculating CI for each photo
current_data$ci <- current_data$sd * 1.96 / 100
current_data <- arrange(current_data, photo_name)

qscoresDFGeral <- read.csv("qscores-df-geral.csv", header = TRUE)
qscoresDFCampina<- read.csv("qscores-df-campina.csv", header = TRUE)
qscoresDFNotCampina <- read.csv("qscores-df-notcampina.csv", header = TRUE)

#Plotting Q-Scores through the street
all_data <- merge(qscoresDFGeral, current_data, by.x = "url", by.y="V2")
all_data$street <- as.character(all_data$street)
all_data$street <- factor(all_data$street, levels=unique(all_data$street))

plot_ci_per_photo <- function(data, plotTitle, ids1, ids2){
  pd <- position_dodge(0.1)
  data$xlabel <- factor(data$xlabel, levels = data$xlabel)
  data$side <- ""
  data$side[data$angle %in% ids1] <- "Side 1"
  data$side[data$angle %in% ids2] <- "Side 2"
  if(plotTitle == "Cristina Procopio"){
    data$side[data$num == 436 & (data$angle == 22 | data$angle == 135)] <- "Side 1"
    data$side[data$num == 436 & (data$angle == 203 | data$angle == 315)] <- "Side 2"
  }
  
  if(plotTitle == "Edésio Silva" || plotTitle == "Manoel Pereira"){
    data1 <- arrange(filter(data, side == "Side 1"), num, -angle)
    data2 <- arrange(filter(data, side == "Side 2"), num, angle)
  }else if (plotTitle == "Inacio"  || plotTitle == "Maciel Pinheiro" || plotTitle == "Cristina Procopio" || plotTitle == "Floriano Peixoto"){
    data1 <- arrange(filter(data, side == "Side 1"), num, angle)
    data2 <- arrange(filter(data, side == "Side 2"), num, angle)
  }
  
  
  data1 <- data1 %>% mutate(xlabel = factor(xlabel, levels = rev(xlabel)))
  g1 <- ggplot(data1, aes(x=reorder(xlabel, num), y=V3, group=side, shape = factor(num))) + geom_errorbar(aes(ymin=V3-ci, ymax=V3+ci), colour="black", width=.1, position=pd) + geom_line(position=pd, colour="#D55E00") + geom_point(position=pd, size=4, colour="#D55E00") + ylim(c(2, 7)) + labs(x = "Street points", title = plotTitle, y = "Q-Score") + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(vjust=10)) #+ facet_wrap(~side, ncol=1, nrow=2, scales='free') #scale_colour_gradientn(colours=rainbow(4)) + scale_colour_hue()

  data2 <- data2 %>% mutate(xlabel = factor(xlabel, levels = rev(xlabel)))
  g2 <- ggplot(data2, aes(x=reorder(xlabel, num), y=V3, group=side, shape = factor(num))) + geom_errorbar(aes(ymin=V3-ci, ymax=V3+ci), colour="black", width=.1, position=pd) + geom_line(position=pd, colour="#56B4E9") + geom_point(position=pd, size=4, colour="#56B4E9") + ylim(c(2, 7)) + labs(x = "Street points", title = plotTitle, y = "Q-Score") + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(vjust=10))#+ scale_colour_hue()
  
  multiplot(g1, g2, cols=1)
}

all_data$xlabel <- paste("Num.:", all_data$num, " Angle: ", all_data$angle) 

plot_ci_per_photo(filter(all_data, street == "R._Edésio_Silva"), "Edésio Silva", c(22, 135), c(315, 203))#Street 1
plot_ci_per_photo(filter(all_data, street == "R._Inácio_Marquês_da_Silva"), "Inacio", c(203, 112, 90), c(293, 270, 22))#Street 2
plot_ci_per_photo(filter(all_data, street == "R._Maciel_Pinheiro"), "Maciel Pinheiro", c(360, 90), c(270, 180))#Street 3
plot_ci_per_photo(filter(all_data, street == "R._Manoel_Pereira_de_Araújo"), "Manoel Pereira", c(22, 135, 293), c(315, 112, 203, 225))#Street 4
plot_ci_per_photo(filter(all_data, street == "Av._Mal._Floriano_Peixoto"), "Floriano Peixoto", c(22,293), c(112,203))#Street 5
plot_ci_per_photo(filter(all_data, street == "R._Cristina_Procópio_Silva"), "Cristina Procopio", c(22, 45, 293, 315), c(135, 225))#Street 6 -> At number 436, 22 x 315 and 135 x 203
```

Qualitativamente analisando estas imagens, conforme esperado, percebe-se que vegetação, melhor estado de manutenção e a rua mais larga conduziram a melhores avaliações das imagens. O céu também foi um fator apontado em 2 das 5 fotos e que não foi computado em nossas avaliações anteriores.  É importante destacar que a Inácio Marques teve 4 dos 5 melhores, e o outro local foi na Edésio Silva, sendo ambas as ruas tipicamente residenciais.

Para as imagens com pior avaliação, a presença de itens na rua (barracas mal cuidadas, itens velhos, itens de venda, etc.) juntamente com prédios mal cuidados geraram maior desconforto. É importante destacar que os 5 locais com pior avaliação se localizam na Manoel Araújo, uma rua de comércio antiga e pouco cuidada no centro da cidade.

Realizando a análise da regressão dos QScores frente: # de árvores, nota de landscape, largura de rua, largura de calçada e número de prédios com identificadores

```{r}
input_regressao <- read.csv("input_regressao/regressao-input.csv")
plotRegAndLinear <- function(reg, test){
  #http://blog.minitab.com/blog/adventures-in-statistics-2/why-you-need-to-check-your-residual-plots-for-regression-analysis
  plot(reg)
  
  plot(test$street_wid, reg$resid)
  plot(test$sidewalk_wid, reg$resid)
  plot(test$landscape, reg$resid)
  plot(test$trees, reg$resid)
  plot(test$build_ident, reg$resid)
}

reg_input <- merge(current_data, input_regressao, by.x="V2", by.y="image") %>% do(arrange(., V3)) %>% mutate(rank = 1:n())
reg <- lm(rank ~ street_wid + sidewalk_wid + landscape + trees + build_ident, na.action = na.exclude, data = select(reg_input, rank, street_wid, sidewalk_wid, landscape, trees, build_ident))#rank ~ .*.

texreg(list(reg), stars = c(0.1, 0.05, 0.01, 0.001), digits=3)
#Analysing regression!
plotRegAndLinear(reg, reg_input)

#Standardized regression
reg <- lm(rank ~ scale(street_wid) + scale(sidewalk_wid) + scale(landscape) + scale(trees) + scale(build_ident), na.action = na.exclude, data = select(reg_input, rank, street_wid, sidewalk_wid, landscape, trees, build_ident))#rank ~ .*.

texreg(list(reg), stars = c(0.1, 0.05, 0.01, 0.001), digits=3)
```

Realizando a mesma regressão acima para moradores e não moradores de forma separada

```{r}
#CAmpina residents
reg_input <- merge(datacampina, input_regressao, by.x="V2", by.y="image") %>% do(arrange(., V3)) %>% mutate(rank = 1:n())
reg <- lm(rank ~ street_wid + sidewalk_wid + landscape + trees + build_ident, na.action = na.exclude, data = select(reg_input, rank, street_wid, sidewalk_wid, landscape, trees, build_ident))#rank ~ .*.

texreg(list(reg), stars = c(0.1, 0.05, 0.01, 0.001), digits=3)

#Standardized regression
reg <- lm(rank ~ scale(street_wid) + scale(sidewalk_wid) + scale(landscape) + scale(trees) + scale(build_ident), na.action = na.exclude, data = select(reg_input, rank, street_wid, sidewalk_wid, landscape, trees, build_ident))#rank ~ .*.

texreg(list(reg), stars = c(0.1, 0.05, 0.01, 0.001), digits=3)

#Campina non-residents
reg_input <- merge(datanotcampina, input_regressao, by.x="V2", by.y="image") %>% do(arrange(., V3)) %>% mutate(rank = 1:n())
reg <- lm(rank ~ street_wid + sidewalk_wid + landscape + trees + build_ident, na.action = na.exclude, data = select(reg_input, rank, street_wid, sidewalk_wid, landscape, trees, build_ident))#rank ~ .*.

texreg(list(reg), stars = c(0.1, 0.05, 0.01, 0.001), digits=3)

#Standardized regression
reg <- lm(rank ~ scale(street_wid) + scale(sidewalk_wid) + scale(landscape) + scale(trees) + scale(build_ident), na.action = na.exclude, data = select(reg_input, rank, street_wid, sidewalk_wid, landscape, trees, build_ident))#rank ~ .*.

texreg(list(reg), stars = c(0.1, 0.05, 0.01, 0.001), digits=3)
```

## Análise das Ruas


1. Na média as ruas são parecidas ou não? Tem alguma rua que parece muito boa ou muito ruim?

```{r}
#Getting data for each street to plot means and ICs for each street
plot_street_means <- function(data){
  edesio_scores = filter(data, street == "R._Edésio_Silva")$qscore
  edesio_sd = sd(edesio_scores)
  inacio_scores = filter(data, street == "R._Inácio_Marquês_da_Silva")$qscore
  inacio_sd = sd(inacio_scores)
  manoel_scores = filter(data, street == "R._Manoel_Pereira_de_Araújo")$qscore
  manoel_sd = sd(manoel_scores)
  maciel_scores = filter(data, street == "R._Maciel_Pinheiro")$qscore
  maciel_sd = sd(maciel_scores)
  floriano_scores = filter(data, street == "Av._Mal._Floriano_Peixoto")$qscore
  floriano_sd = sd(maciel_scores)
  cristina_scores = filter(data, street == "R._Cristina_Procópio_Silva")$qscore
  cristina_sd = sd(maciel_scores)
  
  new_frame = data.frame(mean_scores = c(mean(maciel_scores), mean(manoel_scores), mean(edesio_scores), mean(inacio_scores), mean(floriano_scores), mean(cristina_scores)), street = c("Maciel", "Manoel", "Edesio", "Inacio", "Floriano", "Cristina"), ci = c(maciel_sd * 1.96 / length(maciel_scores),  manoel_sd * 1.96 / length(manoel_scores), edesio_sd * 1.96 / length(edesio_scores), inacio_sd * 1.96 / length(inacio_scores), floriano_sd * 1.96 / length(floriano_scores), cristina_sd * 1.96 / length(cristina_scores)))
  
  ggplot(new_frame, aes(x=street, y=mean_scores, fill=street)) + 
      geom_bar(position=position_dodge(), stat="identity") +
      geom_errorbar(aes(ymin=mean_scores-ci, ymax=mean_scores+ci),
                    width=.2,                    # Width of the error bars
                    position=position_dodge(.9))
}


plot_street_means(qscoresDFGeral)
plot_street_means(qscoresDFCampina)
plot_street_means(qscoresDFNotCampina)
```

- Os ICs com 95% de confiança das 20 fotos foi razoavelmente curto, permitindo uma comparação das médias;
- A Manoel P. de Araújo realmente está bem abaixo das demais ruas;
- As outras três ruas possuem intervalos próximos, que podem ser confundíveis, apesar da Inácio Marques e a Maciel Pinheiro parecerem ter uma tendência de melhores scores que a Edesio;

2. Será que ruas que são parecidas na média, são de fato similares?
3. Olhando a dispersão da rua como um todo, posso tentar dizer algo sobre a rua?

Três das ruas selecionadas parecem bem similares de acordo com a média, mas será que são similares assim? Para isso computamos os violin plots de cada rua.

```{r }
value <- qscoresDFGeral$qscore

with(qscoresDFGeral , vioplot( value[street=="R._Inácio_Marquês_da_Silva"] , value[street=="R._Edésio_Silva"], value[street=="R._Manoel_Pereira_de_Araújo"], value[street=="R._Maciel_Pinheiro"], value[street=="Av._Mal._Floriano_Peixoto"], value[street=="R._Cristina_Procópio_Silva"], col=rgb(0.1,0.4,0.7,0.7), names=c("Inacio","Edesio","Manoel", "Maciel", "Floriano", "Cristina"), ylim = c(3, 7) ))

value <- qscoresDFCampina$qscore

with(qscoresDFCampina , vioplot( value[street=="R._Inácio_Marquês_da_Silva"] , value[street=="R._Edésio_Silva"], value[street=="R._Manoel_Pereira_de_Araújo"], value[street=="R._Maciel_Pinheiro"],col=rgb(0.1,0.4,0.7,0.7) , names=c("Inacio","Edesio","Manoel", "Maciel"), ylim = c(3, 7) ))#,  value[street=="Av._Mal._Floriano_Peixoto"], value[street=="R._Cristina_Procópio_Silva"]

value <- qscoresDFNotCampina$qscore

with(qscoresDFNotCampina , vioplot( value[street=="R._Inácio_Marquês_da_Silva"] , value[street=="R._Edésio_Silva"], value[street=="R._Manoel_Pereira_de_Araújo"], value[street=="R._Maciel_Pinheiro"],  value[street=="Av._Mal._Floriano_Peixoto"], value[street=="R._Cristina_Procópio_Silva"], col=rgb(0.1,0.4,0.7,0.7) , names=c("Inacio","Edesio","Manoel", "Maciel", "Floriano", "Cristina"), ylim = c(3, 7) ))

#GINI COEFFICIENTS
inequalities <- data.frame( labels=c("Gini", "Entropy", "SD"), edesio=c(ineq(filter(all_data, street == "R._Edésio_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Edésio_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Edésio_Silva")$qscore)), inacio=c(ineq(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore)), maciel=c(ineq(filter(all_data, street == "R._Maciel_Pinheiro")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Maciel_Pinheiro")$qscore, type="entropy"), sd(filter(all_data, street == "R._Maciel_Pinheiro")$qscore)), manoel=c(ineq(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore, type="entropy"), sd(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore)), floriano=c(ineq(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore, type="Gini"), ineq(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore, type="entropy"), sd(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore)), cristina= c(ineq(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore, type="Gini"), ineq(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore, type="entropy"), sd(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore)) )

inequalities
```

A partir da análise dos violin plots, alguns pontos podem ser destacados:

- A Manoel P. de Araújo foi realmente a rua com as notas em gerais mais baixas o que pode ser um indicativo de problema na rua. Analisando com mais cuidado as imagens da rua na próxima Seção, pode-se perceber que esses valores baixos eram esperados, já que se trata de uma área antiga e pouco cuidada do centro da cidade (bem degradada!);
- A Inacio Marques e a Edesio silva tiveram valores mais espalhados com uma maior concentração em algumas regiões, o que era esperado dado variações nos tipos de locais nessas ruas (mais ou menos verde, mais ou menos conservados). A Edesio tem uma maior concentração de valores medianos, e medianos para bom e para ruim, já a Inácio tem uma maior concentração de valores para medianos bons e ruins;
- A Maciel Pinheiro tem uma maior concentração de valores com notas parecidas, o que era esperado dado a maior semelhança de locais ao longo de toda a rua. Isso a torna mais homogênea que a Inacio e a Edesio, porém mais heterogênea que a Manoel P. de Araujo;
- A Inacio, Edesio e Maciel possuem QScores que variam em 2 ou mais pontos. Essa grande variação merece ser analisada com mais cuidado já que pode ser um indicativo de problemas em certos locais das ruas!

Para complemento numérico dos violin plots, o sumário de cada rua na seguinte ordem: Inacio, Edesio, Maciel e Manoel.
```{r }
summary(filter(qscoresDFGeral, street == "R._Inácio_Marquês_da_Silva")$qscore)
summary(filter(qscoresDFGeral, street == "R._Edésio_Silva")$qscore)
summary(filter(qscoresDFGeral, street == "R._Maciel_Pinheiro")$qscore)
summary(filter(qscoresDFGeral, street == "R._Manoel_Pereira_de_Araújo")$qscore)
summary(filter(qscoresDFGeral, street == "Av._Mal._Floriano_Peixoto")$qscore)
summary(filter(qscoresDFGeral, street == "R._Cristina_Procópio_Silva")$qscore)
```


# Analisando em detalhe cada rua

Para entender um pouco melhor cada rua, tentamos analisar os QScores obtidos ao longo da rua e confrontá-los com as imagens para tentar responder as duas questões:

4. Olhando as variações dos QScores por número/ponto na rua, consigo perceber variações que podem indicar problemas?
5. Confrontando as variações no QScores com as fotos, podemos apontar problemas/virtudes das ruas?

## Inacio Marques

```{r }
summary_inacio = filter(qscoresDFGeral, street == "R._Inácio_Marquês_da_Silva") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_inacio$upper <- summary_inacio$media_ponto + summary_inacio$sd * 1.96 / 4
summary_inacio$lower <- summary_inacio$media_ponto - summary_inacio$sd * 1.96 / 4

summary_edesio = filter(qscoresDFGeral, street == "R._Edésio_Silva") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_edesio$upper <- summary_edesio$media_ponto + summary_edesio$sd * 1.96 / 4
summary_edesio$lower <- summary_edesio$media_ponto - summary_edesio$sd * 1.96 / 4

summary_maciel = filter(qscoresDFGeral, street == "R._Maciel_Pinheiro") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_maciel$upper <- summary_maciel$media_ponto + summary_maciel$sd * 1.96 / 4
summary_maciel$lower <- summary_maciel$media_ponto - summary_maciel$sd * 1.96 / 4

summary_manoel = filter(qscoresDFGeral, street == "R._Manoel_Pereira_de_Araújo") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_manoel$upper <- summary_manoel$media_ponto + summary_manoel$sd * 1.96 / 4
summary_manoel$lower <- summary_manoel$media_ponto - summary_manoel$sd * 1.96 / 4

summary_floriano = filter(qscoresDFGeral, street == "Av._Mal._Floriano_Peixoto") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_floriano$upper <- summary_manoel$media_ponto + summary_manoel$sd * 1.96 / 4
summary_floriano$lower <- summary_manoel$media_ponto - summary_manoel$sd * 1.96 / 4

summary_cristina = filter(qscoresDFGeral, street == "R._Cristina_Procópio_Silva") %>% group_by(num) %>% summarise(media_ponto = mean(qscore), sd = sd(qscore))
summary_cristina$upper <- summary_manoel$media_ponto + summary_manoel$sd * 1.96 / 4
summary_cristina$lower <- summary_manoel$media_ponto - summary_manoel$sd * 1.96 / 4
```

```{r  fig.height=10, fig.width=12}
inacio <- filter(all_data, street == "R._Inácio_Marquês_da_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)

print(paste(">>> GINI da rua: ", ineq(filter(all_data, street == "R._Inácio_Marquês_da_Silva")$qscore, type="Gini")))
for (value in unique(inacio$num)){
  print(paste("Número", value, ineq(filter(inacio, num == value)$qscore, type="Gini")))
}
summary_inacio

plot_ci_per_photo(arrange(filter(all_data, street == "R._Inácio_Marquês_da_Silva"), num, angle), "Inacio", c(203, 112, 90), c(293, 270, 22))#Street 2
```

Para a Inacio Marques percebemos uma **variação de aproximadamente 1.2** nas médias do QScore do número 500 (região de muros logo após o museu) e do número 239 (regiao residencial no quarteirão seguinte ao museu). Esta diferença parece um indicativo de variação entre tipos, ou qualidades, de locais na rua e que a faixa do número 100-300 tem melhores avaliações, enquanto o início (54) e o final da rua (500) parecem ser regiões mais problemáticas.

Analisando os scores de cada ângulo em cada ponto da rua, pode-se observar **que as maiores diferenças variam de 0.54 a 1.79 entre ângulos do mesmo número**. Essas diferenças podem ser indicativos de variações de manutenção/qualidade de locais muito próximos. Por exemplo:

- no número 54, as variações para os ângulos 203 e 293
- no número 120 a baixa nota do ângulo 203
- no número 239 existe uma homogeneidade, de forma positiva
- no número 360 as variações para os números 90 e 203 
- no número 500 temos o ângulo 203 com uma nota mais baixa

```{r results='asis', echo=FALSE, out.extra=''}
library("knitr")

show_street_data <- function (current_df, all_data){
    color_space <- c("#000000", "#001900", "#003300", "#004c00", "#006600", "#007f00", "#009900", "#00b200", "#00cc00", "#00e500", "#00ff00")
    step <- (max(all_data$qscore) - min(all_data$qscore)) / length(color_space)
    thresholds <- seq(min(all_data$qscore), max(all_data$qscore), step)
    
    cat("<div class='row'>")
    angleData = c()
    for(i in 1:nrow(current_df)) {
      row <- current_df[i,]
      url <- as.character(row$url)
      street <- as.character(row$street)
      num <- row$num
      angle <- row$angle
      score <- row$qscore
      angleData <- append(angleData, score)
      
      color_index <- findInterval(score, thresholds)[1]
      if (color_index > length(color_space)){
         color_index <- length(color_space)
      }
      cat(paste("<div class='col-xs-3' style=\"background-color:", color_space[color_index],"\">", sep=""))
      cat("<img src='", url,"' width='300px'>", sep = "")
      cat("<div class='caption' style=\"color:white\">", street, " " , num , ", ", angle, " -> ", score,  "</div>", sep="")
      cat("</div>")
      if (i > 1 && i %% 4 == 0){
        cat("</div>")
        cat("####### Sumário do Número ", num, ": Max. ", max(angleData), " Min: ", min(angleData), " Diff: ", max(angleData) - min(angleData))
        cat("<div class='row'>")
        angleData = c()
      }
    }
}

show_street_data(inacio, all_data)

```


Com esse nível de detalhe conseguimos confrontar os scores com as imagens e perceber que:

- a Inácio Marques é uma rua que possui seu final como sendo uma área pouco cuidada (número 500), com muros/construções pouco cuidadas, terrenos, sem atrativo;
- o início da rua (segunda área de score mais baixo) tem alguns trechos de casas mais simples e/ou pouco cuidadas, lixo, vegetação pouco cuidada e vegetação bem cuidada em um angulo apenas;
- outras áreas com níveis de cuidado variados, onde poderíamos apontar setores nos números 120 e 360, principalmente, que poderiam receber melhores cuidados. 
+ No número 360, angulos 90 e 203, temos terrenos que precisam de maiores cuidados, contrapostos a uma bela visão proporcionada pela presença do museu e sua vegetação melhor cuidada. 
+ No número 120, ângulos 203 temos lixo e melhoria necessária nas construções, e no ângulo 112 temos mais uma indicação de melhoria em construção/construção inacabada contraposta com outras construções bem cuidadas e com verde;
- a região do número 239 sintetiza boas avaliações e vai de acordo com nossa avaliação anterior: boa manutenção, verde, rua larga

Analisando de forma geral as fotos percebemos que, conforme esperado, os locais com menor conservação e menos verde apresentam QScores mais baixos, indicando que ações de melhoria/cuidado poderiam ser direcionados para essas áreas. 

## Edesio Silva

```{r  fig.height=10, fig.width=12}
edesio <- filter(all_data, street == "R._Edésio_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)

print(paste(">>> GINI da rua: ", ineq(filter(all_data, street == "R._Edésio_Silva")$qscore, type="Gini")))
for (value in unique(edesio$num)){
  print(paste("Número", value, ineq(filter(edesio, num == value)$qscore, type="Gini")))
}
summary_edesio

plot_ci_per_photo(arrange(filter(all_data, street == "R._Edésio_Silva"), num, angle), "Edésio Silva", c(22, 135), c(315, 203))#Street 1
```

Para a Edesio percebemos **uma variação de aproximadamente 0.9** nas médias do QScore do número 1136 (terreno, pouco cuidada) e do número 1546 (casas mais novas, bem cuidadas). Esta diferença parece um indicativo de variação entre tipos, ou qualidades, de locais na rua. É importante perceber que, ao contrário da Inacio, a Edesio parece ter uma alternância maior entre locais bem e mal avaliados ao longo da rua.

Analisando os scores de cada ângulo em cada ponto da rua, pode-se observar **que as maiores diferenças variam de 0.45 a 1.25 no QScore entre ângulos do mesmo número**. Por exemplo:

- no número 70, o ângulo 22 com nota distoante dos demais ângulos;
- no número 306 a pior nota do ângulo 135;
- no número 602 as melhores notas dos ângulos 22 e 315;
- no número 1136 temos uma maior homogeneidade, de forma negativa;
- no número 1546 temos uma maior homogeneidade, de forma positiva, com o ângulo 22 apresentando uma nota ainda melhor.

```{r results='asis', echo=FALSE, out.extra=''}
show_street_data(edesio, all_data)
```

Com esse nível de detalhe conseguimos confrontar os scores com as imagens e perceber que:

- a Edesio Silva possui uma área muito pouco cuidada (número 1136), com os ângulos 22, 135 e 203 temos problemas de terrenos, lixo e casas pouco cuidadas;
- no restante da rua temos variações de melhoras e piores nas notas entre os números e entre os ângulos. 
+ No número 70, ângulo 135 existe uma construção inacabada que afeta a vista da rua, nos angulos 135 e 203 existe lixo na rua, nos angulos 135, 203 e 315 existem algumas casas que precisam de melhor cuidado e falta verde na rua. 
+ No número 602, ângulo 203 temos um terreno com lixos, angulo 135 temos alem de um muro pouco cuidado uma falta de verde (apesar de termos arvores em crescimento!). 
+ No número 306 temos notas medianas que condizem com a combinação de vegetação com casas de boa manutenção e algumas de menor manutenção, ou artefatos de construção.

Analisando de forma geral as fotos percebemos que, conforme esperado, os locais com menor conservação e menos verde apresentam QScores mais baixos, indicando que ações de melhoria/cuidado poderiam ser direcionados para essas áreas. 

## Maciel Pinheiro

```{r  fig.height=10, fig.width=12}
maciel <- filter(qscoresDFGeral, street == "R._Maciel_Pinheiro") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)

print(paste(">>> GINI da rua: ", ineq(filter(all_data, street == "R._Maciel_Pinheiro")$qscore, type="Gini")))
for (value in unique(maciel$num)){
  print(paste("Número", value, ineq(filter(maciel, num == value)$qscore, type="Gini")))
}
summary_maciel

plot_ci_per_photo(arrange(filter(all_data, street == "R._Maciel_Pinheiro"), num, angle), "Maciel Pinheiro", c(360, 90), c(270, 180))#Street 3
```

Para a Maciel percebemos **uma variação de aproximadamente 0.2** nas médias do QScore do número 248 e dos números 130 e 248. Esta diferença parece um indicativo de variações sutis de preferências dos usuários por fachadas de lojas, quantidade de carros, dentre outros. A análise dos intervalos acaba revelando um similaridade ao longo de toda a rua. Outro ponto importante é a presença típica de QScores medianos, ou medianos para alto, e ligeiras melhorias na faixa dos números 190 e 248.

Analisando os scores de cada ângulo em cada ponto da rua, pode-se observar **que as maiores diferenças por ângulo variam de 0.69 a 0.94 entre angulos do mesmo número**. Esta variação, ao contrário da Edesio e Inacio, sugere que em cada número existe ao menos 1 angulo que desperta um sentimento mais positivo ou negativo. Por exemplo:

- No número 360, temos uma nota mais baixa para os ângulos 90 e 270;
- No número 284, temos uma nota mais baixa para os ângulos 90 e 270;
- No número 248, temos uma nota mais baixa para os ângulos 270 e 360;
- No número 190, temos uma nota mais baixa para o ângulo 180;
- No número 130, temos uma nota mais baixa para os ângulos 270 e 360

```{r results='asis', echo=FALSE, out.extra=''}
show_street_data(maciel, all_data)
```

Com esse nível de detalhe conseguimos confrontar os scores com as imagens e perceber que:

- A maciel é a rua mais homogêna de nosso conjunto, dado a semelhança geral que existe entre os espaços capturados nas fotos;
- Apesar dessa homogeneidade, todos os números considerados apresentaram ao menos um ângulo com uma diferença próxima a 1 ponto para a melhor nota do número. 
+ No número 360, ângulo 270 temos uma parte razoável da vista tomada por um caminhão e uma fachada com menor cuidado;
+ No número 284, ângulo 90 também pode ser um caso de preferências por fachadas, já no angulo 270 temos uma fachada com menor cuidado;
+ No número 248, ângulo 360 podemos ter um caso de preferência de estilo de vitrines e prédios e no angulo 270 temos algumas fachadas com menor cuidado;
+ No número 190, ângulo 180 temos um prédio em pior estado de conservação;
+ No número 130, ângulo 270 podemos ter um caso de preferência de estilo de vitrines e prédios.

De forma geral as fotos percebemos que, conforme esperado, em geral os locais possuem um bom nível de manutenção o que condiz com as notas mais altas de percepção (acima de 5.0, próximo a 6.0). Por outro lado, essas variações maiores de scores em certas cenas sugere uma melhor investigação com os pontos marcados pelos usuários e que pode gerar sugestões de melhorias para as fachadas. 

## Manoel Pereira

```{r  fig.height=10, fig.width=12}
manoel <- filter(all_data, street == "R._Manoel_Pereira_de_Araújo") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)

print(paste(">>> GINI da rua: ", ineq(filter(all_data, street == "R._Manoel_Pereira_de_Araújo")$qscore, type="Gini")))
for (value in unique(manoel$num)){
  print(paste("Número", value, ineq(filter(manoel, num == value)$qscore, type="Gini")))
}
summary_manoel

plot_ci_per_photo(arrange(filter(all_data, street == "R._Manoel_Pereira_de_Araújo"), num, angle), "Manoel Pereira", c(22, 135, 293), c(315, 112, 203, 225))#Street 4
```

Para a Manoel percebemos **uma variação de aproximadamente 0.14** nas médias do QScore do número 392 e do número 370. Esta diferença parece um indicativo de variações sutis de preferências dos usuários de acordo com as condições de manutenção na rua, lixo. 

Analisando os scores de cada ângulo em cada ponto da rua, pode-se observar que, apesar das notas tipicamente baixas, 
**as maiores diferenças variam de 0.41 a 0.83 entre ângulos do mesmo número**. Por exemplo:

- No número 370, no ângulo 22 temos aprox. 0.6 a menos do angulo 315;
- No número 300, ângulo 315 temos aprox. 0.9 a menos  do angulo 203;
- No número 222, ângulo 22 temos 0.6 a menos do angulo 315;

```{r results='asis', echo=FALSE, out.extra=''}
show_street_data(manoel, all_data)
```

Com esse nível de detalhe conseguimos confrontar os scores com as imagens e perceber que:

- Apesar da média geral baixa e de uma maior homogeneidade da rua, ainda assim existem cenas/locais que despertam sentimentos e emoções ainda mais negativos nas pessoas. Essas observações são importantes porque acrescentam que, apesar dos QScores sugerirem que a rua toda é mais problemática que as demais avaliadas, existem pontos ainda mais críticos na rua;
+ No número 370, no ângulo 22 temos prédios mal conservados, barracas e no angulo 315, apesar do mal estado de conservacao dos prédios, ruas e barracas, temos vegetação e o céu claro;
+ No número 300, ângulo 315 temos alguns prédios mais antigos e pouco cuidados combinados com itens na rua;
+ No número 222, ângulo 22 temos prédios em pior estado de conservação combinados com itens na rua;

De forma geral as fotos percebemos que, conforme esperado, em geral os locais possuem um nível ruim de manutenção o que condiz com as notas mais baixas de percepção (em torno de 3-4).  ]


## Floriano Peixoto

```{r  fig.height=10, fig.width=12}
floriano <- filter(all_data, street == "Av._Mal._Floriano_Peixoto") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)

print(paste(">>> GINI da rua: ", ineq(filter(all_data, street == "Av._Mal._Floriano_Peixoto")$qscore, type="Gini")))
for (value in unique(floriano$num)){
  print(paste("Número", value, ineq(filter(floriano, num == value)$qscore, type="Gini")))
}
summary_floriano

plot_ci_per_photo(filter(all_data, street == "Av._Mal._Floriano_Peixoto"), "Floriano Peixoto", c(22,293), c(112,203))#Street 5
``` 

```{r results='asis', echo=FALSE, out.extra=''}
show_street_data(floriano, all_data)
```

## Cristina Procópio

```{r  fig.height=10, fig.width=12}
cristina <- filter(all_data, street == "R._Cristina_Procópio_Silva") %>% group_by(num) %>% arrange(street, num, angle) %>% select(url, street, num, angle, qscore)

print(paste(">>> GINI da rua: ", ineq(filter(all_data, street == "R._Cristina_Procópio_Silva")$qscore, type="Gini")))
for (value in unique(cristina$num)){
  print(paste("Número", value, ineq(filter(cristina, num == value)$qscore, type="Gini")))
}
summary_cristina

plot_ci_per_photo(filter(all_data, street == "R._Cristina_Procópio_Silva"), "Cristina Procopio", c(22, 45, 293, 315), c(135, 225))#Street 6 -> At number 436, 22 x 315 and 135 x 203
``` 

```{r results='asis', echo=FALSE, out.extra=''}
show_street_data(cristina, all_data)
```

# Características de Usuários no Centro

Algumas observações:

- Para as ruas Maciel Pinheiro, Cardoso Vieira, Peregrino de Carvalho e Marquês de Herval apesar de terem características diferentes quanto á largura de rua, arborização e conservação de prédios, os usuários mostraram alta importância para Espaços Públicos, Arborização, Espaços para Circulação de Pedestres e Mobiliário Urbano;
- A importância dada a espaço para circulação é geralmente de média a alta, com algumas variações entre estas ruas

```{r results='asis', echo=FALSE, out.extra='', fig.height=20, fig.width=12}
center_data <- read.csv("aida/usuarios-centro-historico.csv", header = TRUE)

plot_street_summary <- function(data, street_name){
  data$street_name <- street_name
  
  summ <- group_by(data, Sexo.) %>% count(Sexo.)
  g1 <- ggplot(summ, aes(x=Sexo., y=n, fill=Sexo.)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data, Trabalha.na.área.) %>% count(Trabalha.na.área.)
  g2 <- ggplot(summ, aes(x=Trabalha.na.área., y=n, fill=Trabalha.na.área.)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data, Quanto.gastou.em.compras.) %>% count(Quanto.gastou.em.compras.)
  g3 <- ggplot(summ, aes(x=Quanto.gastou.em.compras., y=n, fill=Quanto.gastou.em.compras.)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data, Meio.de.transporte.usado.para.chegar.ao.centro) %>% count(Meio.de.transporte.usado.para.chegar.ao.centro)
  g4 <- ggplot(summ, aes(x=Meio.de.transporte.usado.para.chegar.ao.centro, y=n, fill=Meio.de.transporte.usado.para.chegar.ao.centro)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data, Se.veio.de.carro..onde.estacionou.o.carro.) %>% count(Se.veio.de.carro..onde.estacionou.o.carro.)
  g5 <- ggplot(summ, aes(x=Se.veio.de.carro..onde.estacionou.o.carro., y=n, fill=Se.veio.de.carro..onde.estacionou.o.carro.)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data, Pedestres) %>% count(Pedestres)
  g6 <- ggplot(summ, aes(x=Pedestres, y=n, fill=Pedestres)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data, Faixa.de.circulação.de.veículos) %>% count(Faixa.de.circulação.de.veículos)
  g7 <- ggplot(summ, aes(x=Faixa.de.circulação.de.veículos, y=n, fill=Faixa.de.circulação.de.veículos)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
   summ <- group_by(data, Estacionamento) %>% count(Estacionamento)
  g8 <- ggplot(summ, aes(x=Estacionamento, y=n, fill=Estacionamento)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
    summ <- group_by(data, Espaços.Públicos) %>% count(Espaços.Públicos)
  g9 <- ggplot(summ, aes(x=Espaços.Públicos, y=n, fill=Espaços.Públicos)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
   summ <- group_by(data, Arborização) %>% count(Arborização)
  g10 <- ggplot(summ, aes(x=Arborização, y=n, fill=Arborização)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
   summ <- group_by(data, Mobiliário.Urbano) %>% count(Mobiliário.Urbano)
  g11 <- ggplot(summ, aes(x=Mobiliário.Urbano, y=n, fill=Mobiliário.Urbano)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data, Em.que.ano.o.Sr..a.Sra.nasceu.) %>% count(Em.que.ano.o.Sr..a.Sra.nasceu.)
  g12 <- ggplot(summ, aes(x=Em.que.ano.o.Sr..a.Sra.nasceu., y=n, fill=Em.que.ano.o.Sr..a.Sra.nasceu.)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
   summ <- group_by(data,  Qual.sua.renda.familiar.) %>% count(Qual.sua.renda.familiar.)
  g13 <- ggplot(summ, aes(x=Qual.sua.renda.familiar., y=n, fill=Qual.sua.renda.familiar.)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  summ <- group_by(data,  Cidade.de.origem) %>% count(Cidade.de.origem)
  g14 <- ggplot(summ, aes(x=Cidade.de.origem, y=n, fill=Cidade.de.origem)) + 
      geom_bar(position=position_dodge(), stat="identity")
  
  print(paste(">>>>> Rua ", street_name, nrow(data)))
  multiplot(g1, g12, g13, g14, g2, g3, g4, g5, g6, g7, g8, g9, g10, g11, cols=2)
}
center_data <- arrange(center_data, Rua.pesquisada)
street_names <- unique(center_data$Rua.pesquisada)

plot_street_summary(filter(center_data, grepl("maciel", tolower(Rua.pesquisada))), "Maciel Pinheiro")
plot_street_summary(filter(center_data, grepl("marquês", tolower(Rua.pesquisada))), "Marquês do herval")
plot_street_summary(filter(center_data, grepl("cardoso", tolower(Rua.pesquisada))), "Cardoso Vieira")
plot_street_summary(filter(center_data, grepl("peregrino", tolower(Rua.pesquisada))), "Peregrino de Carvalho")
plot_street_summary(filter(center_data, grepl("eufro", tolower(Rua.pesquisada))), "Eufrosino")
plot_street_summary(filter(center_data, grepl("irineu", tolower(Rua.pesquisada))), "Irineu Joffily")
plot_street_summary(filter(center_data, grepl("manoel", tolower(Rua.pesquisada))), "Manoel Cavalcanti Belo")
plot_street_summary(filter(center_data, grepl("sales", tolower(Rua.pesquisada))), "Monsenhor Sales")
plot_street_summary(filter(center_data, grepl("leal", tolower(Rua.pesquisada))), "Semeão Leal")
plot_street_summary(filter(center_data, grepl("neiva", tolower(Rua.pesquisada))), "Venâncio neiva")
```